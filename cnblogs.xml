<?xml version="1.0" encoding="UTF-8" ?>
    <rss version="2.0">
    <channel>
        <title><![CDATA[ ä¸»é¡µ - åå®¢å­ ]]></title>
        <link><![CDATA[ https://www.cnblogs.com/ ]]></link>
        <lastBuildDate>2026-02-15T04:18:16.865Z</lastBuildDate>
        <description><![CDATA[
        ä¸»é¡µ - åå®¢å­ RSS
    ]]></description>
        <language>zh-cn</language>
        <item>
    <title><![CDATA[ OpenEuler 20.03æå»ºzabbix8.0 rpmå ]]></title>
    <link>https://www.cnblogs.com/virtualzzf/p/19617629</link>
    <guid>839af361d3bec343074433813f17777f</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/virtualzzf/p/19617629" title="åå¸äº 2026-02-15 10:46">
    <span role="heading" aria-level="2">OpenEuler 20.03æå»ºzabbix8.0 rpmå</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        OpenEuler 20.03èªè¡æå»ºzabbix8.0 rpmå
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="ä¸è¯´æ">ä¸ãè¯´æ</h1>
<h2 id="ä¸ºä»ä¹è¦èªå·±æå»º">ä¸ºä»ä¹è¦èªå·±æå»ºï¼</h2>
<p>ç±äºcentosä»7çæ¬ä¹åæ¹ä¸ºstreamï¼å·¥ä½ç¯å¢ç±centosè½¬åOpenEulerãzabbixå®ç½ä¸æåå¤§ä¸»æµæä½ç³»ç»é¢ç¼è¯çrpmåï¼ä½æ¯Openeulerç¸å¯¹å°ä¼ï¼èªç¶æ²¡æå¶ä½å¥½çåãå³ä½¿æ¯centosç³»ç»ï¼7çæ¬ä¹è¿äºéæ§äºï¼ä»zabbix 6.0å¼å§ï¼centos 7å·²ç»ä¸æä¾serverçrpmåäºï¼åªå©ä¸proxyåagentï¼å°äº7.0çæ¬ï¼è¿proxyé½æ²¡æäºãå­¦ä¼èªå·±åå»ºrpmåï¼ä»¥å¤æä½ç³»ç»ç¯å¢åçæ¹åæ¯éå¸¸æå¿è¦çã</p>
<h2 id="ä¸ºä»ä¹ä¸ç´æ¥æºä»£ç ç¼è¯">ä¸ºä»ä¹ä¸ç´æ¥æºä»£ç ç¼è¯</h2>
<ol>
<li>ç±äºéç¨çæ¯sever-proxy-agentçå¤å±æ¶æï¼serveråªæä¸å°ï¼ä½æ¯proxyæå åå°ï¼agentæ´æ¯ä¸åï¼æ¯ä¸å°é½ç¨æºä»£ç ç¼è¯å·¥ä½éå¤§å¤§å¢å ã</li>
<li>æºä»£ç ç¼è¯çè½¯ä»¶ï¼å¨ä¸äºä¾å¦éç½®æä»¶ãå¯åå½ä»¤ä¸ä¸rpmçæ¬æå·®å¼ï¼å¦ææ··å¸å¢å äºè¿ç»´å¤æåº¦ã</li>
</ol>
<h2 id="ææ²¡æé¢ç¼è¯å¥½çrpmå">ææ²¡æé¢ç¼è¯å¥½çrpmå</h2>
<p>å¨OpenEulerçå®æ¹ç¤¾åºçè½¯ä»¶ä¸­å¿ï¼æç¤¾åºæåèªè¡æå»ºçrpmåï¼å¯ä»¥å°è¯æ¾æ¾ææ ç¬¦åèªå·±è¦æ±ççæ¬ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2611015/202602/2611015-20260214105121016-558214650.png" class="lazyload"></p>
<h1 id="äºåå¤å·¥ä½">äºãåå¤å·¥ä½</h1>
<h2 id="21-æ·»å repoæº">2.1 æ·»å repoæº</h2>
<p>å¦æOpenEulerç¼ºå°é»è®¤çrepoæºï¼éè¦èªå·±æ·»å <br>
å¨/etc/yum.repos.d/openEuler_x86_64.repoä¸­æ·»å å¦ä¸åå®¹ï¼</p>
<pre><code>[OS]
name=openEuler-$releasever - OS
baseurl=https://repo.openeuler.openatom.cn/openEuler-20.03-LTS-SP4/OS/$basearch/
enabled=1
gpgcheck=1
gpgkey=https://repo.openeuler.openatom.cn/openEuler-20.03-LTS-SP4/OS/$basearch/RPM-GPG-KEY-openEuler
</code></pre>
<p>å¦å¤åæ·»å everythingçæºï¼å¯ä»¥æä¾æ´å¤çåã</p>
<pre><code>dnf config-manager --add-repo https://repo.openeuler.org/openEuler-20.03-LTS/everything/x86_64
</code></pre>
<p>ä½¿ç¨<code>dnf clean all &amp;&amp; dnf makecache</code>å½ä»¤æ´æ°ã</p>
<h2 id="22-åå¤æå»ºrpmåç¯å¢">2.2 åå¤æå»ºrpmåç¯å¢</h2>
<p>ä¹åçæç« éå·²ç»ä»ç»äºæå»ºrpmåçåºæ¬æ¹æ³ï¼è¿éä¸åèµè¿°ãrootç¨æ·ä¸è¿è¡å½ä»¤å¦ä¸ï¼</p>
<pre><code>dnf install -y rpm-build
dnf install -y rpmdevtools
rpmdev-setuptree
</code></pre>
<p>ä¸è½½srpmåï¼ <a href="http://repo.zabbix.com/zabbix/7.0/rhel/8/SRPMS/zabbix-7.0.23-release1.el8.src.rpm" target="_blank" rel="noopener nofollow">http://repo.zabbix.com/zabbix/7.0/rhel/8/SRPMS/zabbix-7.0.23-release1.el8.src.rpm</a> ï¼ ï¼è¿éä»¥rhel8çæ¬çsrpmæä»¶ä¸ºä¾ï¼</p>
<pre><code>rpm -ivh zabbix-7.0.23-release1.el8.src.rpm
</code></pre>
<p>æ­¤æ¶ï¼å¨/root/rpmbuildç®å½ä¸çSOURCESç®å½ä¸ä¼äº§çæºä»£ç åç¼©åãè¡¥ä¸åéç½®æä»¶ï¼SPECSç®å½ä¼äº§çspecæä»¶ãä½æ¯æ­¤specæä»¶æ¯Centos8çæ¬çï¼ä¸OpenEulerä¸å®å¨å¥åï¼éè¦ä¿®æ¹ä¸ä¸ã</p>
<h1 id="ä¸å®è£ä¾èµå">ä¸ãå®è£ä¾èµå</h1>
<h2 id="31-buildrequiresè¦æ±çä¾èµå">3.1 BuildRequiresè¦æ±çä¾èµå</h2>
<table>
<thead>
<tr>
<th>ä¾èµå</th>
<th>è¦æ±ççæ¬</th>
<th>dnfå®è£ççæ¬</th>
</tr>
</thead>
<tbody>
<tr>
<td>make</td>
<td></td>
<td></td>
</tr>
<tr>
<td>mariadb-connector-c-devel</td>
<td></td>
<td></td>
</tr>
<tr>
<td>postgresql-devel</td>
<td>&gt;= 12.0</td>
<td>10.5</td>
</tr>
<tr>
<td>sqlite-devel</td>
<td></td>
<td></td>
</tr>
<tr>
<td>net-snmp-devel</td>
<td></td>
<td></td>
</tr>
<tr>
<td>openldap-devel</td>
<td></td>
<td></td>
</tr>
<tr>
<td>unixODBC-devel</td>
<td></td>
<td></td>
</tr>
<tr>
<td>curl-devel</td>
<td>&gt;= 7.13.1</td>
<td>7.66.0</td>
</tr>
<tr>
<td>OpenIPMI-devel</td>
<td>&gt;= 2</td>
<td>2.0.29</td>
</tr>
<tr>
<td>libssh-devel</td>
<td>&gt;= 0.9.0</td>
<td>0.9.4</td>
</tr>
<tr>
<td>java-develï¼java-1.8.0-openjdk-develï¼</td>
<td>&gt;= 1.6.0</td>
<td>1.8.0.392.b08</td>
</tr>
<tr>
<td>libxml2-devel</td>
<td></td>
<td></td>
</tr>
<tr>
<td>libevent-devel</td>
<td></td>
<td></td>
</tr>
<tr>
<td>pcre2-devel</td>
<td></td>
<td></td>
</tr>
<tr>
<td>openssl-devel</td>
<td>&gt;= 1.0.1</td>
<td>1.1.1f</td>
</tr>
<tr>
<td>systemd</td>
<td></td>
<td></td>
</tr>
<tr>
<td>policycoreutils-devel</td>
<td></td>
<td></td>
</tr>
<tr>
<td>selinux-policy-devel</td>
<td></td>
<td></td>
</tr>
<tr>
<td>c-ares-devel</td>
<td>&gt;= 1.19.0</td>
<td>1.16.1</td>
</tr>
<tr>
<td>å®è£å¨é¨ä¾èµï¼</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<pre><code>dnf install -y make mariadb-connector-c-devel postgresql-devel sqlite-devel net-snmp-devel openldap-devel unixODBC-devel curl-devel OpenIPMI-devel libssh-devel java-1.8.0-openjdk-devel libxml2-devel libevent-devel pcre2-devel openssl-devel systemd policycoreutils-devel selinux-policy-devel c-ares-devel
</code></pre>
<h2 id="32-å¶ä»ä¾èµå">3.2 å¶ä»ä¾èµå</h2>
<p>zabbix agent2æ¯ä½¿ç¨GOè¯­è¨ç¼åçï¼å¹¶ä¸ä½¿ç¨çè¯­æ³å¯¹çæ¬è¿æè¦æ±ï¼OpenEuler 20.03é»è®¤repoæºççæ¬ä¸º1.15ï¼éè¦å®è£ä¸ä¸ªè¾æ°çæ¬çã<br>
é¦åä¸è½½golangçåç¼©åå¹¶è§£å</p>
<pre><code>tar -C /usr/local -xzf go1.24.8.linux-amd64.tar.gz
</code></pre>
<p>éç½®PATHåéå¹¶çæ</p>
<pre><code>tee /etc/profile.d/go.sh &lt;&lt;EOL
export GO_HOME=/usr/local/go
export PATH=\$PATH:\$GO_HOME/bin
EOL
source /etc/profile
</code></pre>
<p>ä½æ¯å®éä¸agent2åweb_service<strong>å¹¶æªæå»ºæå</strong>ï¼è§4.3å°è</p>
<h1 id="åä¿®æ¹specæä»¶">åãä¿®æ¹specæä»¶</h1>
<p>ä¿®æ¹å¥½çspecæä»¶è§ï¼<a href="https://files.cnblogs.com/files/blogs/745793/zabbix.zip?t=1771123185&amp;download=true" target="_blank">https://files.cnblogs.com/files/blogs/745793/zabbix.zip?t=1771123185&amp;download=true</a></p>
<h2 id="41-å é¤rhelåamznå®">4.1 å é¤%{rhel}å%{?amzn}å®</h2>
<p>%{rhel}å%{?amzn}ä¸¤ä¸ªå®åå«æ è¯äºredhatåamazonç³»linuxçå¤§çæ¬å·ï¼ç¨äºæå»ºæ¶ä¸äºéç½®æ¹å¼çéæ©ãç±äºè¿ä¸¤ä¸ªå®å¨OpenEulerä¸­ä¸ºç©ºï¼å¨specæä»¶ä¸­ä¼è¢«å¨å±å®ä¹ä¸º0ï¼ç´æ¥ä½¿ç¨ä¼å½±åæå»ºï¼éè¦å¨é¨è¿è¡å¤çã<br>
ä¸OpenEulerç¸å¯¹æ¥è¿çæ¯Centos8ï¼æ%{?rhel}å½åâ8âå¤çï¼%{?amzn}ç´æ¥å é¤ã<br>
ç¤ºä¾1ï¼</p>
<pre><code>%if ( 0%{?rhel} &gt;= 7 &amp;&amp; 0%{?amzn} == 0 ) || 0%{?amzn} &gt;= 2023
%{!?build_agent2: %global build_agent2 1}
%endif
</code></pre>
<p>ç±äº08 &gt;= 7ï¼ç´æ¥ä¿®æ¹ä¸º</p>
<pre><code>%{!?build_agent2: %global build_agent2 1}
</code></pre>
<p>ç¤ºä¾2ï¼</p>
<pre><code>%if 0%{rhel} &gt;= 9 || 0%{?amzn} &gt;= 2023
BuildRequires: selinux-policy-devel
BuildRequires: c-ares-devel &gt;= 1.19.0
%endif
</code></pre>
<p>ç±äºä¸æ»¡è¶³ 08 &gt;= 9 ï¼ç´æ¥å é¤</p>
<h2 id="42-ä¿®æ¹buildrequiresçæ¬è¦æ±">4.2 ä¿®æ¹BuildRequiresçæ¬è¦æ±</h2>
<p>å®ç½repoæºçpostgresql-develçæ¬ä¸è¾¾æ ï¼ç´æ¥è¿è¡æå»ºä¼æ¥éã<br>
postgresqlå®ç½æ²¡æOpenEulerçé¢ç¼è¯rpmåï¼æ³è¦æ»¡è¶³è¦æ±å¿é¡»èªè¡ä»æºä»£ç è¿è¡ç¼è¯ã<br>
æ¬æä»ä¸ºæ¼ç¤ºï¼å°<code>postgresql-devel &gt;= 12.0</code>ä¿®æ¹ä¸º<code>postgresql-devel</code></p>
<h2 id="43-å»é¤agent2åweb_service">4.3 å»é¤agent2åweb_service</h2>
<p>agent3åweb_serviceé½ä½¿ç¨äºGOè¯­è¨ï¼ç±äºç½ç»é®é¢å¯¼è´ä¸¤èçåå»ºä¼åºéï¼ç´æ¥å é¤ä»¥ä¸åå®¹ï¼</p>
<pre><code>%ifarch x86_64 aarch64
%if ( 0%{?rhel} &gt;= 7 &amp;&amp; 0%{?amzn} == 0 ) || 0%{?amzn} &gt;= 2023
%{!?build_agent2: %global build_agent2 1}
%endif
%if 0%{?rhel} &gt;= 8 || 0%{?amzn} &gt;= 2023
%{!?build_web_service: %global build_web_service 1}
%endif
%endif
</code></pre>
<p>æ¬æ¬¡æå»ºä¸åæ¬ä¸¤èï¼æ³è¦è§£å³å¯è½å¿é¡»ä½¿ç¨é­æ³äº</p>
<h1 id="äºæå»º">äºãæå»º</h1>
<p>ä½¿ç¨<code>rpmbuild -bb zabbix.spec</code>å½ä»¤è¿è¡æå»ºï¼éè¦æ¯è¾é¿çæ¶é´ã<br>
å®æåå¨/root/rpmbuild/RPMSç®å½ä¸å°±ä¼çæç¼è¯å¥½çrpmåã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-15 10:46">2026-02-15 10:46</span>&nbsp;
<a href="https://www.cnblogs.com/virtualzzf">virtualzzf</a>&nbsp;
éè¯»(<span id="post_view_count">16</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19617629);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19617629', targetLink: 'https://www.cnblogs.com/virtualzzf/p/19617629', title: 'OpenEuler 20.03æå»ºzabbix8.0 rpmå' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ä¸ºä»ä¹ç°ä»£ C++ åºé½ç¨ PIMPLï¼ä¸åºå³äºå°è£ãä¾èµä¸å®å¨çæ¼è¿ ]]></title>
    <link>https://www.cnblogs.com/charlee44/p/19616660</link>
    <guid>8e81f508b84fe94d286e066ebb7e17c6</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/charlee44/p/19616660" title="åå¸äº 2026-02-14 21:27">
    <span role="heading" aria-level="2">ä¸ºä»ä¹ç°ä»£ C++ åºé½ç¨ PIMPLï¼ä¸åºå³äºå°è£ãä¾èµä¸å®å¨çæ¼è¿</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        ç³»ç»éè¿°äºå¨ C++ å·¥ç¨ä¸­å¦ä½éè¿ PIMPL æ¯ç¨æ³ï¼å¨åå® RAII èµæºå®å¨çåæä¸ï¼ææè§£è¦å¤´æä»¶ä¾èµãæåç¼è¯æçå¹¶ä¿ææ¥å£ç®æ´ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p>å¨ C++ çå·¥ç¨å®è·µä¸­ï¼å¦ä½å¨ä¿è¯èµæºå®å¨ç®¡ççåæ¶ï¼åé¿åå¤´æä»¶æ±¡æåä¸å¿è¦çç¼è¯ä¾èµï¼è¿ä¸ªé®é¢è´¯ç©¿äºç°ä»£ C++ åºè®¾è®¡çæ ¸å¿ãæ¬æå°æ²¿çä¸æ¡æ¸æ°çææ¯æ¼è¿è·¯å¾ï¼æ¢è®¨ä» RAII å°è£åºåï¼åç»å¼è¯­ä¹ãè£¸æéãæºè½æéç­é¶æ®µï¼æç»èµ°å PIMPLï¼Pointer to Implementationï¼ è¿ä¸æçä¸ä¼éçè§£å³æ¹æ¡ã</p>
</blockquote>
<h1 id="1-raiièµæºç®¡ççåºç³">1. RAIIââèµæºç®¡ççåºç³</h1>
<p>C++ çæ ¸å¿å²å­¦ä¹ä¸æ¯ RAIIï¼Resource Acquisition Is Initializationï¼ï¼èµæºï¼åå­ãæä»¶å¥æãç½ç»è¿æ¥ç­ï¼ççå½å¨æåºç±å¯¹è±¡çæé ä¸ææèªå¨ç®¡çãä¾å¦ï¼</p>
<pre><code class="language-cpp">class FileHandle {
    FILE* fp;
public:
    FileHandle(const char* path) : fp(fopen(path, "r")) {}
    ~FileHandle() { if (fp) fclose(fp); }
};
</code></pre>
<p>RAII è®©èµæºç®¡çåå¾å®å¨ï¼å©ç¨ç±»å¯¹è±¡ççå½å¨æï¼å¨æé å½æ°ä¸­ç³è¯·èµæºï¼å¨ææå½æ°ä¸­éæ¾èµæºãå¦æè¿ä¸ªç±»å¯¹è±¡æ¯åºäºæ çå¼å¯¹è±¡ï¼é£ä¹å°±å¯ä»¥èªå¨å®ç°èµæºçç®¡çãå æ­¤ï¼å¨ç°ä»£ C++ ä¸­ï¼ç¸æ¯ä¼ ç»çæéè¯­ä¹ï¼æ´å æå¡ä½¿ç¨åºäº RAII çå¼è¯­ä¹ã</p>
<h1 id="2-å¼è¯­ä¹çè¯±æä¸ä»£ä»·">2. å¼è¯­ä¹çè¯±æä¸ä»£ä»·</h1>
<p>ä½æ¯ï¼å½æä»¬æè¿ç§ææ³ç¨äºå°è£å¤æç»ä»¶ï¼å¦ ONNX æ¨¡åä¼è¯ãæ°æ®åºè¿æ¥æ± ï¼æ¶ï¼é®é¢åºç°äºãçæ³æåµä¸ï¼æä»¬å¸æåä½¿ç¨ std::string ä¸æ ·ï¼ç¨âå¼è¯­ä¹âæä½ä¸ä¸ªå°è£å¯¹è±¡ï¼</p>
<pre><code class="language-cpp">class Embedder {
    Ort::Session session; // å¼æå
public:
    std::vector&lt;float&gt; embed(const std::string&amp; text);
};
</code></pre>
<p>è¿çèµ·æ¥éå¸¸ç®æ´ãé«æãç¬¦åç°ä»£ C++ é£æ ¼ãä½ä¹æå¦å¤ä¸ä¸ªé®é¢ï¼ç ´åäºå°è£ï¼å¯¼è´ä¸å¿è¦çç¯å¢ä¾èµãæç´è§çé®é¢å°±æ¯ <code>Ort::Session</code> çå®æ´å®ä¹å¿é¡»åºç°å¨å¤´æä»¶ä¸­ï¼è¿æå³çä½¿ç¨èå¿é¡»åå« onnxruntime ï¼èè¿ä¸ªå¤´æä»¶å¯è½éè¾¾æ° MB ï¼ä¾èµæ°åä¸ªç³»ç»åºãè¿å°±ä¼é æå¦ä¸é®é¢ï¼</p>
<ul>
<li>ç¼è¯æ¶é´æ´å¢ï¼å¾®å°çæ¹å¨é½éè¦ç¼è¯å¾é¿çæ¶é´ã</li>
<li>å¤´æä»¶è¦åä¸¥éï¼è°ç¨èä½¿ç¨ä¸æ¹ä¾¿ï¼çè³é æç¯å¢æ±¡æã</li>
<li>ABI æå¶èå¼±ï¼åé¨æ¹å¨å¯¼è´ææç¨æ·éç¼è¯ã</li>
</ul>
<h1 id="3-æéè¯­ä¹çåé">3. æéè¯­ä¹çåé</h1>
<p>ä¸ºäºè§£è¦ï¼ä¸ä¸ªæ¯è¾å¥½çåæ³å°±æ¯ä½¿ç¨åç½®å£°æ + æéè¯­ä¹ï¼</p>
<pre><code class="language-cpp">// header
class SessionImpl; // åç½®å£°æ
class Embedder {
    SessionImpl* pimpl;
public:
    Embedder();
    ~Embedder(); // å¿é¡»æå¨ delete
};
</code></pre>
<p>è¿æ ·åç¡®å®åæ­äºç¼è¯ä¾èµï¼ä½ä¹å¼å¥äºæ°çé®é¢ãé£å°±æ¯éè¦æç§ RAII åååå¥½æé å½æ°åææå½æ°ãèä¸æ¦è¦åææå½æ°ï¼ä¹å¾å¾æå³çéè¦åå¦å¤åä¸ªç¹æ®çæåå½æ°ï¼</p>
<ol>
<li>æ·è´æé å½æ°ï¼Copy Constructorï¼</li>
<li>æ·è´èµå¼è¿ç®ç¬¦ï¼Copy Assignment Operatorï¼</li>
<li>ç§»å¨æé å½æ°ï¼Move Constructorï¼</li>
<li>ç§»å¨èµå¼è¿ç®ç¬¦ï¼Move Assignment Operatorï¼</li>
</ol>
<p>è¿æ ·åè¦åéå¸¸å¤çæ ·æ¿ä»£ç ï¼èä¸ä¹å¾å®¹æåºé®é¢ãä¸ºäºå°è£çºç²å®å¨ï¼å¾ä¸å¿å¤±ã</p>
<h1 id="4-ä½¿ç¨æºè½æé">4. ä½¿ç¨æºè½æé</h1>
<p>ä½¿ç¨è£¸æéåéº»ç¦åä¸å®å¨ï¼é£ä¹å°±å¯ä»¥ä½¿ç¨ C++11 å¼å¥çæºè½æéï¼std::unique_ptr å std::shared_ptrï¼æºè½æéåæ ·æ¯åºäº RAII çï¼</p>
<pre><code class="language-cpp">class SessionImpl;
class Embedder {
    std::unique_ptr&lt;SessionImpl&gt; pimpl;
};
</code></pre>
<p>è¿éä¸ºä»ä¹ä½¿ç¨ <code>std::unique_ptr</code> èä¸ä½¿ç¨ <code>std::shared_ptr</code> å¢ï¼å¶å®ä¹å¯ä»¥ï¼ä¸è¿å¨ç°ä»£ C++ ä¸­ï¼æ´æ¨èä½¿ç¨ <code>std::unique_ptr</code> ã<code>std::shared_ptr</code> æ¯ç¨æ¥å±äº«èµæºçæææï¼ä¼å¯¹å¼ç¨èµæºè¿è¡è®¡æ°ï¼ä½æ¯æå¯è½ä¼é æç¸äºå¾ªç¯å¼ç¨é æä¸è½éæ¾èµæºçé®é¢ï¼è<code>std::unique_ptr</code> åè¡¨ç¤ºç¬å èµæºçæææï¼ä¸ä»å¼éæ´ä½ï¼æ å¼ç¨è®¡æ°ï¼ï¼ä¹æ´å å®å¨ï¼åªè½éè¿ <code>std::move</code> è½¬ç§»æææ ï¼ã</p>
<p>ä¸è¿æä¸ç¹éè¦æ³¨æï¼<code>std::unique_ptr</code> å <code>std::shared_ptr</code> å¨å¤çä¸å®æ´ç±»åï¼incomplete typeï¼æ¶çè¡ä¸ºæªç¶ä¸åãå·ä½æ¥è¯´ï¼å½å¨å¤´æä»¶ä¸­ä½¿ç¨åç½®å£°æï¼å¦ <code>class Impl;</code>ï¼å¹¶ç¨æºè½æéææå®æ¶ï¼<code>Impl</code> æ¯ä¸ä¸ªä¸å®æ´ç±»åã</p>
<ul>
<li><code>std::shared_ptr</code> å¯ä»¥å®å¨å°å¨å¤´æä»¶ä¸­é»è®¤ææï¼å ä¸ºå®å¨æé æ¶ï¼éå¸¸å¨ <code>.cpp</code> æä»¶ä¸­ï¼ä¼æè·ä¸ä¸ªå®æ´çå é¤å¨ï¼deleterï¼ï¼å³ä½¿ææåçå¨å¤´æä»¶ä¸ä¸æä¸­ï¼ä¹è½æ­£ç¡®è°ç¨ <code>delete</code>ã</li>
<li>è <code>std::unique_ptr</code> çå é¤å¨æ¯å¶ç±»åçä¸é¨åï¼éå¸¸æ¯é»è®¤ç <code>std::default_delete&lt;Impl&gt;</code>ï¼ï¼å®è¦æ±å¨ææç¹ï¼å³ç±»çææå½æ°è¢«å®ä¾åçå°æ¹ï¼<code>Impl</code> å¿é¡»æ¯å®æ´ç±»åãå¦æå¨å¤´æä»¶ä¸­å <code>~Embedder() = default;</code>ï¼æ­¤æ¶ <code>Impl</code> ä»æ¯ä¸å®æ´çï¼ç¼è¯å¨å¯è½ä¸ä¼æ¥éï¼ä½ä¼å¯¼è´æªå®ä¹è¡ä¸ºï¼éå¸¸æ¯é¾æ¥å¤±è´¥æè¿è¡æ¶å´©æºï¼ã</li>
</ul>
<p>å æ­¤ï¼ä½¿ç¨ <code>std::unique_ptr&lt;Impl&gt;</code> æ¶ï¼å¿é¡»å°ä¸»ç±»çææå½æ°å®ä¹ç§»å° <code>.cpp</code> æä»¶ä¸­ï¼ç¡®ä¿ <code>Impl</code> å·²è¢«å®æ´å®ä¹ï¼</p>
<pre><code class="language-cpp">// Embedder.cpp
class Embedder::Impl {
    // å®æ´å®ä¹...
};

Embedder::~Embedder() = default; // â æ­¤æ¶ Impl å®æ´ï¼å®å¨ææ
</code></pre>
<h1 id="5-å°è£ä¸æççå¹³è¡¡pimpl">5. å°è£ä¸æççå¹³è¡¡ï¼PIMPL</h1>
<p>ä½¿ç¨æºè½æéè½ç¶å¥½ï¼ä½æ¯æ»å½æ¯æ¯ä¸ä¸å¼è¯­ä¹æ¹ä¾¿ãå½ç±»ä¸­åªæä¸ä¸ªéè¦éèçæåè¿å¥½ï¼å¦ææå¾å¤ä¸ªéè¦éèçæåï¼æ¯ä¸ä¸ªé½ååç½®å£°æï¼å¹¶ç¨æºè½æéæ¥ç®¡çï¼é£å°±å®å¨å¤ªç¹çäºãå¹¶ä¸ï¼ä»ç¼ç¨åå³ä¸æ¥è¯´ï¼C++ æºè½æéçåæ³è¯´ä¸ä¸ä¼éï¼æºè½æéæ¯ç±ä¼ ææ§çï¼å½æ»¡å±é½æ¯ <code>std::shared_ptr</code> æè <code>std::unique_ptr</code> çæ¶åï¼å®å¨å¾å½±åéè¯»æ§ã</p>
<p>å¦å¤ï¼ä½ä¸ºå¯¹å¤çæ¥å£ï¼æå¥½æ¯æä¾å Java / C# é£æ ·çæ¥å£ï¼C++ ççº¯èå½ç±»ä¹è¡ï¼éèæææçç»èï¼åæ¬ç§æå½æ°åæ°æ®æåãè¿æ ·æéå¸¸å¤çå¥½å¤ï¼</p>
<ol>
<li>æå°åä¾èµç¯å¢ï¼æåç¼è¯éåº¦ã</li>
<li>è°ç¨èä½¿ç¨æ¹ä¾¿ï¼ä¸ä¼æ±¡æç¯å¢ã</li>
<li>ABI ç¨³å®ï¼å¯ä»¥åªæ´æ°åºèä¸ç¨æ´æ°æ´ä¸ªç¨åºã</li>
</ol>
<p>é£ä¹è¦æä¹è¿è¡ä¼åå¢ï¼å¾ç®åï¼æä»¬å¯ä»¥å®ç°ä¸ä¸ªåä¸º <code>Impl</code> çç±»ä¸­ç±» ï¼ä½¿ç¨<code>std::unique_ptr</code>è¿è¡ç®¡çã<code>Impl</code> æ¯å®ç°å¨ cpp ä¸­çï¼å¯ä»¥å°ä¸åå®ç°çç»èï¼æ¯è¯´ç§æå½æ°åæ°æ®æåï¼é½æ¾å¨è¿ä¸ª <code>Impl</code> ä¸­ãæ´éè¦çæ¯ï¼<code>Impl</code> ä¸­çæ°æ®æåå®å¨å¯ä»¥ä½¿ç¨å¼ç±»åï¼å¦ä¸æç¤ºï¼</p>
<pre><code class="language-cpp">// å¤´æä»¶
class Embedder {
    class Impl;
    std::unique_ptr&lt;Impl&gt; impl;
public:
    Embedder(const std::string&amp; model);
    ~Embedder(); // å£°æä½ä¸å¨å¤´æä»¶å®ä¹ï¼
    std::vector&lt;float&gt; embed(std::string_view text) const;
};
</code></pre>
<pre><code class="language-cpp">// æºæä»¶
class Embedder::Impl {
    Ort::Session session;
    hf::Tokenizer tokenizer;
    int64_t dim;
public:
    Impl(const std::string&amp; path, const hf::Tokenizer&amp; tok) 
        : session(...), tokenizer(tok) { /* init */ }
    std::vector&lt;float&gt; embed(std::string_view text) const { /* ... */ }
};

Embedder::Embedder(const std::string&amp; path) 
    : impl(std::make_unique&lt;Impl&gt;(path, global_tokenizer)) {}

Embedder::~Embedder() = default; // æ­¤æ¶ Impl å®æ´ï¼å®å¨ï¼
</code></pre>
<p>è¿ä¸ªå®ç°ï¼å°±æ¯æè°ç PIMPLï¼Pointer to IMPLementationï¼æ¯ç¨æ³ï¼ä¹å¸¸è¢«ç§°ä½ âç¼è¯é²ç«å¢âï¼Compilation Firewallï¼ æ âOpaque Pointerâ æ¨¡å¼ãä¸å¾ä¸è¯´ï¼è¿ç§ PIMPL è®¾è®¡æ¨¡å¼ç¡®å®ç²¾å¦ââå®å¨å®å¨æ§ãå°è£æ§ãç¼è¯æçä¸æ¥å£ç®æ´æ§ä¹é´åå¾äºè¿ä¹å®ç¾çå¹³è¡¡ï¼æ¢åå®äº RAII çèµæºç®¡çååï¼åææéç¦»äºå®ç°ç»èï¼å ªç§°ç°ä»£ C++ å·¥ç¨å®è·µä¸­âé«åèãä½è¦åâçå¸èã</p>
<h1 id="6-æ²¡æé¶å¼¹åªææè¡¡">6. æ²¡æé¶å¼¹ï¼åªææè¡¡</h1>
<p>PIMPL ä½¿ç¨äºåç½®å£°æãæ¯å¦ä½¿ç¨åç½®å£°æä¸ç´æ¯ C++ ä¸­æ¯è¾äºè®®çä¸ç¹ï¼Qt éµå¾ªåç½®å£°æçååå®ç°äºéå¸¸å¼ºå¤§ãä¼éä¸é«æç C++ è¿è¡æ¶æ¡æ¶ãGoogle åç»åäºä»æ¨èä½¿ç¨åç½®å£°æå°ä¸æ¨èä½¿ç¨åç½®å£°æçè½¬åãä¸ªäººè®¤ä¸ºï¼PIMPL è§£å³çå°±æ¯ C++ ä¸­ä¸¤ä¸ªéè¦ååçç¾çé®é¢ï¼</p>
<ul>
<li>æ¨èä½¿ç¨å¼è¯­ä¹ï¼ä½æ¯ä¼å¼å¥æ´å¤ç¯å¢ä¾èµ</li>
<li>å°è£éè¦å°½å¯è½éèä¸å¿è¦çç»è</li>
</ul>
<p>å¦æä¸¤èåªè½éæ©å¶ä¸­ä¸ä¸ªï¼é£ä¹è¿æ¯å°½éä½¿ç¨å¼è¯­ä¹çååæ´å éè¦ï¼æ¯ç«è¿æ¶åå°å®å¨é®é¢ï¼èèµæºç®¡ççå®å¨é®é¢è´¯ç©¿ C++ ç¨åºçå§ç»ãäºå®ä¸ï¼å¦æä¸æ¯æä¾å¯¹å¤æ¥å£ï¼æèå®ç°æ¯è¾å°ï¼é£ä¹ç´æ¥ä½¿ç¨å¼è¯­ä¹å³å¯ï¼ç¬¬2èä¸­çåå®¹ï¼ââå¼è¯­ä¹æ°¸è¿æ¯æç®æ´å®å¨çå®ç°ã</p>
<p>å¦å¤ï¼å¦æå®ç° C++20 Modules ï¼é£ä¹å°±ä¸å¿è¦ä½¿ç¨ PIMPL äºï¼å®å¨å¯ä»¥åå½å¼è¯­ä¹å®ç°ï¼å ä¸º C++20 Modules å¨è¯­è¨å±é¢å·²ç»å®ç°äº PIMPL çè¯¸å¤ä¼ç¹ã</p>
<h1 id="7-ç¤ºä¾ä»£ç ">7. ç¤ºä¾ä»£ç </h1>
<p>æåæ¾åºç¬èèªå·±å®ç°çåºäº PIMPL çåµå¥å¨çå®æ´ä»£ç ä¾è¯»èåèï¼</p>
<pre><code class="language-cpp">// BgeOnnxEmbedder.h
#pragma once

#include &lt;memory&gt;
#include &lt;string&gt;
#include &lt;vector&gt;

namespace embedding {

namespace hf {
class Tokenizer;
}

class BgeOnnxEmbedder {
 public:
  explicit BgeOnnxEmbedder(const std::string&amp; modelPath,
                           const hf::Tokenizer&amp; tokenizer);
  ~BgeOnnxEmbedder();

  const int64_t&amp; EmbeddingDim() const;

  std::vector&lt;float&gt; Embed(const std::string&amp; text) const;

 private:
  class Impl;  // ååå£°æ
  std::unique_ptr&lt;Impl&gt; impl;
};

}  // namespace embedding
</code></pre>
<pre><code class="language-cpp">//BgeOnnxEmbedder.cpp
#include "BgeOnnxEmbedder.h"

#include &lt;onnxruntime_cxx_api.h&gt;

#include "HfTokenizer.h"
#include "Util/StringEncode.h"

namespace embedding {

class BgeOnnxEmbedder::Impl {
 public:
  Ort::Env&amp; GetOrtEnv() {
    static Ort::Env env(ORT_LOGGING_LEVEL_WARNING, "BgeOnnxEmbedder");
    return env;
  }

  const int64_t&amp; EmbeddingDim() const { return embeddingDim; }

  explicit Impl(const std::string&amp; modelPath, const hf::Tokenizer&amp; tokenizer)
      : session{GetOrtEnv(),
#ifdef _WIN32
                util::StringEncode::Utf8StringToWideString(modelPath).c_str(),
#else
                modelPath.c_str(),
#endif
                Ort::SessionOptions()},
        memInfo{Ort::MemoryInfo::CreateCpu(OrtDeviceAllocator, OrtMemTypeCPU)},
        tokenizer(tokenizer),
        embeddingDim(0) {

    //
    const auto&amp; outputInfo = session.GetOutputTypeInfo(0);
    const auto&amp; tensorInfo = outputInfo.GetTensorTypeAndShapeInfo();
    const auto&amp; shape = tensorInfo.GetShape();

    // åè®¾è¾åºæ¯ [batch, seq, dim] æ [batch, dim]
    // æä»¬åæåä¸ä¸ªé -1 çç»´åº¦
    for (auto it = shape.rbegin(); it != shape.rend(); ++it) {
      if (*it != -1) {
        embeddingDim = *it;
        break;
      }
    }

    if (embeddingDim == 0) {
      throw std::runtime_error(
          "Failed to infer embedding dimension from ONNX model.");
    }
  }

  std::vector&lt;float&gt; Embed(const std::string&amp; text) const {
    hf::Tokenizer::ResultPtr result = tokenizer.Encode(text);
    if (!result) {
      throw std::runtime_error("tokenizer_encode failed");
    }

    // å®ä¹å¼ éç»´åº¦
    int64_t seqLen = static_cast&lt;int64_t&gt;(result-&gt;length);
    std::vector&lt;int64_t&gt; inputShape = {1, seqLen};
    size_t dataByteCount = sizeof(int64_t) * seqLen;

    Ort::Value inputIdsTensor = Ort::Value::CreateTensor(
        memInfo.GetConst(), result-&gt;input_ids, dataByteCount, inputShape.data(),
        inputShape.size(),
        ONNXTensorElementDataType::ONNX_TENSOR_ELEMENT_DATA_TYPE_INT64);

    Ort::Value attentionMaskTensor = Ort::Value::CreateTensor(
        memInfo.GetConst(), result-&gt;attention_mask, dataByteCount,
        inputShape.data(), inputShape.size(),
        ONNXTensorElementDataType::ONNX_TENSOR_ELEMENT_DATA_TYPE_INT64);

    Ort::Value tokenTypeIdsTensor = Ort::Value::CreateTensor(
        memInfo.GetConst(), result-&gt;token_type_ids, dataByteCount,
        inputShape.data(), inputShape.size(),
        ONNXTensorElementDataType::ONNX_TENSOR_ELEMENT_DATA_TYPE_INT64);

    // è¾å¥åå¿é¡»ä¸æ¨¡åå®ä¹ä¸è´
    const char* inputNames[] = {"input_ids", "attention_mask",
                                "token_type_ids"};
    const char* outputNames[] = {"last_hidden_state"};

    // æä¸ä¸ªè¾å¥å¼ éæ¾è¿æ°ç»
    std::vector&lt;Ort::Value&gt; inputs;
    inputs.push_back(std::move(inputIdsTensor));
    inputs.push_back(std::move(attentionMaskTensor));
    inputs.push_back(std::move(tokenTypeIdsTensor));

    // æ§è¡æ¨ç
    auto outputs = session.Run(Ort::RunOptions(),  // è¿è¡éé¡¹ï¼éå¸¸ nullptrï¼
                               inputNames,         // è¾å¥åæ°ç»
                               inputs.data(),  // è¾å¥å¼ éæ°ç»
                               inputs.size(),  // è¾å¥æ°éï¼3ï¼
                               outputNames,    // è¾åºåæ°ç»
                               1               // è¾åºæ°éï¼1ï¼
    );

    // è·åè¾åºä¿¡æ¯
    auto&amp; output_tensor = outputs[0];
    auto output_shape = output_tensor.GetTensorTypeAndShapeInfo().GetShape();
    if (output_shape.size() != 3 || output_shape[0] != 1) {
      throw std::runtime_error("Unexpected output shape");
    }

    // è·åè¾åºå¼ éçåå§ float æé
    const float* outputData = outputs[0].GetTensorData&lt;float&gt;();

    // æå [CLS] token ç embeddingï¼ç¬¬0ä¸ªtokenï¼
    int64_t hiddenSize = output_shape[2];
    std::vector&lt;float&gt; embedding(outputData, outputData + hiddenSize);

    // L2 å½ä¸åï¼BGE è¦æ±ï¼
    float norm = 0.0f;
    for (float v : embedding) norm += v * v;
    norm = std::sqrt(norm);
    if (norm &gt; 1e-8) {
      for (float&amp; v : embedding) v /= norm;
    }

    return embedding;
  }

 private:
  mutable Ort::Session session;
  Ort::MemoryInfo memInfo;
  const hf::Tokenizer&amp; tokenizer;
  int64_t embeddingDim;
};

BgeOnnxEmbedder::BgeOnnxEmbedder(const std::string&amp; modelPath,
                                 const hf::Tokenizer&amp; tokenizer)
    : impl(std::make_unique&lt;Impl&gt;(modelPath, tokenizer)) {}

BgeOnnxEmbedder::~BgeOnnxEmbedder() = default;  // æ­¤æ¶ Impl å·²å®ä¹ï¼å¯å®å¨ææ

const int64_t&amp; BgeOnnxEmbedder::EmbeddingDim() const {
  return impl-&gt;EmbeddingDim();
}

std::vector&lt;float&gt; BgeOnnxEmbedder::Embed(const std::string&amp; text) const {
  return impl-&gt;Embed(text);
}

}  // namespace embedding
</code></pre>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-14 21:28">2026-02-14 21:27</span>&nbsp;
<a href="https://www.cnblogs.com/charlee44">charlee44</a>&nbsp;
éè¯»(<span id="post_view_count">42</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19616660);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19616660', targetLink: 'https://www.cnblogs.com/charlee44/p/19616660', title: 'ä¸ºä»ä¹ç°ä»£ C++ åºé½ç¨ PIMPLï¼ä¸åºå³äºå°è£ãä¾èµä¸å®å¨çæ¼è¿' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ AIç¼ç¨æ¶ä»£æ®éæ¬ç§è®¡ç®æºæ¯ä¸ççåºè·¯ ]]></title>
    <link>https://www.cnblogs.com/xdesigner/p/19615230</link>
    <guid>7fda5fd7f3e6bb4aff5a655016315f4e</guid>
    <description>
    <![CDATA[ 
		<h2>
			<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/xdesigner/p/19615230" title="åå¸äº 2026-02-14 13:36">
    <span role="heading" aria-level="2">AIç¼ç¨æ¶ä»£æ®éæ¬ç§è®¡ç®æºæ¯ä¸ççåºè·¯</span>
    

</a>

		</h2>
		<div class="postText">    <div id="cnblogs_post_description" style="display: none">
        
        AIç¼ç¨å·¥å·å¿«éæ®åï¼æ­£å¨å½»åºæ¹åæ´ä¸ªç¨åºåè¡ä¸çæ ¼å±ä¸å°±ä¸é»è¾ãå¯¹å½åæ°ç¾ä¸ä¸æ¬ãäºæ¬æ®éè®¡ç®æºä¸ä¸çæ¯ä¸çæ¥è¯´ï¼å°±ä¸ç¯å¢å·²ç»åå¾å¼å¸¸æ®é·ï¼é£ä¹åºè·¯å¨åªéï¼
    </div>
<div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><span style="font-size: 18pt">AI<span style="font-family: å®ä½">ç¼ç¨æ¶ä»£</span>æ®éæ¬ç§è®¡ç®æºæ¯ä¸ççåºè·¯</span></p>
<p><span style="font-size: x-large">è¢æ°¸ç¦ 2026-2-14</span></p>
<p><span style="font-size: 18pt">&nbsp; AI<span style="font-family: å®ä½">ç¼ç¨å·¥å·å¿«éæ®åï¼æ­£å¨å½»åºæ¹åæ´ä¸ªç¨åºåè¡ä¸çæ ¼å±ä¸å°±ä¸é»è¾ãå¯¹äº985ï¼211éç¹å¤§å­¦è®¡ç®æºä¸ä¸æ¯ä¸çæ¥è¯´è¿è½åºä»ãä½å¯¹æ°ç¾ä¸ä¸æ¬ãäºæ¬æ®éè®¡ç®æºä¸ä¸çæ¯ä¸çæ¥è¯´ï¼ç¯å¢å·²ç»åå¾å¼å¸¸æ®é·ï¼</span><span style="font-family: Calibri">ToC&nbsp;</span><span style="font-family: å®ä½">ç¨åºåå²ä½æ»éå¿«éæ¶ç¼©ï¼äºèç½å¤§åæäººæ°éå¤§å¹ä¸éï¼</span><span style="font-family: Calibri">ToB&nbsp;</span><span style="font-family: å®ä½">ç¨åºåå²ä½è½ç¶ä¹å¨æ¶ç´§ï¼æäººè§æ¨¡ææåå°ï¼ä½ä¾ç¶ä¿çççå®çå°±ä¸æºä¼ã èå¾å¤å­¦çéæ©çå¨èèå¬ãèç ãèç¼ï¼å¯¹å¤§å¤æ°äººæ¥è¯´æ©å·²ä¸æ¯é è°±åºè·¯ï¼èæ¯ä¸åéé¿ç°å®ãåç¸åèçé®ç¾å¸ãé¢å¯¹å¤§å¿ï¼ææ¸éãä¼åçº§æé«çéæ©éå¸¸æç¡®ï¼æ¥æ±</span><span style="font-family: Calibri">AI</span><span style="font-family: å®ä½">èä¸æ¯æµå¶</span><span style="font-family: Calibri">AI</span><span style="font-family: å®ä½">ï¼ååå©ç¨</span><span style="font-family: Calibri">AI</span><span style="font-family: å®ä½">å¸¦æ¥çææ¯å¹³æï¼ä¼åè¿å¥</span><span style="font-family: Calibri">ToB</span><span style="font-family: å®ä½">é¢åï¼ææå®å®ä¸ä¸ä¸ªé¿æè¡ä¸æ·±åº¦ç»å®ï¼è¿ææ¯æ®éè®¡ç®æºæ¯ä¸çæç°å®ãæå¯æç»­çå°±ä¸è·¯çº¿ã</span></span></p>
<p><span style="font-size: 18pt">&nbsp; ä»å¨çè¡ä¸æ°æ®æ¥çï¼ä¼°è®¡<span style="font-family: å®ä½">å½åå¨çç¨åºåæ»éçº¦</span>2700<span style="font-family: å®ä½">ä¸äººï¼å¶ä¸­&nbsp;</span><span style="font-family: Calibri">ToC&nbsp;</span><span style="font-family: å®ä½">ç¨åºåå</span><span style="font-family: Calibri">ToB&nbsp;</span><span style="font-family: å®ä½">ç¨åºåå¤§çº¦åå ä¸å</span><span style="font-family: å®ä½">ãè¿å»åå å¹´ï¼äºèç½é«éæ©å¼ ï¼</span><span style="font-family: Calibri">ToC&nbsp;</span><span style="font-family: å®ä½">é¢åä¸ç´æ¯å¸çº³ç¨åºåæå¤çæ¹åã</span></span></p>
<p><span style="font-size: 18pt"><span style="font-family: å®ä½">&nbsp; ä½å¨</span>AI<span style="font-family: å®ä½">ä¸è¡ä¸å¨æçåéå²å»ä¸ï¼è¿ä¸ªæ ¼å±æ­£å¨å¿«éåè½¬ã</span><span style="font-family: Calibri">ToC&nbsp;</span><span style="font-family: å®ä½">ç¨åºåçå²ä½æ­£å¨å¤§å¹åå°ã äºèç½å¤§åãçµåãç¤¾äº¤ãå·¥å·ç±»äº§åï¼å¤§éå·¥ä½éä¸­å¨çé¢å¼åãæ¥å£å®ç°ãä¸å¡é»è¾æ¼æ¥ç­éå¤æ§åå®¹ï¼èè¿æ­£æ¯</span><span style="font-family: Calibri">AI</span><span style="font-family: å®ä½">ææé¿æ¿ä»£çé¨åãåå ä¸è¡ä¸éæ¬å¢æï¼ä¼ä¸ä¸åé å äººå¤´åè§æ¨¡ï¼èæ¯ç¨èµæ·±å·¥ç¨å¸éå</span><span style="font-family: Calibri">AI</span><span style="font-family: å®ä½">å·¥å·å®æå·¥ä½ï¼</span><span style="font-family: Calibri">ToC&nbsp;</span><span style="font-family: å®ä½">æ´ä½å²ä½æ°éå¿«éä¸éãå¤§å®¶å¸¸è¯´çâ</span><span style="font-family: Calibri">30</span><span style="font-family: å®ä½">å²å±æºââ</span><span style="font-family: Calibri">35</span><span style="font-family: å®ä½">å²éä¼âï¼å ä¹å¨é¨æ¥èª</span><span style="font-family: Calibri">ToC&nbsp;</span><span style="font-family: å®ä½">è¡ä¸ï¼å ä¸ºè¿éæ¼ææ¬ãæ¼éåº¦ãæ¼å¹´è½»åï¼æ®éå­¦åå¼åèå ä¹æ²¡æé¿æç«äºåã</span></span></p>
<p><span style="font-size: 18pt">&nbsp; ToB&nbsp;<span style="font-family: å®ä½">ç¨åºåçå¤å¢åå®å¨ä¸åã è½ç¶åç»æµç¯å¢å½±åï¼ä¼ä¸ææ°äººçæ°éä¹å¨ä¸éï¼å¥å£æ¯ä»¥åæ´çªï¼ä½å²ä½å¹¶æ²¡ææ¶å¤±ã</span><span style="font-family: Calibri">ToB&nbsp;</span><span style="font-family: å®ä½">é¢åä¼ä¸ãæ¿åºãå»çãéèãå·¥ä¸ãè½æºç­åç´è¡ä¸ï¼æ ¸å¿ä»·å¼å¨äºä¸å¡çè§£ãè¡ä¸è§åãç³»ç»ç¨³å®æ§åå¤æé¡¹ç®è½å°è½åã</span><span style="font-family: Calibri">AI</span><span style="font-family: å®ä½">å¯ä»¥è¾å©ç¼ç ï¼ä½æ æ³æ¿ä»£è¡ä¸ç»éªä¸çå®é¡¹ç®ç§¯ç´¯ãå¨</span><span style="font-family: Calibri">ToB</span><span style="font-family: å®ä½">é¢åï¼</span><span style="font-family: Calibri">35</span><span style="font-family: å®ä½">å²ä¸æ¯å±æºï¼èæ¯é»éå¹´é¾ï¼ç»éªè¶ä¸°å¯è¶ä¸å¯æ¿ä»£ã</span></span></p>
<p><span style="font-size: 18pt"><span style="font-family: å®ä½">&nbsp; æ ¹æ®é¢æµï¼</span>5<span style="font-family: å®ä½">å¹´åå¨çç¨åºåç»æå°åºç°é¢ è¦æ§ååï¼</span><span style="font-family: Calibri">ToC&nbsp;</span><span style="font-family: å®ä½">ç¨åºåä¼ä»ç°å¨ç</span><span style="font-family: Calibri">1800</span><span style="font-family: å®ä½">ä¸åå°1400ä¸å·¦å³</span><span style="font-family: å®ä½">ï¼æ»éæ¥è¿è°æ©ï¼è&nbsp;</span><span style="font-family: Calibri">ToB&nbsp;</span><span style="font-family: å®ä½">ç¨åºåä¼ä»1300</span><span style="font-family: å®ä½">ä¸ç¨³æ­¥å¢é¿å°1700</span><span style="font-family: å®ä½">ä¸å·¦å³ã</span><span style="font-family: å®ä½">è¿ç»æ°æ®ï¼ä¸ºæ®éè®¡ç®æºæ¯ä¸çææäºæç¡®å®çæ¹åã</span></span></p>
<p><span style="font-size: 18pt"><span style="font-family: å®ä½">&nbsp; å¯ç°å®ä¸­ï¼å¤§éä¸æ¬ãäºæ¬å­¦çä¸æ¯ä¸å°±æ¾å¼å°±ä¸ï¼å¨èå¤èãä¸å·¥ä½ãä¸å®ä¹ ãæ æ¶å¥ï¼å®å¨ä¾é å®¶åº­æ¯æï¼çä¸å»æ¯å¨åªåå¥æï¼æ¬è´¨å´éå¸¸æ®é·ï¼èç æåº¦åå·ï¼èå¬å½åçä¸è¶³</span>3%<span style="font-family: å®ä½">ï¼å¨èå¤èæ¬è´¨ä¸å°±æ¯ç¨æä½æ¦ççæ¢¦æ³ï¼æ©çèªå·±ä¸æ¢è¿å¥ç¤¾ä¼çäºå®ï¼æä¸ºä¸åä½é¢ååççåèé®ç¾å¸ã å å¹´</span>åä¸åºæå¤çèä¸ä¸ï¼æè½éåãç»éªç©ºç½ãå¹´é¾åå¤§ï¼æç»æ¢æ²¡ä¸å²¸ï¼ä¹æ²¡å·¥ä½ï¼ä¸¤å¤´è½ç©ºãæ¯ä¸ç§å¯¹èªå·±å¯¹å®¶äººä¸è´è´£ä»»çè¡ä¸ºã</span></p>
<p><span style="font-size: 18pt"><span style="font-family: å®ä½">&nbsp; é¢å¯¹</span>AI<span style="font-family: å®ä½">ç¼ç¨çå¤§è¶å¿ï¼æ­£ç¡®çæåº¦ä¸æ¯ææ§åæµå¶ï¼èæ¯ä¸»å¨æ¥æ±ã</span><span style="font-family: Calibri">AI</span><span style="font-family: å®ä½">å¸¦æ¥äºåææªæçææ¯å¹³æï¼è¿å»éè¦é¿æè®­ç»æè½å·å¤çç¼ç è½åï¼ç°å¨åå©</span><span style="font-family: Calibri">AI</span><span style="font-family: å®ä½">å·¥å·å¯ä»¥å¿«éä¸æãè¿å¯¹åºç¡ä¸è¬ãå­¦åæ®éçå­¦çæ¥è¯´ï¼æ¯å·¨å¤§çæºä¼ââä½ ä¸éè¦æä¸ºé¡¶å°é«æï¼åªè¦ä¼ç¨</span><span style="font-family: Calibri">AI</span><span style="font-family: å®ä½">ãè½è½å°ãæä¸å¡ï¼å°±è½å¨</span><span style="font-family: Calibri">To B</span><span style="font-family: å®ä½">é¢åç«ç¨³èè·</span>&nbsp;</span></p>
<p><span style="font-size: 18pt"><span style="font-family: å®ä½">&nbsp; å æ­¤ï¼æ®éæ¬ç§è®¡ç®æºæ¯ä¸çæé«ä¼åçº§çéæ©ï¼ä¸æ¯æ­»ç£</span>To C<span style="font-family: å®ä½">å¤§åï¼ä¸æ¯èµå½èå¬èç ï¼èæ¯æ¾ä½å§¿æãæ¥ååçèµ·èªï¼ä¼åè¿å¥</span><span style="font-family: Calibri">To B</span><span style="font-family: å®ä½">è¡ä¸ãä¸å¿æ§çäºå¤§ååç¯ï¼ä¸å¿çº ç»äºèµ·ç¹é«ä½ï¼åå¥è¡ãåç§¯ç´¯ãéæ©å»ç</span><span style="font-family: Calibri">IT</span><span style="font-family: å®ä½">ãæ¿å¡ä¿¡æ¯åãå·¥ä¸è½¯ä»¶ãéèåå°ç­é¿æç¨³å®çæ¹åï¼å¨ä¸ä¸ªè¡ä¸ææ ¹</span><span style="font-family: Calibri">3</span><span style="font-family: å®ä½">â</span><span style="font-family: Calibri">5</span><span style="font-family: å®ä½">å¹´ï¼æèªå·±åè¡ä¸æ·±åº¦ç»å®ï¼ç¨ä¸å¡å£åå»ºç«</span><span style="font-family: Calibri">AI</span><span style="font-family: å®ä½">æ æ³æ¿ä»£çç«äºåã</span></span></p>
<p><span style="font-size: 18pt">&nbsp; AI<span style="font-family: å®ä½">æ¶ä»£æ²¡ææ·å¾ï¼åªææç°å®ççå­ç­ç¥ã</span><span style="font-family: Calibri">ToC&nbsp;</span><span style="font-family: å®ä½">å¨æ¶ç¼©ï¼èå¬èç æ¯æ¦çé·é±ï¼å¨èå¤èåªæ¯</span>åè<span style="font-family: å®ä½">é®ç¾å¸ãæ¥æ±</span>AI<span style="font-family: å®ä½">ãç¨å¥½ææ¯å¹³æãåå®å¥å±</span><span style="font-family: Calibri">ToB</span><span style="font-family: å®ä½">ãæ·±èåç´è¡ä¸ï¼ææ¯æ®éè®¡ç®æºæ¯ä¸çå¨æ¶ä»£åå±ä¸­ï¼ææ¸éãç¸å¯¹æå¡å®ï¼èµ°å¾æè¿çåºè·¯ã</span></span></p>

</div>
<div class="clear"></div>
</div>
		<p class="postfoot">
			posted on 
<span id="post-date" data-last-update-days="0.06319444444444444" data-date-updated="2026-02-14 15:07">2026-02-14 13:36</span>&nbsp;
<a href="https://www.cnblogs.com/xdesigner">è¢æ°¸ç¦ çµå­çåï¼å»çä¿¡æ¯å</a>&nbsp;
éè¯»(<span id="post_view_count">228</span>)&nbsp;
è¯è®º(<span id="post_comment_count">2</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19615230);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19615230', targetLink: 'https://www.cnblogs.com/xdesigner/p/19615230', title: 'AIç¼ç¨æ¶ä»£æ®éæ¬ç§è®¡ç®æºæ¯ä¸ççåºè·¯' })">ä¸¾æ¥</a>

		</p>
	 ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Flask - å¸¸è§åºç¨é¨ç½²æ¹æ¡ ]]></title>
    <link>https://www.cnblogs.com/XY-Heruo/p/19615176</link>
    <guid>1d6a7598120a098808fe107484e5ba60</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/XY-Heruo/p/19615176" title="åå¸äº 2026-02-14 13:19">
    <span role="heading" aria-level="2">Flask - å¸¸è§åºç¨é¨ç½²æ¹æ¡</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        å¸¸è§Flaskåºç¨é¨ç½²æ¹æ¡
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="åè¨">åè¨</h2>
<p>å¼åè°è¯é¶æ®µï¼è¿è¡ Flask çæ¹å¼å¤ç´æ¥ä½¿ç¨ <code>app.run()</code>ï¼ä½ Flask åç½®ç WSGI Server çæ§è½å¹¶ä¸é«ãå¯¹äºçäº§ç¯å¢ï¼ä¸è¬ä½¿ç¨ <code>gunicorn</code>ãå¦æèé¡¹ç®å¹¶ä¸éè¦å¤é«çæ§è½ï¼èä¸ç¨äºå¾å¤åè¿ç¨åçå±äº«åéï¼ä½¿ç¨ gunicorn ä¼å½±åä¸åä¼è¯é´çéä¿¡ï¼é£ä¹ä¹å¯ä»¥è¯è¯ç´æ¥ç¨ <code>gevent</code>ã</p>
<p>å¨ Docker æµè¡ä¹åï¼çäº§ç¯å¢é¨ç½² Flask é¡¹ç®å¤ä½¿ç¨ virtualenv + gunicorn + supervisorãDocker æµè¡ä¹åï¼é¨ç½²æ¹å¼å°±æ¢æäº gunicorn + Dockerãå¦ææ²¡æå®¹å¨ç¼ææå¡ï¼åç«¯æå¡åé¢ä¸è¬è¿ä¼æä¸ª nginx åä»£çãå¦æä½¿ç¨ Kubernetesï¼ä¸è¬ä¼ä½¿ç¨ service + ingressï¼æ istio ç­ï¼ã</p>
<h2 id="è¿è¡æ¹å¼">è¿è¡æ¹å¼</h2>
<h3 id="flask-åç½®-wsgi-server">Flask åç½® WSGI Server</h3>
<p>å¼åé¶æ®µä¸è¬ä½¿ç¨è¿ç§è¿è¡æ¹å¼ã</p>
<pre><code class="language-python"># main.py
from flask import Flask
from time import sleep

app = Flask(__name__)

@app.get("/test")
def get_test():
    sleep(0.1)
    return "ok"

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=10000)
</code></pre>
<p>è¿è¡:</p>
<pre><code class="language-bash">python main.py
</code></pre>
<h3 id="gevent">gevent</h3>
<p>ä½¿ç¨ gevent è¿è¡ Flaskï¼éè¦åå®è£ gevent</p>
<pre><code class="language-bash">python -m pip install -U gevent
</code></pre>
<p>ä»£ç éè¦ç¨ä½ä¿®æ¹ã</p>
<p>éè¦æ³¨æ <code>monkey.patch_all()</code> ä¸å®è¦åå¨å¥å£ä»£ç æä»¶çæå¼å¤´é¨åï¼è¿æ · monkey patch æè½çæã</p>
<pre><code class="language-python"># main.py
from gevent import monkey
monkey.patch_all()
import time

from flask import Flask
from gevent.pywsgi import WSGIServer


app = Flask(__name__)


@app.get("/test")
def get_test():
    time.sleep(0.1)
    return "ok"


if __name__ == "__main__":
    server = WSGIServer(("0.0.0.0", 10000), app)
    server.serve_forever()
</code></pre>
<p>è¿è¡</p>
<pre><code class="language-bash">python main.py
</code></pre>
<h3 id="gunicorn--gevent">gunicorn + gevent</h3>
<blockquote>
<p>å¦æç°æé¡¹ç®å¤§éä½¿ç¨åè¿ç¨åçåå­çº§å±äº«åéï¼è´¸ç¶ä½¿ç¨ gunicorn å¤ worker æ¨¡å¼å¯è½ä¼å¯¼è´æ°æ®è®¿é®ä¸ä¸è´çé®é¢ã</p>
</blockquote>
<p>åæ ·éè¦åå®è£ä¾èµã</p>
<pre><code class="language-bash">python -m pip install -U gunicorn gevent
</code></pre>
<p>ä¸åäºåç¬ä½¿ç¨ geventï¼è¿ç§æ¹å¼ä¸éè¦ä¿®æ¹ä»£ç ï¼gunicorn ä¼èªå¨æ³¨å¥ gevent ç monkey patchã</p>
<p>gunicorn å¯ä»¥å¨å½ä»¤è¡éç½®å¯å¨åæ°ï¼ä½ä¸ªäººä¸è¬ä¹ æ¯å¨ gunicorn çéç½®æä»¶åéç½®å¯å¨åæ°ï¼è¿æ ·å¯ä»¥å¨æè®¾ç½®ä¸äºéç½®ï¼èä¸å¯ä»¥ä¿®æ¹æ¥å¿æ ¼å¼ã</p>
<p><code>gunicorn.conf.py</code> çéç½®ç¤ºä¾å¦ä¸ï¼</p>
<pre><code class="language-python"># Gunicorn éç½®æä»¶
from pathlib import Path
from multiprocessing import cpu_count
import gunicorn.glogging
from datetime import datetime

class CustomLogger(gunicorn.glogging.Logger):
    def atoms(self, resp, req, environ, request_time):
        """
        éå atoms æ¹æ³æ¥èªå®ä¹æ¥å¿å ä½ç¬¦
        """
        # è·åé»è®¤çææå ä½ç¬¦æ°æ®
        atoms = super().atoms(resp, req, environ, request_time)
        
        # èªå®ä¹ 't' (æ¶é´æ³) çæ ¼å¼
        now = datetime.now().astimezone()
        atoms['t'] = now.isoformat(timespec="seconds")
        
        return atoms
    

# é¢å è½½åºç¨ä»£ç 
preload_app = True

# å·¥ä½è¿ç¨æ°éï¼éå¸¸æ¯ CPU æ ¸å¿æ°ç 2 åå  1
# workers = int(cpu_count() * 2 + 1)
workers = 4

# ä½¿ç¨ gevent å¼æ­¥ worker ç±»åï¼éå I/O å¯éååºç¨
# æ³¨æï¼gevent worker ä¸ä½¿ç¨ threads åæ°ï¼èæ¯ä½¿ç¨åç¨è¿è¡å¹¶åå¤ç
worker_class = "gevent"

# æ¯ä¸ª gevent worker å¯å¤ççæå¤§å¹¶åè¿æ¥æ°
worker_connections = 2000

# ç»å®å°ååç«¯å£
bind = "127.0.0.1:10001"

# è¿ç¨åç§°
proc_name = "flask-dev"

# PID æä»¶è·¯å¾
pidfile = str(Path(__file__).parent / "tmp" / "gunicorn.pid")

logger_class = CustomLogger
access_log_format = (
    '{"@timestamp": "%(t)s", '
    '"remote_addr": "%(h)s", '
    '"protocol": "%(H)s", '
    '"host": "%({host}i)s", '
    '"request_method": "%(m)s", '
    '"request_path": "%(U)s", '
    '"status_code": %(s)s, '
    '"response_length": %(b)s, '
    '"referer": "%(f)s", '
    '"user_agent": "%(a)s", '
    '"x_tracking_id": "%({x-tracking-id}i)s", '
    '"request_time": %(L)s}'
)

# è®¿é®æ¥å¿è·¯å¾
accesslog = str(Path(__file__).parent / "logs" / "access.log")

# éè¯¯æ¥å¿è·¯å¾
errorlog = str(Path(__file__).parent / "logs" / "error.log")

# æ¥å¿çº§å«
loglevel = "debug"
</code></pre>
<p>è¿è¡ãgunicorn çé»è®¤éç½®æä»¶åå°±æ¯ <code>gunicorn.conf.py</code>ï¼å¦ææä»¶åä¸åï¼å¯ä»¥ä½¿ç¨ <code>-c</code> åæ°æ¥æå®ã</p>
<pre><code class="language-bash">gunicorn main:app
</code></pre>
<h2 id="ä¼ ç»è¿ç¨ç®¡çå®ç°èªå¨å¯å¨">ä¼ ç»è¿ç¨ç®¡çï¼å®ç°èªå¨å¯å¨</h2>
<p>å¨ä¼ ç»æå¡å¨é¨ç½²æ¶ï¼å¸¸è§çè¿ç¨å®æ¤æ¹å¼æï¼</p>
<ol>
<li>éç½® crontab + shell èæ¬ãå®æ¶æ£æ¥è¿ç¨å¨ä¸å¨ï¼ä¸å¨å°±å¯å¨ã</li>
<li>éç½® supervisorã</li>
<li>éç½® systemdã</li>
</ol>
<p>ç±äº <code>supervisor</code> éè¦åç¬å®è£ï¼èæ¬çè½ç¨èªå¸¦å·¥å·å°±ç¨èªå¸¦å·¥å·ãè½å°è£å°±å°è£çååï¼ä¸ªäººä¸è¬ä¸ä¼ä½¿ç¨ supervisorï¼å æ­¤æ¬æä¸ä¼æ¶åå¦ä½ä½¿ç¨ supervisorã</p>
<p>å¨æå¡å¨é¨ç½²æ¶ï¼ä¸è¬ä¹ä¼ä¸ºé¡¹ç®åç¬åå»º Python èæç¯å¢ã</p>
<pre><code class="language-bash"># ä½¿ç¨ Python åç½®ç venvï¼å¨å½åç®å½åå»º Python èæç¯å¢ç®å½ .venv
python3 -m venv .venv
source .venv/bin/activate
python -m pip install -r ./requirements.txt

# å¦æä½¿ç¨uv, ç´æ¥uv sync å³å¯
</code></pre>
<h3 id="crontab--shell-èæ¬-ä¸æ¨èçäº§ç¯å¢">crontab + shell èæ¬ (ä¸æ¨èçäº§ç¯å¢)</h3>
<p>åå¥è¡çæ¶åå¯¹ systemd ä¸çæï¼ç»å¸¸ç¨ crontab + shell èæ¬æ¥å®æ¤è¿ç¨ï¼ç°å¨æ³æ³è¿ç§æ¹å¼å¹¶ä¸åéï¼æ¯è¾èéª shell èæ¬çç¼åæ°´å¹³ï¼éè¦èèæ¹æ¹é¢é¢</p>
<ul>
<li>é¦åè¦ç¡®ä¿ç¨æ·çº§ crontab å¯ç¨ï¼æäºçäº§ç¯å¢ä¼ç¦ç¨ç¨æ·çº§ç crontabï¼èä¸ä¹ä¸åè®¸éä¾¿éç½®ç³»ç»çº§ç crontabã</li>
<li>crontab æ¯åéçº§çï¼æå¡åæ­¢æ¶é´å¯è½è¦ä¸åéã</li>
<li>å¦æææ§å¶å°æ¥å¿ï¼éè¦æå¨å¤çæ¥å¿éå®åï¼è¿ææ¥å¿æä»¶è½®è½¬é®é¢ã</li>
<li>å¦æ ulimit ä¸é«ï¼è¿å¾æ§å¶ ulimitã</li>
<li>ç»å¸¸åºç°åµå°¸è¿ç¨ï¼shell èæ¬æ¥è¦åä¸å ç¶ææ£æ¥çé»è¾ã</li>
</ul>
<p>å¦æåªéè¦ç®åç¨ç¨ï¼ä¹å¯ä»¥æä¾ä¸ªç¤ºä¾</p>
<pre><code class="language-bash">#!/bin/bash

# ç¯å¢éç½®
export FLASK_ENV="production"
export DATABASE_URL="postgresql://user:pass@localhost:5432/mydb"
export REDIS_URL="redis://localhost:6379/0"

script_dir=$(cd $(dirname $0) &amp;&amp; pwd)
app_name="gunicorn"  # å®éè¿ç¨åæ¯ gunicornï¼ä¸æ¯ Flask app
wsgi_module="wsgi:app"  # æ¿æ¢ WSGI å¥å£
socket_path="${script_dir}/myapp.sock"  # Unix Socket è·¯å¾ï¼é¿å /run éå¯ä¸¢å¤±ï¼
log_file="${script_dir}/app.log"
pid_file="${script_dir}/gunicorn.pid"   # ç¨ PID æä»¶æ§å¶

# è¿ç¨æ£æµ
is_running() {
    if [ -f "$pid_file" ]; then
        pid=$(cat "$pid_file")
        if ps -p "$pid" &gt; /dev/null 2&gt;&amp;1 &amp;&amp; grep -q "gunicorn.*${wsgi_module}" /proc/"$pid"/cmdline 2&gt;/dev/null; then
            echo "Gunicorn (PID: $pid) is running"
            return 0
        else
            rm -f "$pid_file"  # æ¸çå¤±æ PID
            echo "Stale PID file found, cleaned up"
            return 1
        fi
    else
        # å¤ç¨æ£æµï¼éè¿ socket æä»¶ + è¿ç¨å
        if [ -S "$socket_path" ] &amp;&amp; pgrep -f "gunicorn.*${wsgi_module}" &gt; /dev/null 2&gt;&amp;1; then
            echo "Gunicorn is running (detected by socket)"
            return 0
        fi
        echo "Gunicorn is not running"
        return 1
    fi
}

# å¯å¨åºç¨
start_app() {
    is_running
    if [ $? -eq 0 ]; then
        echo "Already running, skip start"
        return 0
    fi

    echo "Starting Gunicorn at $(date)"
    echo "Socket: $socket_path"
    echo "Log: $log_file"

    # ç¡®ä¿ socket ç®å½å­å¨
    mkdir -p "$(dirname "$socket_path")"

    # å¯å¨å½ä»¤ï¼å³é®ï¼ä¸å  --daemonï¼ç¨ nohup æç®¡ï¼
    cd "$script_dir" || exit 1
    # çæ PID æä»¶
    nohup "$script_dir/venv/bin/gunicorn" \
        --workers 3 \
        --bind "unix:$socket_path" \
        --pid "$pid_file" \
        --access-logfile "$log_file" \
        --error-logfile "$log_file" \
        --log-level info \
        "$wsgi_module" &gt; /dev/null 2&gt;&amp;1 &amp;

    # ç­å¾å¯å¨å®æ
    sleep 2
    if is_running; then
        echo "â Start success (PID: $(cat "$pid_file" 2&gt;/dev/null))"
        return 0
    else
        echo "â Start failed, check $log_file"
        return 1
    fi
}

# åæ­¢åºç¨
stop_app() {
    is_running
    if [ $? -eq 1 ]; then
        echo "Not running, skip stop"
        return 0
    fi

    pid=$(cat "$pid_file" 2&gt;/dev/null)
    echo "Stopping Gunicorn (PID: $pid) gracefully..."

    # åå SIGTERMï¼ä¼éåæ­¢ï¼
    kill -15 "$pid" 2&gt;/dev/null || true
    sleep 5

    # æ£æ¥æ¯å¦è¿å¨è¿è¡
    if ps -p "$pid" &gt; /dev/null 2&gt;&amp;1; then
        echo "Still running after 5s, force killing..."
        kill -9 "$pid" 2&gt;/dev/null || true
        sleep 2
    fi

    # æ¸çæ®ç
    rm -f "$pid_file" "$socket_path"
    echo "â Stopped"
}

# éå¯åºç¨
restart_app() {
    echo "Restarting Gunicorn..."
    stop_app
    sleep 1
    start_app
}

# å¥å£å½æ°
main() {
    # æ£æ¥ Gunicorn æ¯å¦å­å¨
    if [ ! -f "$script_dir/venv/bin/gunicorn" ]; then
        echo "ERROR: Gunicorn not found at $script_dir/venv/bin/gunicorn"
        echo "Hint: Did you activate virtualenv? (source venv/bin/activate)"
        exit 1
    fi

    local action=${1:-start}  # é»è®¤å¨ä½ï¼start

    case "$action" in
        start)
            start_app
            ;;
        stop)
            stop_app
            ;;
        restart)
            restart_app
            ;;
        status)
            is_running
            ;;
        cron-check)
            # ä¸ä¸º crontab è®¾è®¡ï¼åªæ£æ¥+éå¯ï¼ä¸è¾åºå¹²æ°æ¥å¿
            if ! is_running &gt; /dev/null 2&gt;&amp;1; then
                echo "[$(date '+%F %T')] CRON: Gunicorn down, auto-restarting..." &gt;&gt; "$log_file"
                start_app &gt;&gt; "$log_file" 2&gt;&amp;1
            fi
            ;;
        *)
            echo "Usage: $0 {start|stop|restart|status|cron-check}"
            echo "  cron-check: Silent mode for crontab (logs to app.log only)"
            exit 1
            ;;
    esac
}

main "$@"
</code></pre>
<p>æå¨è¿è¡æµè¯</p>
<pre><code class="language-bash">bash app_ctl.sh start
</code></pre>
<p>éç½® crontab</p>
<pre><code># ç¼è¾å½åç¨æ· crontab
crontab -e

# æ·»å ä»¥ä¸è¡ï¼æ¯åéæ£æ¥ä¸æ¬¡ï¼
* * * * * /opt/myflaskapp/app_ctl.sh cron-check &gt;/dev/null 2&gt;&amp;1
</code></pre>
<p>éç½®logrotate</p>
<pre><code># /etc/logrotate.d/myflaskapp
/opt/myflaskapp/app.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    copytruncate  # é¿å Gunicorn ä¸¢å¤±æä»¶å¥æ
}
</code></pre>
<h3 id="systemd-æ¨èçäº§ç¯å¢ä½¿ç¨">systemd (æ¨èçäº§ç¯å¢ä½¿ç¨)</h3>
<ol>
<li>åå»º systemd æå¡æä»¶</li>
</ol>
<pre><code class="language-bash">sudo vim /etc/systemd/system/myflaskapp.service
</code></pre>
<ol start="2">
<li>ç¤ºä¾å¦ä¸</li>
</ol>
<pre><code class="language-ini">[Unit]
Description=Gunicorn instance for Flask App
After=network.target

[Service]
User=www-data
Group=www-data
WorkingDirectory=/path/to/your/app
Environment="PATH=/path/to/venv/bin"
ExecStart=/path/to/venv/bin/gunicorn \
          --workers 4 \
          --bind unix:/run/myapp.sock \
          --access-logfile - \
          --error-logfile - \
          wsgi:app

# ç¦æ­¢æ·»å  --daemonï¼systemd éç´æ¥çæ§ä¸»è¿ç¨
Restart=on-failure        # ä»å¼å¸¸éåºæ¶éå¯ï¼é0ç¶æç ãè¢«ä¿¡å·ææ­»ç­ï¼
RestartSec=5s             # éå¯åç­å¾5ç§
StartLimitInterval=60s    # 60ç§å
StartLimitBurst=5         # æå¤éå¯5æ¬¡ï¼é²éªå´©
TimeoutStopSec=30         # åæ­¢æ¶ç­å¾30ç§ï¼ä¼éå³é­ï¼

# å®å¨å åº
PrivateTmp=true
NoNewPrivileges=true
ProtectSystem=strict
ReadWritePaths=/run /var/log/myapp

[Install]
WantedBy=multi-user.target
</code></pre>
<ol start="3">
<li>è®¾ç½®å¼æºèªå¯å¹¶å¯å¨æå¡</li>
</ol>
<pre><code class="language-bash">sudo systemctl daemon-reload
sudo systemctl enable myflaskapp    # å¼æºèªå¯
sudo systemctl start myflaskapp
</code></pre>
<p>å¯ä»¥è¯è¯ç¨<code>kill -9</code>åæ­¢åç«¯æå¡è¿ç¨ï¼è§å¯è½å¦è¢«éæ°æèµ·ã</p>
<blockquote>
<p>æ³¨æï¼<code>kill -15</code>ç®æ¯æ­£å¸¸åæ­¢ï¼ä¸ç®å¼å¸¸éåºã</p>
</blockquote>
<h2 id="docker-é¨ç½²æ¹æ¡">Docker é¨ç½²æ¹æ¡</h2>
<ol>
<li>DockerfileãPython é¡¹ç®éå¸¸ä¸éè¦å¤é¶æ®µæå»ºï¼åé¶æ®µå³å¯ã</li>
</ol>
<pre><code class="language-dockerfile">FROM python:3.11-slim-bookworm

# å®å¨å åº
## åå»ºé root ç¨æ·ï¼é¿åä½¿ç¨ nobodyï¼æéå¤ªåéï¼
RUN useradd -m -u 1000 appuser &amp;&amp; \
    # å®è£è¿è¡æ¶å¿éçç³»ç»åºï¼éç¼è¯å·¥å·ï¼
    apt-get update &amp;&amp; apt-get install -y --no-install-recommends \
        libgomp1 \
        libpq5 \
        libsqlite3-0 \
        &amp;&amp; rm -rf /var/lib/apt/lists/* \
        &amp;&amp; apt-get autoremove -y \
        &amp;&amp; apt-get clean

# Python ä¼å
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PIP_NO_CACHE_DIR=1 \
    PIP_DISABLE_PIP_VERSION_CHECK=1

WORKDIR /app

# å©ç¨ Docker å±ç¼å­ï¼åå¤å¶ requirements
COPY requirements.txt .
RUN pip install --no-cache-dir --prefer-binary -r requirements.txt \
    # æ¸ç pip ç¼å­ï¼è½ç¶ --no-cache-dir å·²ç¦ç¨ï¼ä½ä¿é©èµ·è§ï¼
    &amp;&amp; rm -rf /root/.cache

# åºç¨ä»£ç 
COPY --chown=appuser:appuser . .

# ä½¿ç¨érootç¨æ·è¿è¡
USER appuser

# å¯å¨
EXPOSE 8000
CMD ["gunicorn", "--config", "config/gunicorn.conf.py", "wsgi:app"]
</code></pre>
<ol start="2">
<li>ç¼å docker-compose.yaml</li>
</ol>
<pre><code class="language-yaml">services:
  web:
    image: myflaskapp:latest
    container_name: flask_web
    # ç«¯å£æ å°
    ## å¦æ nginx ä¹ä½¿ç¨ Docker é¨ç½²ï¼èä¸ä½¿ç¨åä¸ä¸ªç½ç»éç½®ï¼åå¯ä»¥ä¸åç«¯å£æ å°
    ports:
      - "8000:8000"
    # ç¯å¢åé
    environment:
      - FLASK_ENV=production
      - DATABASE_URL=postgresql://user:pass@db:5432/mydb
      - REDIS_URL=redis://redis:6379/0
    # å¥åº·æ£æ¥
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s      # æ¯ 30 ç§æ£æ¥ä¸æ¬¡
      timeout: 5s        # è¶æ¶ 5 ç§
      start_period: 15s  # å¯å¨å 15 ç§å¼å§æ£æ¥ï¼ç»åºç¨åå§åæ¶é´ï¼
      retries: 3         # å¤±è´¥éè¯ 3 æ¬¡åæ è®° unhealthy
    
    # èªå¨éå¯ç­ç¥
    restart: unless-stopped  # always / on-failure / unless-stopped
    
    # èµæºéå¶
    deploy:
      resources:
        limits:
          cpus: '2'        # æå¤ 2 ä¸ª CPU
          memory: 1G       # æå¤ 1GB åå­
        reservations:
          cpus: '0.5'      # ä¿ç 0.5 ä¸ª CPU
          memory: 256M     # ä¿ç 256MB åå­
    
    # ulimit éå¶ï¼é²èµæºæ»¥ç¨ï¼
    ulimits:
      nproc: 65535       # æå¤§è¿ç¨æ°
      nofile:
        soft: 65535      # æå¼æä»¶æ°è½¯éå¶
        hard: 65535      # æå¼æä»¶æ°ç¡¬éå¶
      core: 0            # ç¦æ­¢ core dump
    
    # å®å¨å åº
    security_opt:
      - no-new-privileges:true  # ç¦æ­¢ææ
    
    # åªè¯»æä»¶ç³»ç»ï¼é¤ /tmp å¤ï¼
    read_only: true
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=100m
    
    # å·æè½½ï¼æ¥å¿ãä¸´æ¶æä»¶ï¼
    volumes:
      - ./logs:/app/logs:rw
      # - ./static:/app/static:ro  # éææä»¶ï¼å¯éï¼
    
    # ç½ç»
    networks:
      - app-network
        
# ç½ç»éç½®
networks:
  app-network:
    driver: bridge

# å·éç½®
volumes:
  db_data:
    driver: local
  redis_data:
    driver: local
</code></pre>
<h2 id="kubernetes-é¨ç½²æ¹æ¡">Kubernetes é¨ç½²æ¹æ¡</h2>
<h3 id="deployment">Deployment</h3>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: flask-app
  namespace: default
  labels:
    app: flask-app
    tier: backend
spec:
  replicas: 3
  selector:
    matchLabels:
      app: flask-app
  template:
    metadata:
      labels:
        app: flask-app
        tier: backend
    spec:
      securityContext:
        runAsNonRoot: true      # ç¦æ­¢ root è¿è¡
        runAsUser: 1000         # ä½¿ç¨é root ç¨æ·
        runAsGroup: 1000
        fsGroup: 1000
        seccompProfile:
          type: RuntimeDefault  # å¯ç¨ seccomp å®å¨ç­ç¥
      containers:
      - name: flask-app
        image: myregistry.com/myflaskapp:1.0.0
        imagePullPolicy: IfNotPresent  # çäº§ç¯å¢å»ºè®®ç¨ Always
        ports:
        - name: http
          containerPort: 8000
          protocol: TCP
        env:
        - name: FLASK_ENV
          value: "production"
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: flask-app-secrets
              key: database-url
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: flask-app-secrets
              key: redis-url
        - name: SECRET_KEY
          valueFrom:
            secretKeyRef:
              name: flask-app-secrets
              key: secret-key
        resources:
          requests:
            memory: "256Mi"
            cpu: "100m"
          limits:
            memory: "512Mi"   # è¶è¿ä¼ OOM Kill
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
            scheme: HTTP
          initialDelaySeconds: 30  # å¯å¨å 30 ç§å¼å§æ£æ¥
          periodSeconds: 10        # æ¯ 10 ç§æ£æ¥ä¸æ¬¡
          timeoutSeconds: 3        # è¶æ¶ 3 ç§
          successThreshold: 1
          failureThreshold: 3      # å¤±è´¥ 3 æ¬¡åéå¯å®¹å¨
        readinessProbe:
          httpGet:
            path: /health
            port: 8000
            scheme: HTTP
          initialDelaySeconds: 10  # å¯å¨å 10 ç§å¼å§æ£æ¥
          periodSeconds: 5         # æ¯ 5 ç§æ£æ¥ä¸æ¬¡
          timeoutSeconds: 2
          successThreshold: 1
          failureThreshold: 3      # å¤±è´¥ 3 æ¬¡åä» Service ç§»é¤
        startupProbe:
          httpGet:
            path: /health
            port: 8000
            scheme: HTTP
          failureThreshold: 30     # æå¤éè¯ 30 æ¬¡
          periodSeconds: 5         # æ¯ 5 ç§ä¸æ¬¡ï¼å± 150 ç§å®¹å¿æ¢å¯å¨
          timeoutSeconds: 3
        securityContext:
          allowPrivilegeEscalation: false  # ç¦æ­¢ææ
          readOnlyRootFilesystem: true     # æ ¹æä»¶ç³»ç»åªè¯»
          capabilities:
            drop:
            - ALL                          # å é¤ææ Linux capabilities
          privileged: false
        volumeMounts:
        - name: tmp-volume
          mountPath: /tmp
        - name: config-volume
          mountPath: /app/config
          readOnly: true
      imagePullSecrets:
      - name: registry-secret  # å¦æä½¿ç¨ç§æéåä»åº
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app
                  operator: In
                  values:
                  - flask-app
              topologyKey: kubernetes.io/hostname  # é¿åææ Pod è°åº¦å°åä¸èç¹
      volumes:
      - name: tmp-volume
        emptyDir:
          medium: Memory  # ä½¿ç¨åå­å·ï¼æ´å¿«
          sizeLimit: 100Mi
      - name: config-volume
        configMap:
          name: flask-app-config
</code></pre>
<h3 id="service">Service</h3>
<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: flask-app-service
  namespace: default
  labels:
    app: flask-app
    tier: backend
spec:
  type: ClusterIP
  selector:
    app: flask-app
  ports:
  - name: http
    port: 80        # Service ç«¯å£
    targetPort: 8000  # Pod ç«¯å£
    protocol: TCP
</code></pre>
<h3 id="ingress-nginx">ingress-nginx</h3>
<pre><code class="language-yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: flask-app-ingress
  namespace: default
  annotations:
    # ==================== Nginx éç½® ====================
    kubernetes.io/ingress.class: "nginx"
    
    # å¯ç¨ HTTPS éå®å
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    
    # éæµï¼æ¯ç§ 10 ä¸ªè¯·æ±ï¼çªå 20ï¼
    nginx.ingress.kubernetes.io/limit-rps: "10"
    nginx.ingress.kubernetes.io/limit-burst-multiplier: "2"
    
    # å®¢æ·ç«¯çå® IP
    nginx.ingress.kubernetes.io/enable-real-ip: "true"
    nginx.ingress.kubernetes.io/proxy-real-ip-cidr: "0.0.0.0/0"
    
    # è¿æ¥è¶æ¶
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    
    # ç¼å²åºå¤§å°
    nginx.ingress.kubernetes.io/proxy-buffering: "on"
    nginx.ingress.kubernetes.io/proxy-buffer-size: "16k"
    nginx.ingress.kubernetes.io/proxy-buffers-number: "4"
    
    # Gzip åç¼©
    nginx.ingress.kubernetes.io/enable-gzip: "true"
    nginx.ingress.kubernetes.io/gzip-level: "6"
    nginx.ingress.kubernetes.io/gzip-min-length: "1024"
    nginx.ingress.kubernetes.io/gzip-types: "text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript"
    
    # å®å¨å¤´
    nginx.ingress.kubernetes.io/configuration-snippet: |
      add_header X-Frame-Options "SAMEORIGIN" always;
      add_header X-Content-Type-Options "nosniff" always;
      add_header X-XSS-Protection "1; mode=block" always;
      add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # è®¤è¯
    # nginx.ingress.kubernetes.io/auth-type: basic
    # nginx.ingress.kubernetes.io/auth-secret: flask-app-basic-auth
    # nginx.ingress.kubernetes.io/auth-realm: "Authentication Required"
    
    # èªå®ä¹éè¯¯é¡µé¢
    # nginx.ingress.kubernetes.io/custom-http-errors: "404,500,502,503,504"
    # nginx.ingress.kubernetes.io/default-backend: custom-error-pages
    
    # éåç®æ 
    # nginx.ingress.kubernetes.io/rewrite-target: /$1
    
    # WAFï¼å¦æå®è£äº ModSecurityï¼
    # nginx.ingress.kubernetes.io/enable-modsecurity: "true"
    # nginx.ingress.kubernetes.io/modsecurity-snippet: |
    #   SecRuleEngine On
    #   SecRequestBodyAccess On

spec:
  tls:
  - hosts:
    - flask.example.com
    secretName: flask-app-tls-secret  # TLS è¯ä¹¦ Secret

  rules:
  - host: flask.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: flask-app-service
            port:
              number: 80
</code></pre>


</div>
<div id="MySignature" role="contentinfo">
    <p>æ¬ææ¥èªåå®¢å­ï¼ä½èï¼<a href="https://www.cnblogs.com/XY-Heruo/" target="_blank">è±ééä½ç°</a>ï¼è½¬è½½è¯·æ³¨æåæé¾æ¥ï¼<a href="https://www.cnblogs.com/XY-Heruo/p/19615176" target="_blank">https://www.cnblogs.com/XY-Heruo/p/19615176</a></p>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-14 13:20">2026-02-14 13:19</span>&nbsp;
<a href="https://www.cnblogs.com/XY-Heruo">è±ééä½ç°</a>&nbsp;
éè¯»(<span id="post_view_count">69</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19615176);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19615176', targetLink: 'https://www.cnblogs.com/XY-Heruo/p/19615176', title: 'Flask - å¸¸è§åºç¨é¨ç½²æ¹æ¡' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ âFatal error: require(): Failed opening required...â ä»¥åå¦ä½å½»åºé¿åå®åæ¬¡åºç° ]]></title>
    <link>https://www.cnblogs.com/catchadmin/p/19614589</link>
    <guid>40b642f78e544658206e05caf53ad66c</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/catchadmin/p/19614589" title="åå¸äº 2026-02-14 09:22">
    <span role="heading" aria-level="2">âFatal error: require(): Failed opening required...â ä»¥åå¦ä½å½»åºé¿åå®åæ¬¡åºç°</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="fatal-error-require-failed-opening-required-ä»¥åå¦ä½å½»åºé¿åå®åæ¬¡åºç°">âFatal error: require(): Failed opening required...â ä»¥åå¦ä½å½»åºé¿åå®åæ¬¡åºç°</h1>
<p>åæ¨ä¸¤ç¹ï¼å¼ç­åè­¦åäºãçäº§ç¯å¢ API å¼å§æ¥ 500ï¼èä¸åªåºç°å¨æ°æ©å®¹çèç¹ä¸ãä½ æå¼æ¥å¿ï¼çæååºç¼çæ¥éè·³äºåºæ¥ï¼</p>
<p>æ¬å°ä¸åæ­£å¸¸ï¼æµè¯ç¯å¢ä¹æ²¡é®é¢ãä½å¨äºåçé¨ç½²è¿ç§âç¯å¢éæ¶ååâçç°å®éï¼ä¸ä¸ªçèµ·æ¥ä¸èµ·ç¼çè·¯å¾å·®å¼ï¼å°±è¶³ä»¥ææå¡ç´æ¥æè¶´ã</p>
<p>è¿å¹¶ä¸æ¯ä»ä¹âæ°æå¤±è¯¯âï¼èæ¯å¾å¤äººå¯¹ PHP æåºç¡è½åââæä»¶å è½½æºå¶ââçè§£ä¸å¤æ·±å¥å¯¼è´çç³»ç»æ§é®é¢ã</p>
<p>æ©æ PHP æ¶ä»£ï¼æä»¬æ <code>include</code> å <code>require</code> å½ç§¯æ¨ç¨æ¥æ¼é¡µé¢ãå°äº PHP 8.2+ãComposerãå®¹å¨åå¾®æå¡çä»å¤©ï¼è¿ç»å½æ°ä»ç¶å¨å¼ææ ¸å¿ä½ç½®ãä½ç°å®ä¸­ï¼å¾å¤å¼åèä¾æ§æå®ä»¬å½æâè®¾å®å°±ä¸ç¨ç®¡âçå·¥å·ã</p>
<p>å¦æä½ æ³ä»âåèæ¬âèµ°åâåç¨³å®ç³»ç»âï¼å°±å¿é¡»ææ¸æ¥ï¼å½ä¸ä¸ªæä»¶è¢«å è½½è¿å¦ä¸ä¸ªæä»¶æ¶ï¼åºå±å°åºåçäºä»ä¹ã</p>
<p>è¿ç¯æç« ä¼ä»è¿è¡æºå¶ãçº¿ä¸å¸¸è§ååå·¥ç¨å®è·µä¸å±ï¼è®²æ¸æ¥ææ ·æ PHP æä»¶å è½½åå°è¶³å¤ç¨³ã</p>
<h2 id="åºå±å°åºå¨åçä»ä¹">åºå±å°åºå¨åçä»ä¹ï¼</h2>
<p>å½ä½ æ§è¡ <code>include 'file.php'</code>ï¼å¹¶ä¸æ¯âå¤å¶ç²è´´ä»£ç âè¿ä¹ç®åãPHP å®éä¸ä¼è®©å½åæ§è¡æµç¨æåï¼åæ¢å°ç®æ æä»¶ï¼æå®ç¼è¯ä¸ºæä½ç ï¼åå¨å½åä½ç¨åéæ§è¡ã</p>
<h3 id="æä»¶å è½½çåç§å½¢å¼">æä»¶å è½½çåç§å½¢å¼</h3>
<p>PHP æåç§ä¸»å è½½æ¹å¼ï¼å®ä»¬ä¸æ¯è¯­æ³ç³ï¼èæ¯è¡ä¸ºå·®å¼ï¼</p>
<ul>
<li><code>include</code>ï¼æ¸©åæ¨¡å¼ãæä»¶ä¸å­å¨æ¶æ <code>Warning</code>ï¼èæ¬ç»§ç»­æ§è¡ã</li>
<li><code>require</code>ï¼å¼ºå¶æ¨¡å¼ãæä»¶ä¸å­å¨æ¶ç´æ¥è´å½éè¯¯å¹¶ä¸­æ­æ§è¡ã</li>
<li><code>include_once</code> / <code>require_once</code>ï¼å¨åä¸¤èåºç¡ä¸å¢å âæ¯å¦å·²å è½½âæ£æ¥ï¼é¿åéå¤å£°æã</li>
</ul>
<p>çè§£è¿ä¸ªå·®å¼éå¸¸å³é®ï¼å¨ç°ä»£ä¸å¡ç³»ç»éï¼å¾å¤æ ¸å¿ä¾èµä¸æ¦ç¼ºå¤±ï¼ä¸åºè¯¥âå¸¦ä¼¤ç»§ç»­è·âã</p>
<h3 id="ä¸ä¸ªæ´å®ç¨çå¿æºæ¨¡åä½ç¨åæ³¨å¥å¨">ä¸ä¸ªæ´å®ç¨çå¿æºæ¨¡åï¼ä½ç¨åæ³¨å¥å¨</h3>
<p>å¯ä»¥ææä»¶å è½½çè§£æâä½ç¨åæ³¨å¥å¨âï¼</p>
<ul>
<li>å¨å½æ°åé¨ <code>include</code>ï¼è¢«å è½½æä»¶éå®ä¹çåéåªå¨è¯¥å½æ°ä½ç¨åå¯è§ã</li>
<li>å¨èæ¬é¡¶å± <code>include</code>ï¼åéä¼è¿å¥å¨å±ä½ç¨åã</li>
</ul>
<p>å¦å¤ï¼å¾å¤äººè¯¯å¤æ§è½ç¶é¢ãçæ­£éçéå¸¸ä¸æ¯ä»£ç æ§è¡æ¬èº«ï¼èæ¯æä»¶ç¶ææ£æ¥ï¼stat è°ç¨ï¼ï¼</p>
<p>æ¯æ¬¡ <code>include</code>ï¼PHP é½è¦åæä½ç³»ç»ç¡®è®¤ï¼æä»¶æ¯å¦å­å¨ãæéæ¯å¦å¯è¯»ãæåä¿®æ¹æ¶é´ç­ãå¨é«å¹¶å API ä¸­ï¼è¿ä¸ªå¨ä½æ¯ç§æåä¸ä¸æ¬¡æ¶ï¼å¼éä¼éå¸¸ææ¾ã</p>
<h2 id="php-æ¯å¦ä½è§£æè·¯å¾ç">PHP æ¯å¦ä½è§£æè·¯å¾ç</h2>
<p>å½ä½ å <code>include 'utils.php';</code> è¿ç§ç¸å¯¹è·¯å¾æ¶ï¼PHP ä¼ä¾æ¬¡å°è¯ï¼</p>
<ul>
<li>å½åèæ¬ç®å½</li>
<li><code>php.ini</code> ä¸­ <code>include_path</code> æå®çç®å½</li>
<li>å½åå·¥ä½ç®å½ï¼cwdï¼</li>
</ul>
<p>é®é¢å°±åºå¨è¿éï¼å®æç¯å¢ä¾èµã</p>
<p>æ¯å¦ä½ çå½ä»¤è¡ä»»å¡è¿ç¨å·¥ä½ç®å½æ¯ <code>/var/www/</code>ï¼è Web è¿ç¨å·¥ä½ç®å½æ¯ <code>/var/www/public/</code>ï¼åä¸è¡ç¸å¯¹è·¯å¾ä»£ç å¯è½ä¸ä¸ªè½è·ãä¸ä¸ªç´æ¥å´©ã</p>
<h2 id="æå®¹ææçº¿ä¸æå´©ç-5-ç±»éè¯¯">æå®¹ææçº¿ä¸æå´©ç 5 ç±»éè¯¯</h2>
<p>è¿äºæ¯æå¨éçé¡¹ç®éæéåå¤è§å°çé«é¢é®é¢ã</p>
<h3 id="ç¸å¯¹è·¯å¾é·é±">ç¸å¯¹è·¯å¾é·é±</h3>
<p><strong>éè¯¯åæ³</strong>ï¼<code>include 'includes/header.php';</code></p>
<p><strong>ä¸ºä»ä¹ä¼åç</strong>ï¼æ¬å°å¯å¨ç®å½åå¥½æ¯é¡¹ç®æ ¹ç®å½ï¼æä»¥ä¸ç´âçèµ·æ¥æ­£å¸¸âã</p>
<p><strong>çº¿ä¸åæ</strong>ï¼ä¸æ¦è¢«å­ç®å½è°ç¨ãè¢«å®æ¶ä»»å¡è°ç¨ï¼æèå¥å£ç®å½åäºï¼è·¯å¾ä¸ä¸æå°±åäºãè¿æ¯âææ¬å°æ²¡é®é¢âç±»äºæçå¤´å·æ¥æºã</p>
<h3 id="_once-çæ§è½ç¨"><code>_once</code> çæ§è½ç¨</h3>
<p><strong>éè¯¯åæ³</strong>ï¼å¨é«é¢å¾ªç¯éå¤§éä½¿ç¨ <code>require_once</code>ã</p>
<p><strong>ä¸ºä»ä¹ä¼åç</strong>ï¼æå¿ <code>Cannot redeclare class</code> ä¹ç±»çéå¤å£°æã</p>
<p><strong>çº¿ä¸åæ</strong>ï¼æ¯æ¬¡ <code>_once</code> é½ä¼è§¦åå·²å è½½è¡¨æ£æ¥ãPHP 8 è½ç¶ä¼åäºå¾å¤ï¼ä½å®ä¾ç¶æ¯ç´ <code>require</code> æ¢ãä¾èµå³ç³»æ¸æ°çæ¨¡ååç³»ç»ï¼ä¸è¯¥é¿æä¾èµå¼æâäºæ¬¡ç¡®è®¤âã</p>
<h3 id="ç¨--ææ¥ééé³">ç¨ <code>@</code> ææ¥ééé³</h3>
<p><strong>éè¯¯åæ³</strong>ï¼<code>@include 'optional_config.php';</code></p>
<p><strong>ä¸ºä»ä¹ä¼åç</strong>ï¼æ³çæ <code>if (file_exists(...))</code> çæ¾å¼å¤æ­ã</p>
<p><strong>çº¿ä¸åæ</strong>ï¼ä½ æçæ­£é®é¢èèµ·æ¥äºãæä»¶è¯»åå¤±è´¥å¯è½ä¸æ¯âæä»¶ä¸å­å¨âï¼èæ¯æéä¸å¯¹ï¼å¦ <code>chmod</code>ï¼ãæ¥éè¢«åæåï¼æéæ¶é´ä¼ä» 5 åéæå°å å°æ¶ã</p>
<h3 id="å¨æ-include-å¼åè·¯å¾ç©¿è¶">å¨æ include å¼åè·¯å¾ç©¿è¶</h3>
<p><strong>éè¯¯åæ³</strong>ï¼<code>include $_GET['page'] . '.php';</code></p>
<p><strong>ä¸ºä»ä¹ä¼åç</strong>ï¼å¾çäºåâå¨æè·¯ç±âã</p>
<p><strong>çº¿ä¸åæ</strong>ï¼ä¸¥éå®å¨é£é©ãæ»å»èå¯æé  <code>../../../../etc/passwd</code>ï¼æå©ç¨ <code>php://filter/...</code> è¯»åææéç½®ãå³ä½¿å³é­è¿ç¨ URL å è½½ï¼æ¬å°æä»¶åæ ·ä¼è¢«æ»å»ã</p>
<h3 id="å è½½å¸¦å¯ä½ç¨çæä»¶">å è½½å¸¦å¯ä½ç¨çæä»¶</h3>
<p><strong>éè¯¯åæ³</strong>ï¼ä¸ä¸ªæä»¶æ¢å®ä¹ç±»ï¼åç´æ¥æ§è¡é»è¾ï¼è¾åº HTMLãè¿æ°æ®åºç­ï¼ã</p>
<p><strong>ä¸ºä»ä¹ä¼åç</strong>ï¼åå²ä»£ç éèè´£è¾¹çæ²¡åæ¸ã</p>
<p><strong>çº¿ä¸åæ</strong>ï¼æµè¯å ä¹æ²¡æ³åãä½ åªæ¯æ³æµè¯ç±»å®ä¹ï¼å´è¢«è¿«è§¦åæ°æ®åºè¿æ¥åé¡µé¢è¾åºã</p>
<h2 id="æ­£ç¡®åæ³php-8">æ­£ç¡®åæ³ï¼PHP 8+ï¼</h2>
<p>å¨ç°ä»£é¡¹ç®éï¼ç±»å è½½éå¸¸ç± Composer + PSR-4 èªå¨å è½½å¤çï¼<code>include</code>/<code>require</code> æ´å¤ç¨äºéç½®ãæ¨¡æ¿åå°éæ¨¡åé»è¾ã</p>
<p>ä½å³ä¾¿å¦æ­¤ï¼ä¹å»ºè®®å®ä½ä¸é¢ä¸æ¡ã</p>
<h3 id="å§ç»ä½¿ç¨ç»å¯¹éç¹è·¯å¾">å§ç»ä½¿ç¨ç»å¯¹éç¹è·¯å¾</h3>
<p>æè·¯å¾åºå®å¨å·²ç¥æ ¹ä¸ã<code>__DIR__</code> æ°¸è¿æåâå½åæä»¶æå¨ç®å½âï¼ä¸ä¼éå·¥ä½ç®å½ååã</p>
<p><strong>éè¯¯ç¤ºä¾ï¼èå¼±ï¼</strong></p>
<pre><code class="language-php">&lt;?php
// å¦æä» public/ ç®å½å¯å¨ï¼è¿éå¯è½å¤±è´¥
require 'config/settings.php';
</code></pre>
<p><strong>æ­£ç¡®ç¤ºä¾ï¼ç¨³å®ï¼</strong></p>
<pre><code class="language-php">&lt;?php
// æ è®ºä»åªéè°ç¨ï¼é½è½ç¨³å®è§£æ
require __DIR__ . '/config/settings.php';
</code></pre>
<h3 id="åç¨å è½½è¿åå¼">åç¨å è½½è¿åå¼</h3>
<p>è¿æ¯ PHP éç»å¸¸è¢«å¿½ç¥ä½éå¸¸å®ç¨çè½åï¼è¢«å è½½æä»¶å¯ä»¥ <code>return</code> å¼ã</p>
<p><code>config.php</code></p>
<pre><code class="language-php">&lt;?php
return [
    'db' =&gt; [
        'host' =&gt; '127.0.0.1',
        'pass' =&gt; $_ENV['DB_PASS'] ?? 'root',
    ],
    'debug' =&gt; false,
];
</code></pre>
<p><code>app.php</code></p>
<pre><code class="language-php">&lt;?php
$config = require __DIR__ . '/config.php';
// $config æ¯å±é¨åéï¼ä¸æ±¡æå¨å±
</code></pre>
<h3 id="å³é®ç»ä»¶è¦åé²å¾¡å¼å è½½">å³é®ç»ä»¶è¦åé²å¾¡å¼å è½½</h3>
<p>å¯¹äºå¿é¡»å­å¨çæä»¶ï¼ä¸è¦ä¾èµé»è®¤æ¥éï¼èªå·±æé¢æåæ¸æ¥ã</p>
<pre><code class="language-php">&lt;?php
$templatePath = __DIR__ . '/views/header.php';
if (!file_exists($templatePath)) {
    throw new \RuntimeException("å³é®è§å¾ç»ä»¶ç¼ºå¤±: {$templatePath}");
}
require $templatePath;
</code></pre>
<h2 id="çäº§ç¯å¢æ³¨æç¹æ©ç¼©å®¹ä¸å®å¨">çäº§ç¯å¢æ³¨æç¹ï¼æ©ç¼©å®¹ä¸å®å¨</h2>
<p>å½ç³»ç»ä»åæºèµ°å°å®¹å¨éç¾¤æå½æ°è®¡ç®ï¼æä»¶å è½½ä¸ååªæ¯ä»£ç ç»èï¼èæ¯åºç¡è®¾æ½é®é¢ã</p>
<h3 id="å®å¨è·¯å¾ç©¿è¶é²æ¤">å®å¨ï¼è·¯å¾ç©¿è¶é²æ¤</h3>
<p>å¾å¤âPHP ä¸å®å¨âçå°è±¡ï¼æ¬è´¨æ¯å è½½ç­ç¥ä¸å®å¨ã</p>
<ul>
<li><strong>ç½ååï¼Allow-listï¼</strong>ï¼ç»ä¸ç´æ¥ä¿¡ä»»ç¨æ·è¾å¥æ¼è·¯å¾ã</li>
<li><strong><code>basename()</code></strong>ï¼ç¡®å®éè¦ç¨è¾å¥å¼æ¶ï¼ååè·¯å¾çæ®µæ¸æ´ï¼æ¦æª <code>../</code> ç©¿è¶ã</li>
<li><strong><code>open_basedir</code></strong>ï¼å¨ <code>php.ini</code> éå¶ PHP å¯è®¿é®è·¯å¾èå´ï¼é²æ­¢è¶çè¯»åã</li>
</ul>
<h3 id="æ§è½opcache-æ¯åºç¡è®¾æ½èä¸æ¯å¯éé¡¹">æ§è½ï¼OPcache æ¯åºç¡è®¾æ½èä¸æ¯å¯éé¡¹</h3>
<p>çäº§ç¯å¢åºå¼å¯ OPcacheãå®ä¼æé¢ç¼è¯åçå­èç æ¾åå­ï¼é¿åæ¯æ¬¡è¯·æ±éå¤è§£ææä»¶ã</p>
<p><strong>é¨ç½²æç¤º</strong>ï¼å¨é«å¹¶åéç¾¤ä¸­å¯ä»¥èè <code>opcache.validate_timestamps=0</code>ï¼æ¢åæ´å¿«å è½½éåº¦ï¼ä½è¿æå³çæ¯æ¬¡åå¸é½å¿é¡»åå¹³æ»éè½½ï¼å¦åä»£ç æ´æ°ä¸ä¼çæã</p>
<h3 id="å¯è§æµæ§å¤±è´¥å¿é¡»å¯è¿½è¸ª">å¯è§æµæ§ï¼å¤±è´¥å¿é¡»å¯è¿½è¸ª</h3>
<p>æä»¶å è½½å¤±è´¥ä¸åºåªçä¸ä¸ä¸ªâç½å±âæ 500ã</p>
<ul>
<li><strong>å¯è¿½è¸ªä¿¡æ¯</strong>ï¼æ¥å¿è³å°è¦åå« <code>include_path</code> ä¸ <code>cwd</code>ã</li>
<li><strong>çæ§ç­ç¥</strong>ï¼å¯¹ <code>E_COMPILE_ERROR</code> åä¸é¨åè­¦ï¼è¿ç±»é®é¢éå¸¸ä¸åå¸æç¯å¢å·®å¼æå³ï¼éä¼ååæ»ã</li>
</ul>
<h3 id="é¨ç½²å½¢æå·®å¼å®¹å¨-vs-å½æ°è®¡ç®">é¨ç½²å½¢æå·®å¼ï¼å®¹å¨ vs å½æ°è®¡ç®ï¼</h3>
<p>å®¹å¨éåéæä»¶è·¯å¾éå¸¸åºå®å¯é¢æµï¼å½æ°è®¡ç®ç¯å¢å¸¸è§åªè¯»æä»¶ç³»ç»ãç®å½æ å°ååãç»ä¸ä½¿ç¨ <code>__DIR__</code> è½æ¾èéä½ç¯å¢å·®å¼å¸¦æ¥çè·¯å¾é®é¢ã</p>
<h2 id="çå®äºæç©ºéç½®å¹½çµ">çå®äºæï¼"ç©ºéç½®"å¹½çµ</h2>
<p>ææ¾åä¸ææ¥è¿ä¸ä¸ªæ¯ä»ä¸å¡äºæï¼åå°ä»»å¡éæºå¤±è´¥ãé®é¢æ ¹å æ¯ä»ä»¬ç¨ <code>include</code> å è½½ç¯å¢éç½®ã</p>
<p>ææ¬¡åå¸èæ¬æ¼æ·äºçäº§éç½®æä»¶ãå ä¸ºæ¯ <code>include</code>ï¼è¿ç¨æ²¡æå´©ï¼ä¸å¡ç»§ç»­è·ï¼åªæ¯æ¿å°ä¸ä¸ªç©ºç <code>$config</code>ã</p>
<p>ç»ææ¯ä»»å¡å¸¦çç©º API å¯é¥è¿ç»­è¿è¡äº 6 å°æ¶ï¼é æå¤§éäº¤æå¤±è´¥ã</p>
<p>å¦æå½æ¶ä½¿ç¨çæ¯ <code>require</code>ï¼ä»»å¡ä¼ç¬¬ä¸æ¶é´ä¸­æ­å¹¶è§¦ååè­¦ï¼æå¤±ä¼å°å¾å¤ã</p>
<p>ä¸å¥è¯ï¼<strong>æ²¡æå®ç³»ç»å°±ä¸è½æ´»ï¼é£å°±å¿é¡» <code>require</code>ã</strong></p>
<h2 id="æéæ¸åçå°-failed-opening-required-æ¶ç´æ¥ç§å">æéæ¸åï¼çå° Failed opening required æ¶ç´æ¥ç§åï¼</h2>
<ol>
<li>
<p><strong>æå°ç»å¯¹è·¯å¾</strong>ï¼<br>
<code>var_dump(realpath(__DIR__ . '/your-file.php'));</code><br>
è¥è¿å <code>false</code>ï¼è¯´ææä»¶æ ¹æ¬ä¸å¨ä½ ä»¥ä¸ºçä½ç½®ã</p>
</li>
<li>
<p><strong>ç¡®è®¤è¿è¡èº«ä»½</strong>ï¼<br>
<code>echo exec('whoami');</code><br>
çå½åç³»ç»ç¨æ·æ¯å¦æè¯»æéã</p>
</li>
<li>
<p><strong>ææ¥éèè¯­æ³éè¯¯</strong>ï¼<br>
æäºæä»¶ä¸æ¯âä¸å­å¨âï¼èæ¯è¯­æ³éè¯¯å¯¼è´å è½½å¤±è´¥ã<br>
ç¨å½ä»¤è¡æ§è¡ï¼<code>php -l filename.php</code>ã</p>
</li>
<li>
<p><strong>æ£æ¥ PHP å¼å§æ ç­¾</strong>ï¼<br>
æä»¶åºä»¥ <code>&lt;?php</code> å¼å¤´ãè¥ç­æ ç­¾å³é­èä½ åäº <code>&lt;?</code>ï¼åç»­å¯è½åºç°åç§è¯¡å¼é®é¢ï¼å¦ header å·²åéï¼ã</p>
</li>
</ol>
<h2 id="æ´ä¸ä¸çå è½½å°è£ç¤ºä¾">æ´ä¸ä¸çå è½½å°è£ç¤ºä¾</h2>
<p>ä¸è¦é¿æä¾èµè£¸ <code>var_dump</code>ãå»ºè®®ç¨ç»æåæ¥å¿åç»ä¸åè£ã</p>
<pre><code class="language-php">&lt;?php
/**
 * å¸¦å¯è§æµæ§çæä»¶å è½½å¨
 * å¼åç¯å¢è¦âåäº®å¤±è´¥âï¼çäº§ç¯å¢å¯æ§éçº§ã
 */
function load_component(string $filePath, array $context = []): mixed
{
    $absolutePath = realpath($filePath);
    if (!$absolutePath || !file_exists($absolutePath)) {
        error_log(sprintf(
            "[FileLoader] Failure: %s | CWD: %s | User: %s",
            $filePath,
            getcwd(),
            get_current_user()
        ));

        if (getenv('APP_DEBUG') === 'true') {
            throw new \Exception("ç»ä»¶ä¸å­å¨: {$filePath}");
        }

        return null; // çäº§ç¯å¢æçº¦å®éçº§
    }

    extract($context);
    return require $absolutePath;
}
</code></pre>
<h2 id="å¸¸è§é®é¢">å¸¸è§é®é¢</h2>
<h3 id="qrequire_once-ä¸å®æ¯-require-æ´å¥½å">Qï¼<code>require_once</code> ä¸å®æ¯ <code>require</code> æ´å¥½åï¼</h3>
<p>ä¸ä¸å®ã<code>require_once</code> æ´åæ¯ç»ç»ä¸æ¸æ°æ¶çå®å¨ç½ãä¾èµå³ç³»æç¡®ãèªå¨å è½½å¥å¨æ¶ï¼<code>require</code> æ´ç´æ¥ãæ§è½æ´å¥½ã</p>
<h3 id="qå¯ä»¥æ ¹æ®æ°æ®åºå¼å¨æ-include-æä»¶å">Qï¼å¯ä»¥æ ¹æ®æ°æ®åºå¼å¨æ include æä»¶åï¼</h3>
<p>å¯ä»¥ï¼ä½å¿é¡»éå¸¸è°¨æãæ¨èç½ååæ å°ï¼æ°æ®åºåªå­ IDï¼ä»£ç éæ ID æ å°å°åºå®è·¯å¾ï¼ä¸è¦æè·¯å¾åæå­è¿æ°æ®åºåç´æ¥å è½½ã</p>
<h3 id="qå è½½å¤§æä»¶ä¼ææ¢åºç¨å">Qï¼å è½½å¤§æä»¶ä¼ææ¢åºç¨åï¼</h3>
<p>å¼å¯ OPcache åï¼é¦æ¬¡ä¹ååºæ¬æ²¡æâè§£æâææ¬ï¼ä½æä»¶ä¸­çä¸å¡é»è¾ä»è¦æ§è¡ï¼ä¾æ§æ¶è CPU ååå­ãæä»¶åå®¹è¦èç¦ï¼é¿åæå¤§éæ å³é»è¾å¡å¨ä¸èµ·ã</p>
<h3 id="qæ¨¡æ¿æä»¶éåç¨-include-å">Qï¼æ¨¡æ¿æä»¶éåç¨ <code>include</code> åï¼</h3>
<p>å°é¡¹ç®å¯ä»¥ãä¸­å¤§åç³»ç»å»ºè®®ä½¿ç¨æçæ¨¡æ¿æ¹æ¡ï¼è½å¨å®å¨æ§åå¤ç¨æ§ä¸æ´ç¨³ã</p>
<h2 id="ç»è¯­">ç»è¯­</h2>
<p>æ <code>include</code> å <code>require</code> ç¨å¥½ï¼ä¸åªæ¯è¯­æ³é®é¢ï¼èæ¯å·¥ç¨è½åé®é¢ã</p>
<p>ä½ çä»£ç è¿è¡å¨æä½ç³»ç»ãæéæ¨¡åãç¼å­æºå¶åé¨ç½²æµæ°´çº¿å±åææçç¯å¢éãåªçè§£âæ¬å°è½è·âï¼è¿è¿ä¸å¤ã</p>
<h3 id="æä½³å®è·µå°ç»">æä½³å®è·µå°ç»</h3>
<ul>
<li><strong>å¿«éå¤±è´¥</strong>ï¼å³é®ä¾èµç»ä¸ä½¿ç¨ <code>require</code>ã</li>
<li><strong>è·¯å¾ç»å¯¹å</strong>ï¼é¿åç¸å¯¹è·¯å¾ï¼ä¼å <code>__DIR__</code>ã</li>
<li><strong>ä½ç¨åæ¶æ</strong>ï¼ç¨ <code>return</code> è¿åéç½®ï¼é¿åå¨å±åéæ±¡æã</li>
<li><strong>å¤±è´¥å¯è§æµ</strong>ï¼æå è½½å¤±è´¥å½æä¸ç±»å³é®ç³»ç»äºä»¶å¤çã</li>
</ul>
<h3 id="ä½ çä¸ä¸æ­¥">ä½ çä¸ä¸æ­¥</h3>
<p>ç°å¨å°±æå¼é¡¹ç®ï¼å¨å±æç´¢ <code>include</code> / <code>require</code>ï¼</p>
<p>å¡æ¯ä¸ä»¥ <code>__DIR__</code> æç»ä¸æ ¹è·¯å¾å¸¸éå¼å¤´çï¼ä»å¤©å°±æ¹ã</p>
<p>è¿ä¸æ­¥åå®ï¼ä½ ççäº§ç¯å¢å°±ä¼å°ä¸ç±»é«æ¦çäºæã<br>
<a href="https://catchadmin.com/post/2026-02/fatal-error-require-failed-opening-required" target="_blank" rel="noopener nofollow">Fatal error: require(): Failed opening required...ââä»¥åå¦ä½å½»åºé¿åå®åæ¬¡åºç°</a></p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-14 09:22">2026-02-14 09:22</span>&nbsp;
<a href="https://www.cnblogs.com/catchadmin">JaguarJack</a>&nbsp;
éè¯»(<span id="post_view_count">40</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19614589);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19614589', targetLink: 'https://www.cnblogs.com/catchadmin/p/19614589', title: 'âFatal error: require(): Failed opening required...â ä»¥åå¦ä½å½»åºé¿åå®åæ¬¡åºç°' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ [æè§£LangChainæ§è¡å¼æ] ManagedValueââä¸ç§ç¹æ®çåªè¯»èæéé ]]></title>
    <link>https://www.cnblogs.com/jaydenai/p/19614333/managed-value</link>
    <guid>408a09fd1f3a1a4857ce079f70c1249f</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jaydenai/p/19614333/managed-value" title="åå¸äº 2026-02-14 07:57">
    <span role="heading" aria-level="2">[æè§£LangChainæ§è¡å¼æ] ManagedValueââä¸ç§ç¹æ®çåªè¯»èæéé</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        æä»¬ä¸ç´å¨å¼ºè°Pregelå¯¹è±¡çç¶ææ¯éè¿`Channel`ç»´æ¤åä¼ éçï¼å¶å®æ¿è½½ä¼ éç¶æåè½çç»ä»¶é¤äºChannelï¼è¿æ  `ManagedValue`ï¼æä»¬å¯ä»¥å°ManagedValueè§ä¸ºèæChannelã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æä»¬ä¸ç´å¨å¼ºè°Pregelå¯¹è±¡çç¶ææ¯éè¿<code>Channel</code>ç»´æ¤åä¼ éçï¼å¶å®æ¿è½½ä¼ éç¶æåè½çç»ä»¶é¤äºChannelï¼è¿æ  <code>ManagedValue</code>ãæä»¬å¯ä»¥å°ManagedValueè§ä¸ºèæChannelï¼Nodeä¸ä»éç¨ä¸è¯»åChannelå®å¨ä¸æ ·çæ¹å¼è¯»åManagedValueï¼èä¸æ³¨åçManagedValueä¹ç´æ¥å­æ¾å¨Pregelçchannelså­æ®µä¸­ã</p>
<p>å¦ææä»¬ä»ç»æ¥çPregelç±»çå®ä¹ï¼å¯ä»¥çåºå¶<code>channels</code>å­æ®µè¿åä¸ä¸ªå­å¸ï¼å­å¸çå¼çç±»åèåäºBaseChannelå<code>ManagedValueSpec</code>ä¸¤ç§ç±»åï¼åèæ¯Channelçåºç±»ï¼åèå°±æ¯<code>ManagedValue</code>ç±»çå«åã</p>
<pre><code class="language-python">class Pregel(
    PregelProtocol[StateT, ContextT, InputT, OutputT],
    Generic[StateT, ContextT, InputT, OutputT]): 
    channels : dict[str, BaseChannel | ManagedValueSpec]

ManagedValueSpec = type[ManagedValue]
</code></pre>
<p>å¦æè¯´Channelå­å¨çæ¯çä¸å¡ç¶æï¼é£ä¹ManagedValueä¼ éçå°±æ¯Pregelè¿ä¸ªæ§è¡å¼æçè¿è¡æ¶ç¶æãä¸è¬æ¥è¯´ï¼ManagedValueèªèº«ä¸è´è´£å­å¨ç¶æï¼å¶æä¾çå¼å¯ä»¥å®æ¶è®¡ç®å¾åºï¼æä»¥å®ä¸åä¸åºäºCheckpointçæä¹åãä»å¦ä¸æç¤ºçä»£ç çæ®µå¯ä»¥çåºï¼ManagedValueä»ä»å®ä¹äºä¸ä¸ªå¯ä¸çéææ½è±¡æ¹æ³<code>get</code>è¿åå¯¹åºçå¼ï¼ç±äºä½ä¸ºè¾å¥ç<code>PregelScratchpad</code>å¯¹è±¡æä¾çä¿¡æ¯æéï¼æä»¥ManagedValueè½å¤åæ¥çç©ºé´å¶å®å¾æéï¼å¨å¤§é¨åæåµä¸ç¨ä¸å°å®ã</p>
<pre><code class="language-python">class ManagedValue(ABC, Generic[V]):
    @staticmethod
    @abstractmethod
    def get(scratchpad: PregelScratchpad) -&gt; V: ...
</code></pre>
<h2 id="1-pregelscratchpad">1. PregelScratchpad</h2>
<p>ManagedValueæä¾çå¼æ¯éè¿å¶getæ¹æ³æ ¹æ®PregelScratchpadå¯¹è±¡è®¡ç®æå¾ãå½ç¡®å®åç»­å¾æ§è¡çNodeåï¼å¼æä¼ä¸ºæ¯ä¸ªNodeåå»ºä¸ä¸ªä»»å¡ï¼æ¯ä¸ªä»»å¡é½ä¼éå ä¸ä¸ªPregelScratchpadå¯¹è±¡ãPregelScratchpadç<code>step</code>å<code>stop</code>å­æ®µå°±è¿åå½åSuperstepçåºå·åéå¯¹è¿­ä»£çéå¶ï¼æå¤§è¶æ­¥æ°ï¼ï¼å¶å®å­æ®µä¸æä¹åæå³ã</p>
<pre><code class="language-python">@dataclasses.dataclass(**_DC_KWARGS)
class PregelScratchpad:
    step : int
    stop : int
    call_counter : Callable[[], int]
    interrupt_counter : Callable[[], int]
    get_null_resume	: Callable[[bool], Any]
    resume : list[Any]
    subgraph_counter	: Callable[[], int]	
</code></pre>
<p>PregelScratchpadç<code>call_counter</code>ã<code>interrupt_counter</code>å<code>subgraph_counter</code>å­æ®µä»¥é­åçå½¢å¼è¿åä¸ä¸ªè®¡æ°å¨ã<code>call_counter</code>è®¡æ°å¨ç¨äºä¸ºå½åSuperstepåäº§ççææä»»å¡åéå¯ä¸çåé¨åºåå·ã</p>
<h3 id="11-resume-valueåä¸­æ­è®¡æ°å¨">1.1 Resume Valueåä¸­æ­è®¡æ°å¨</h3>
<p><code>interrupt_counter</code>ã<code>get_null_resume</code>å<code>resume</code>å­æ®µä¸Pregelåºäº âä¸­æ­ï¼Interruptï¼/æ¢å¤ï¼Resumeï¼â çæ§è¡æ¹å¼æå³ãåè®¾Pregelçå¯¹åºä¸ä¸ªéè¦äººå·¥ä»å¥çå¤çº§å®¡æ¹æµç¨ï¼å¨æ¯æ¬¡éè¦ä»¥äººå·¥ä»å¥çæ¹å¼æ¶éå®¡æ¹èå³å®çæ¶åï¼æµç¨è¿å¥ä¸ä¸ªä¸­æ­ï¼å½åçç¶æè¢«æä¹åãå½å®¡æ¹å³å®ç»åºåï¼æµç¨ä»¥ âæ¢å¤â çå½¢å¼å¼å§æ§è¡ï¼ä¸­æ­æ¶æä¹åçå¿«ç§è¢«æååºæ¥ âæ¢å¤ç°åºâ ï¼å®¡æ¹å³å®ä»¥Resume Valueçå½¢å¼æä¾ç»å¼æãä¸ºäºå¹éå¤ä¸ªä¸­æ­ç¹ä¸å¯¹åºçResume Valueï¼åèä¼æç§é¡ºåºè¢«æä¹åï¼å¹¶å¨æ¢å¤æ§è¡çæ¶åè¿åå½åæä¾çResume Valueä¸å¹¶å¡«åå°PregelScratchpadç<code>resume</code>åè¡¨ä¸­ã</p>
<p>æ¢å¤æ§è¡åä¸å°å¨ä¸­æ­ç¹åºå¼å§æ§è¡ï¼å®æ»æ¯<code>ä»å¤´æ§è¡</code>Nodeçå¤çå½æ°ï¼æä»¥å®ä¹ <code>å¹ç­Node</code> åºè¯¥æä¸ºAgentç¼ç¨ç âéç§çå¾âãç±äºPregelScratchpadçresumeå­æ®µä¼æç§ä¸­æ­çé¡ºåºå­æ¾Resume Valueï¼æä»¥å¨æ¢å¤æ§è¡çæ¶åï¼æ¯éå°ä¸ä¸ªä¸­æ­ï¼å¼æå¯ä»¥å©ç¨<code>interrupt_counter</code>å­æ®µè¿åçè®¡æ°å¨ä½ä¸ºä½ç½®ç´¢å¼ä»resumeåè¡¨ä¸­å°å¹éçResume Valueæååºæ¥ãå¦ææåçResume Valueä¸ºNoneï¼æèè®¡æ°å¨è¿åçç´¢å¼è¶çï¼<code>get_null_resume</code>å­æ®µæä¾çåè°å°±ä¼æ§è¡ãè¿ä¸ªåè°å½æ°å·æä¸ä¸ªboolç±»åçåæ°is_calledï¼è°ç¨æ¶è¯¥åæ°è¢«è®¾ç½®ä¸ºTrueï¼è¡¨ç¤ºè¯¥ä¸­æ­ç¡®å®è¢«è§¦åäºï¼ä½æ²¡æå¯¹åºçæ°æ®ãè¿ä¼æ¶èæè¿ä¸ªä¸­æ­ä½ï¼ç¡®ä¿æµç¨ä¸è³äºæ°¸è¿å¾ä¸å°æ¢å¤ã</p>
<h3 id="12-å­å¾è°ç¨è®¡æ°å¨">1.2 å­å¾è°ç¨è®¡æ°å¨</h3>
<p>å¦æè¯´<code>interrupt_counter</code>è®¡æ°å¨æ¨å¨è§£å³æ¯æ¬¡ä¸­æ­ä¸æä¾çResume Valueçå¹éé®é¢ï¼é£ä¹<code>subgraph_counter</code>è®¡æ°å¨è§£å³çæ¯æ¬¡âå­å¾è°ç¨âä¸å¯¹åºPregelå®ä¾çå¹éé®é¢ãå¦æç«å¨âå¾âçè§è§ï¼æ¯ä¸ªPregelå¯¹è±¡å°±æ¯ç±å¤ä¸ªNodeç»æçå¾ï¼èPregelä¹å¯ä»¥ä½ä¸ºä¸ä¸ªNodeåºç°å¨å¦ä¸ä¸ªPregelæå»ºçå¾ä¸­ï¼ä¸¤ä¸ªPregelä¹é´å°±ç§°ä¸ºäºâç¶å­âå³ç³»ï¼å­Pregelæå»ºçå¾å°±æ¯âå­å¾âï¼éå¯¹å®çè°ç¨å°±æ¯å­å¾è°ç¨ã</p>
<p>è½ç¶å¨åä¸ä¸ªå¾ä¸­ï¼æ¯ä¸ªPregelä¼ç¬èªå®æèªèº«çæä¹åãå¨æ¢å¤æ§è¡åºæ¯ä¸­ï¼å¼æä¼çåå è½½ä½ä¸ºâæ ¹âçPregelå¯¹åºçCheckpointæ¥æ¢å¤ç°åºãå½éå°âå­å¾âå½¢å¼è°ç¨å¦ä¸ä¸ªPregelæ¶ï¼å¼æä¼å è½½å¯¹åºçCheckpointæ¥æ¢å¤å­å¾å¨ä¸­æ­é£ä¸ªæ¶é´ç¹çç¶æãç°å¨é®é¢æ¥äºï¼å¨å­Pregelä¼å¤æä¹åçCheckpointä¸­ï¼æä¹ç¥éè¯¥å è½½åªä¸ä¸ªå¢ï¼</p>
<p>è¿ä¸ªé®é¢æ¬è´¨ä¸æ¯å¦ä½è§£å³ä½ä¸ºå­å¾æ§è¡çPregelå¨æ§è¡æä¹åæ¶ï¼å¦ä½å°çæçCheckpointä¸å½åæ§è¡ä¸ä¸æè¿è¡å¹éçé®é¢ï¼è¿ä¸ªé®é¢æ¯å©ç¨<code>Checkpointå½åç©ºé´</code>æ¥è§£å³çãNodeæ¯ä»¥ä»»å¡çå½¢å¼è¢«æ§è¡çï¼æ¯ä¸ªä»»å¡å·æå¯ä¸çIDï¼å¹¶ä¸å¨æ¢å¤æ¶ä¿æä¸åï¼å¦æå½åç©ºé´ç±æ§è¡é¾è·¯ä¸æ¯ä¸ªä»»å¡ç<code>èç¹åç§°+ä»»å¡ID</code>ç»æï¼é£ä¹å­å¾çCheckpointå°±è½å©ç¨æ­¤å½åç©ºé´å³èèµ·æ¥ã</p>
<p>ä½æ¯é®é¢è¿æ¯æ²¡æå®å¨è§£å³ï¼å¦æåä¸ä¸ªä»»å¡æ¶åéå¯¹<code>åä¸å­å¾çå¤æ¬¡è°ç¨</code>ï¼å¦å½åç©ºé´åªåå«åºäºä»»å¡çæ§è¡è·¯å¾ï¼æ­¤æ¶ä¸¤ä¸ªå­å¾ä¼å±äº«ç¸åçå½åç©ºé´ï¼å·ä½å¯¹åºåªä¸ªCheckpointä¾ç¶æ æ³è§£å³ãå æ­¤è¥æ¶ååä¸ä¸ªNodeéå¯¹åä¸ä¸ªPregelå¯¹è±¡çå¤æ¬¡è°ç¨ï¼æä¹åè¿ä¸ªPregelçCheckpointçå½åç©ºé´è¿åºè¯¥åå«<code>è°ç¨é¡ºåº</code>ã</p>
<p>Checkpointçå½åç©ºé´çè§åå¯ä»¥éè¿å¦ä¸è¿ä¸ªæ¼ç¤ºå®ä¾æ¥è¯å®ãå¦ä»£ç çæ®µæç¤ºï¼æä»¬åå»ºäºä¸ä¸ªç±åä¸Nodeç»æçPregelå¯¹è±¡ï¼sub_graphï¼ï¼å½åä¸º âbazâ çNodeå¨æ§è¡çæ¶åä¼ä»å½åçRunnableConfigéç½®ä¸­æåå¹¶è¾åºå½åçCheckpointå½åç©ºé´ã</p>
<pre><code class="language-python">from langgraph.pregel import Pregel, NodeBuilder
from langgraph.channels import LastValue
from langgraph.checkpoint.memory import InMemorySaver
from langgraph.pregel._write import ChannelWrite, ChannelWriteTupleEntry
from langgraph.types import RunnableConfig
from typing import Any

def handle(args:dict[str,Any], config:RunnableConfig)-&gt;None:
    print(config["configurable"]["checkpoint_ns"])
sub_node = (NodeBuilder()
    .subscribe_to("start")
    .do(handle))
sub_graph = Pregel(
    nodes={"baz": sub_node},
    channels={
        "start": LastValue(None),
    },
    input_channels=["start"],
    output_channels=[])

def handle1(args:dict[str,Any])-&gt;None:
    sub_graph.invoke(input={"start": None})

def handle2(args:dict[str,Any])-&gt;str:    
    sub_graph.invoke(input={"start": None})    
    sub_graph.invoke(input={"start": None})

foo = (NodeBuilder()
    .subscribe_to("foo")
    .do(handle1)
    .write_to(bar=None))
bar = (NodeBuilder()
    .subscribe_to("bar")
    .do(handle2))

graph = Pregel(
    nodes={"foo": foo, "bar": bar},
    channels={
        "foo": LastValue(None),
        "bar": LastValue(str),
    },
    input_channels=["foo"],
    output_channels=[],
    checkpointer= InMemorySaver())

config = {"configurable": {"thread_id": "123"}}
graph.invoke(input={"foo": None}, config=config)
</code></pre>
<p>å¨å¦ä¸ä¸ªPregelä¸­ï¼æä»¬ä¸ºå®è®¾ç½®äºä¸¤ä¸ªååæ§è¡çNodeï¼fooåbarï¼ï¼åèè°ç¨sub_graphä¸æ¬¡ï¼åèè°ç¨ä¸¤æ¬¡ãéå¯¹ä¸æ¬¡è°ç¨ï¼sub_graphä¸ºèªèº«æä¹åè®¾ç½®çCheckpointå½åä¼ä»¥å¦ä¸çå½¢å¼è¾åºï¼å¯ä»¥çåºå½åç©ºé´åæ¶ä½ç°äºè°ç¨é¾è·¯åæ¬¡åºã</p>
<pre><code>foo:36817c76-c3f7-643f-7924-0d29b39f469a|baz:311cc911-96a0-56b6-225b-28e4cece7cd9
bar:97be6a71-1b71-7364-e691-a122cfef1a92|baz:789287de-869f-42b8-dd03-7518820daaa6
bar:97be6a71-1b71-7364-e691-a122cfef1a92|1|baz:dd1ddd1b-fc62-b46a-c2ec-6a1d8344b793
</code></pre>
<p>åºäºPregelâä¸­æ­/æ¢å¤âçæ§è¡æ¹å¼ï¼è®©æä»¬å¯¹<code>Pregelå®ä¾</code>ä¼æç¹å«ççè§£ãæä»¬ä¹ æ¯äºå°ä¸ä¸ªéè¿è°ç¨æä¸ªç±»æé å½æ°åå»ºçå¯¹è±¡è§ä¸ºè¯¥ç±»åçä¸ä¸ªå®ä¾ï¼ä½æ¯å¨Nodeçå¤çå½æ°ä¸­ï¼å³ä½¿éå¯¹<code>åä¸Pregelå®ä¾</code>çè¿ç»­ä¸¤æ¬¡è°ç¨é½æå¯è½åºç°ä¸­æ­ï¼ä¸æ¦æ¢å¤æ§è¡ï¼åä¸ä¸ªå®ä¾å°±æå¯è½ä½¿æ ¹æ®å¦ä¸ä¸ªCheckpointçç¶æåå»ºçï¼å®èªç¶ä¹å°±ä¸æ¯åæ¥çé£ä¸ªå®ä¾äºãå¨ä¸æ­çâä¸­æ­/æ¢å¤âæ§è¡æµç¨ä¸­ï¼æè°<code>Pregelå®ä¾</code>ææ¶åè¡¨ç¤ºæ<code>å¯¹åºçCheckpoint</code>å¯è½æ´åç¡®ã</p>
<p>å¯¹äºåä¸ä¸ªèç¹ä»»å¡æ¥è¯´ï¼å¦ææ¶åéå¯¹åä¸ä¸ª<code>å­Pregel</code>çå¤æ¬¡è°ç¨ï¼ä»ç¬¬äºæ¬¡è°ç¨å¼å§ï¼å¯¹æ¹æä¹åçæçCheckpointä¼å°<code>è°ç¨æ¬¡åº</code>åå«å¨å½åç©ºé´ä¸­ãä¸ä¹ç¸å¯¹çï¼å¨æ¢å¤æ§è¡çæ¶åï¼ä¹éè¦æ ¹æ®å½åçæ§è¡ä¸ä¸ææä¾åå«æ­¤åºå·çå½åç©ºé´éç¨å è½½å¯¹åºçCheckpointï¼å¹¶æç»æ¢å¤å¯¹åºçPregelå¯¹è±¡ï¼PregelScratchpadçsubgraph_counterå­æ®µè¿åçè®¡æ°å¨å°±æ¯ä¸ºäºæä¾è¿ä¸ªåºå·ã</p>
<h2 id="2-ä¸¤ä¸ªåççmanagedvalue">2. ä¸¤ä¸ªåççManagedValue</h2>
<p>ç±äºManagedValueæè½æä¾çå¼æ¯æ ¹æ®PregelScratchpadè®¡ç®çæï¼èåèå¯ç¨çå¯æè¡¨ç¤ºå½ååæå¤§Superstepåºå·ç<code>step</code>å<code>stop</code>å­æ®µï¼æä»¥æä»¬éç¨ManagedValueçåºç¨åºæ¯å¶å®å¾çªãæä»åªæ¾å°å¦ä¸ä¸¤ä¸ªåççManagedValueç±»åï¼å®ä»¬é½å®ä¹å¨langgraph.managed.is_last_stepè¿ä¸ªåä¸­ãå¶ä¸­ä¸ä¸ª<code>IsLastStepManager</code>ç¨äºå¤æ­æ¯å¦ä¸ºæåä¸ä¸ªSuperstepï¼è<code>RemainingStepsManager</code>åç¨æ¥ç¡®å®ä½ä¸çSuperstepæ°ãå·ä½çå®ç°éå¸¸ç®åï¼ä»ä»æ¯éå¯¹PregelScratchpadç<code>step</code>å<code>stop</code>å­æ®µçç®åè¿ç®èå·²ã</p>
<pre><code class="language-python">class IsLastStepManager(ManagedValue[bool]):
    @staticmethod
    def get(scratchpad: PregelScratchpad) -&gt; bool:
        return scratchpad.step == scratchpad.stop - 1

class RemainingStepsManager(ManagedValue[int]):
    @staticmethod
    def get(scratchpad: PregelScratchpad) -&gt; int:
        return scratchpad.stop - scratchpad.step
</code></pre>
<p>ç±äºManagedValueå±äºä¸ä¸ª<code>è®¡ç®å±æ§</code>ï¼æä»¥å®åªè½ä½ä¸ºNodeçè¾å¥ãå®å¯ä»¥è¢«è§ä¸ºä¸ç§èæçChannelï¼Nodeéå¯¹ManagedValueåå¸¸è§Channelçè¯»åæ¹å¼å®å¨ä¸è´ãå¨åå»ºPregelå¯¹è±¡æ¶ï¼æç¨å°çManagedValueéè¦å¨<code>channels</code>å­æ®µä¸­æ¾å¼å£°æï¼ä½æ¯ä¸è½å°å¶æ·»å å°è¾å¥åè¾åºChannelåè¡¨ä¸­ã</p>
<p>å¦ä¸çå®ä¾æ¼ç¤ºäºRemainingStepsManagerçä½¿ç¨æ¹å¼ï¼åå»ºçPregelç±ä¸¤ä¸ªååæ§è¡çNodeææï¼fooåbarï¼ï¼å®ä»¬ä¼å°å½åä¸º<code>remaining_steps</code>çManagedValueä½ä¸ºè¾å¥ï¼å¹¶å°å¶åå«è¾åºå°<code>remaining_steps_after_foo</code>å<code>remaining_steps_after_bar</code>è¿ä¸¤ä¸ªChannelä¸­ï¼åå«è¡¨ç¤ºå¨è¿ä¸¤ä¸ªNodeå®ææ§è¡åæå©çSuperstepæ°ã</p>
<pre><code class="language-python">from langgraph.pregel import Pregel, NodeBuilder
from langgraph.managed.is_last_step import RemainingStepsManager
from langgraph.channels import LastValue

foo = (NodeBuilder()
       .subscribe_to("foo")
       .read_from("remaining_steps")
       .do(lambda args: args["remaining_steps"])
       .write_to(remaining_steps_after_foo= lambda args:args, bar=None))

bar = (NodeBuilder()
       .subscribe_to("bar")
       .read_from("remaining_steps")
       .do(lambda args: args["remaining_steps"])
       .write_to("remaining_steps_after_bar"))

app = Pregel(
    nodes={"foo":foo, "bar":bar},
    channels={
        "foo": LastValue(None),
        "bar":LastValue(None),
        "remaining_steps_after_foo": LastValue(int),
        "remaining_steps_after_bar":LastValue(int),
        "remaining_steps": RemainingStepsManager, 
    },
    input_channels=["foo"],
    output_channels=["remaining_steps_after_foo", "remaining_steps_after_bar"])

config = {"recursion_limit": 10}
result = app.invoke({"foo":None}, config=config)
assert result["remaining_steps_after_foo"] == 10
assert result["remaining_steps_after_bar"] == 9
</code></pre>
<p>å¨æ ¹æ®ä¸¤ä¸ªNodeåå»ºPregelå¯¹è±¡æ¶ï¼æä»¬å°éå¯¹å½åä¸º<code>remaining_steps</code>çManagedValueçå£°ææ·»å å°channelså­æ®µä¸­ï¼å¯¹åºçç±»åè¢«è®¾ç½®ä¸ºRemainingStepsManagerãç±äºå¨è°ç¨Pregelå¯¹è±¡æ¶å©ç¨RunnableConfigéç½®å°Superstepè¿­ä»£éå¶ä¸º10ï¼æä»¥ååæ§è¡çä¸¤ä¸ªNodeåå©ä½æ­¥æ°åå«ä¸º10å9ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-14 07:58">2026-02-14 07:57</span>&nbsp;
<a href="https://www.cnblogs.com/jaydenai">JaydenAI</a>&nbsp;
éè¯»(<span id="post_view_count">35</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19614333);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19614333', targetLink: 'https://www.cnblogs.com/jaydenai/p/19614333/managed-value', title: '[æè§£LangChainæ§è¡å¼æ] ManagedValueââä¸ç§ç¹æ®çåªè¯»èæéé' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ 2026å¹´äºèç½è¡ä¸åå¤§ç­é¨è¯é¢ï¼AIçé£ä¸ææ¯å¹³æçåå­è·¯å£ ]]></title>
    <link>https://www.cnblogs.com/nf01/p/19613794</link>
    <guid>4f4d233cd9fbf5651d01054deb68a372</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/nf01/p/19613794" title="åå¸äº 2026-02-13 23:11">
    <span role="heading" aria-level="2">2026å¹´äºèç½è¡ä¸åå¤§ç­é¨è¯é¢ï¼AIçé£ä¸ææ¯å¹³æçåå­è·¯å£</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h1 id="å½å¤§æ¨¡åä»å·¥å·è¿åä¸ºä¼ä¼´æä»¬æ­£ç«å¨äºèç½åå²çè½¬æç¹ä¸">å½å¤§æ¨¡åä»"å·¥å·"è¿åä¸º"ä¼ä¼´"ï¼æä»¬æ­£ç«å¨äºèç½åå²çè½¬æç¹ä¸</h1>
<hr>
<blockquote>
<p><em>åå¨åé¢ï¼2026å¹´çäºèç½è¡ä¸ï¼ç­é¹å¾è®©äººæäºåºæ¥ä¸æãä»AI Agentçå¨é¢çåï¼å°å½äº§å¤§æ¨¡åçç¾å®¶äºé¸£ï¼ä»è§é¢çæççé£çªè¿ï¼å°AIç¡¬ä»¶çæç¶å´èµ·ââè¿å¯è½æ¯è¿åå¹´æ¥ææ¯åé©æå¯éçä¸å¹´ãæ¬æ5000ä½å­ï¼å¸¦ä½ ç³»ç»æ§æ¢³çå½ä¸äºèç½è¡ä¸æç­é¨çè¯é¢ï¼æ¢ç©¶ç­æ½®èåçé»è¾ï¼å¹¶å°è¯åç­ä¸ä¸ªæ ¹æ¬é®é¢ï¼è¿ä¸æ¬¡çææ¯æµªæ½®ï¼ç©¶ç«ä¼ææä»¬å¸¦åä½æ¹ï¼</em></p>
</blockquote>
<hr>
<h2 id="ä¸ai-agentä»åç­é®é¢å°ä»£æ¿æä½">ä¸ãAI Agentï¼ä»"åç­é®é¢"å°"ä»£æ¿æä½"</h2>
<p>å¦æè¦ç¨ä¸ä¸ªè¯æ¥å½¢å®¹2026å¹´äºèç½è¡ä¸çä¸»é¢ï¼<strong>AI Agentï¼æºè½ä½ï¼</strong> ç»å¯¹å½ä¹æ æ§ã</p>
<p>è¿è®°å¾2023å¹´ChatGPTæ¨ªç©ºåºä¸æ¶ï¼æä»¬æå¹äºå®è½"åç­é®é¢"ï¼2024å¹´ï¼æä»¬å¼å§ä¹ æ¯å®è½"çæåå®¹"ï¼èå°äº2026å¹´ï¼è¡ä¸ç¦ç¹å·²ç»å®å¨è½¬åââ<strong>AIè½æ¿æ"å¹²æ´»"äºåï¼</strong></p>
<p>ç­æ¡æ¯ï¼ä¸ä»è½ï¼èä¸æ­£å¨å éæ¸éã</p>
<h3 id="11-ä»ä¹æ¯ai-agentç®åæ¥è¯´">1.1 ä»ä¹æ¯AI Agentï¼ç®åæ¥è¯´</h3>
<p>ä¼ ç»AIå©æï¼æ¯å¦Siriãå°ç±åå­¦ï¼æ¯"ä½ é®ä¸å¥ï¼å®ç­ä¸å¥"çäº¤äºæ¨¡å¼ãèAI Agentåå·å¤äº<strong>è§åãå·¥å·ä½¿ç¨ãè®°å¿åèªä¸»å³ç­</strong>åå¤§è½åãä½ å¯ä»¥ç»å®ä¸ä¸ªç®æ ï¼æ¯å¦"å¸®æè®¢ä¸å¼ ä¸å¨å»ä¸æµ·çæºç¥¨ï¼è¦é çªåº§ä½ï¼ä»·æ ¼å¨1500åä»¥å"ï¼ï¼å®ä¼èªå·±åæéæ±ãæç´¢ä¿¡æ¯ãæ¯è¾éé¡¹ãå®ææä½ââå¨ç¨ä¸éè¦ä½ åå¨æã</p>
<h3 id="12-å·¨å¤´é½å¨å¸å±">1.2 å·¨å¤´é½å¨å¸å±</h3>
<p>2026å¹´åï¼OpenAIåå¸äºGPT-5ï¼å¶æ ¸å¿åç¹å°±æ¯<strong>Agentæ¨¡å¼</strong>çå¨é¢åçº§ãç¨æ·åªéç»åºä¸ä¸ªé«å±æ¬¡æä»¤ï¼GPT-5å°±è½èªä¸»æè§£ä»»å¡ãè°ç¨åç§å·¥å·ï¼æµè§å¨ãææ¡£ãä»£ç ç¼è¯å¨ç­ï¼ãåæ­¥æ§è¡ï¼æç»äº¤ä»å®æ´ç»æã</p>
<blockquote>
<p><em>"æä»¬å¸æè®©AIæä¸ºä½ ç'æ°å­åå·¥'ï¼èä¸ä»ä»æ¯'æ°å­ç¾ç§å¨ä¹¦'ã"</em> ââ OpenAI CEO Sam Altman</p>
</blockquote>
<p>å½åè¿è¾¹ï¼ç¾åº¦ç"æå¿ä¸è¨"ãå­èç"è±å"ãé¿éç"éä¹åé®"é½å¨å¿«éè¿­ä»£Agentè½åãç¾åº¦æ´æ¯å°Agentæ¦å¿µèå¥äºæç´¢åå°å¾äº§åï¼ååºäº"æç´¢å³æå¡"çå£å·ã</p>
<h3 id="13-ä¸ºä»ä¹2026å¹´æ¯agentåå¹´">1.3 ä¸ºä»ä¹2026å¹´æ¯Agentåå¹´ï¼</h3>
<p><strong>ä¸ä¸ªæ¡ä»¶çæçï¼</strong></p>
<ol>
<li><strong>å¤§æ¨¡åè½åè·å</strong>ï¼æ¨çææ¬å¤§å¹ä¸éï¼æ¨¡åååºéåº¦å å¿«ï¼å¤æ¨¡æè½åå¢å¼º</li>
<li><strong>å·¥å·çæå®å</strong>ï¼æµè§å¨èªå¨åãAPIæ¥å£ãæä»¶ç³»ç»æä½ç­åºç¡è®¾æ½æ¥è¶æç</li>
<li><strong>ç¨æ·éæ±è§é</strong>ï¼996æµªæ½®ä¸ everyoneé½å¨å¯»æ¾"æçè§£è¯"ï¼èæ¿ä»¬æ¸´æAIå¸®èªå·±æå·¥</li>
</ol>
<p><strong>ä¸å¥è¯æ»ç»ï¼</strong> 2026å¹´ï¼AIä¸ååªæ¯"åºç­æº"ï¼èæ¯å¼å§çæ­£"å¹²æ´»"äºãè¿ä¸è½¬åçå½±åï¼å¯è½æ¯å½å¹´ç§»å¨äºèç½çè¯çè¿è¦æ·±è¿ã</p>
<hr>
<h2 id="äºå½äº§å¤§æ¨¡åç¾å®¶äºé¸£ä¸æ·æ±°èµå¹¶è¡">äºãå½äº§å¤§æ¨¡åï¼ç¾å®¶äºé¸£ä¸æ·æ±°èµå¹¶è¡</h2>
<h3 id="21-ç¾æ¨¡å¤§æè¿å¥ä¸ååº">2.1 "ç¾æ¨¡å¤§æ"è¿å¥ä¸ååº</h3>
<p>2024å¹´ï¼å½åå¤§æ¨¡åèµéå¯ä»¥ç¨"ç¯ç"æ¥å½¢å®¹ââæ®ä¸å®å¨ç»è®¡ï¼é£ä¸å¹´ååºäºè¶è¿200ä¸ªå¤§æ¨¡åãä½å°äº2026å¹´ï¼å§ææ¥è½¬ç´ä¸ï¼<strong>æ´»ä¸æ¥çä¸è¶è¿20å®¶ï¼å¶ä»çé½æäº"ç®ç°"ã</strong></p>
<p>è¿ä¸æ¯å±è¨è¸å¬ã2025å¹´ä¸åå¹´å¼å§ï¼æèµäººåå¾å¼å¸¸å·éãé£äº"PPTèèµ"ãDemoæ¼äº®ä½è½å°å°é¾çå¬å¸ï¼è¦ä¹è¢«è¿«åå¹¶ï¼è¦ä¹æç¶éåºãå¹¸å­èæä¸¤ç±»ï¼</p>
<ul>
<li><strong>æåºæ¯ç</strong>ï¼å­èï¼è±å+é£ä¹¦ï¼ãé¿éï¼éä¹+ééï¼ãç¾åº¦ï¼æå¿+æç´¢ï¼</li>
<li><strong>æèµéç</strong>ï¼æºè°±AIãMiniMaxãé¶è·æè¾°</li>
</ul>
<h3 id="22-deepseekå¸¦æ¥çå²å»æ³¢">2.2 DeepSeekå¸¦æ¥çå²å»æ³¢</h3>
<p>2025å¹´æ«ï¼ä¸å¹é»é©¬æåºéå´ââ<strong>DeepSeek</strong>ã</p>
<p>è¿ä¸ªç±å½åå¢éæé çå¤§æ¨¡åï¼å¨å¤é¡¹åºåæµè¯ä¸­é¼è¿GPT-4æ°´å¹³ï¼ä½æ¨çææ¬åªæå¯¹æ¹ç1/10ãæ´éè¦çæ¯ï¼DeepSeekéæ©äº<strong>å¼æº</strong>è·¯çº¿ï¼å¼æ¾äºæ¨¡åæéåææ¯æ¥åã</p>
<blockquote>
<p><em>"æä»¬å¸æè®©æ¯ä¸å®¶ä¸­å½å¬å¸é½ç¨å¾èµ·é¡¶çº§AIã"</em> ââ DeepSeekåå§äºº</p>
</blockquote>
<p>æ­¤ä¸¾ç´æ¥ç¹çäºè¡ä¸ä»·æ ¼æãåå¤§ååè¢«è¿«è·è¿ï¼APIè°ç¨ä»·æ ¼ä¸éåéãæäººè¯´DeepSeekæ¯"è¡ä¸å¬æ"ï¼ä¹æäººè¯´å®æ¯"æ®æ åé"ãæ è®ºå¦ä½ï¼<strong>2026å¹´ï¼å¤§æ¨¡åç"å¹³ææ¶ä»£"ççæ¥äºã</strong></p>
<h3 id="23-åºç¨å±çæºä¼å¨åªé">2.3 åºç¨å±çæºä¼å¨åªéï¼</h3>
<p>åºå±æ¨¡åçç«äºè¶äºç½ç­åï¼ä½æèµäººçæ­£å³å¿çï¼æ¯<strong>åºç¨å±</strong>ççåã</p>
<p>ç®åæ¥çï¼è½å°æå¿«çèµéåæ¬ï¼</p>
<ul>
<li><strong>AIåä½/åå¬</strong>ï¼WPS AIãNotion AIãç§å¡åä½ç«</li>
<li><strong>AIç¼ç¨</strong>ï¼CursorãDevinï¼ç¡è°·ææäº§åï¼ãå½ååç§"AIç¨åºå"</li>
<li><strong>AIæè²</strong>ï¼ä½ä¸å¸®AIãç¿è¾å¯¼AIãå°ç¿AI</li>
<li><strong>AIè¥é</strong>ï¼åç§AIçæææ¡ãå¾çãè§é¢çå·¥å·</li>
</ul>
<p><strong>ç»è®ºï¼ä¸å¶å·æ¨¡åï¼ä¸å¦å·åºç¨ã</strong> 2026å¹´ï¼è¿å¥è¯æ­£å¨æä¸ºè¡ä¸å±è¯ã</p>
<hr>
<h2 id="ä¸è§é¢çæsoraä¸åæ¯å¯ä¸ç­æ¡">ä¸ãè§é¢çæï¼Soraä¸åæ¯å¯ä¸ç­æ¡</h2>
<h3 id="31-æå­çæè§é¢è¿å¥å®ç¨é¶æ®µ">3.1 "æå­çæè§é¢"è¿å¥å®ç¨é¶æ®µ</h3>
<p>2024å¹´åï¼OpenAIåå¸Soraï¼æ¼ç¤ºäº60ç§é«æ¸è§é¢çæè½åï¼å¨ä¸çä¸ºä¹éå¨ãä¸¤å¹´åçä»å¤©ï¼Soraæ©å·²ä¸æ¯å¯ä¸éé¡¹ã</p>
<p><strong>å½åç©å®¶éä½ååï¼</strong></p>
<ul>
<li><strong>å¿«æå¯çµ</strong>ï¼ä¸»æ"äººäººå¯ç¨"ï¼çæéåº¦æå¿«ï¼å·²è¿­ä»£å°2.0çæ¬</li>
<li><strong>å­èå³æ¢¦</strong>ï¼èé æé³çæï¼ä¸é®çæç­è§é¢ç´ æ</li>
<li><strong>MiniMax</strong>ï¼å¨é¿è§é¢çææ¹é¢æç¬ç¹ä¼å¿</li>
<li><strong>Runway Gen-3</strong>ï¼ä¾ç¶æ¯å¨çåä½èçé¦éå·¥å·</li>
</ul>
<h3 id="32-è¡ä¸å½±åå½±è§å¶ä½æ­£å¨è¢«éå¡">3.2 è¡ä¸å½±åï¼å½±è§å¶ä½æ­£å¨è¢«éå¡</h3>
<p>è¿å»ï¼ä¸æ¯30ç§çå¹¿åçï¼ä»åæå°æçå¯è½éè¦ä¸å¨ãèè´¹æ°ä¸åãå¦ä»ï¼<strong>ç¨AIçæè§é¢ç´ æ+äººå·¥åæè°æ´ï¼2å°æ¶å°±è½æå®</strong>ï¼ææ¬ä¸è¶³åæ¥ç1/10ã</p>
<p>è¿æå³çä»ä¹ï¼</p>
<ul>
<li><strong>ç­è§é¢åä½è</strong>ï¼åä¹ä¸ç¨ä¸ºç´ æåæï¼AIå¸®ä½ "é "</li>
<li><strong>MCNæºæ</strong>ï¼ä¸äºº+AI = è¿å»ä¸ä¸ªå¢éççäº§å</li>
<li><strong>ä¸­å°å¹¿åå¬å¸</strong>ï¼ç»äºè½ç¨å¾èµ·"å¤§ççº§"ææ</li>
</ul>
<p>å½ç¶ï¼<strong>"AIçæè§é¢"ç®åä»æææ¾ç­æ¿</strong>ï¼</p>
<ul>
<li>ç©çè§å¾ææ¡ä¸åï¼ç©ä½ç©¿æ¨¡ãæ¶²ä½åå½¢ç­é®é¢å¸¸è§ï¼</li>
<li>äººç©ä¸è´æ§é¾ä»¥ç»´æï¼çæå¤éå¤´æ¶è¸ä¼åï¼</li>
<li>çæäºè®®ä¸æ­ï¼è®­ç»æ°æ®æ¥æºé®é¢ï¼</li>
</ul>
<h3 id="33-2026å¹´ä¸ä¸ªäººäººé½æ¯å¯¼æ¼çæ¶ä»£æ­£å¨éä¸´">3.3 2026å¹´ï¼ä¸ä¸ª"äººäººé½æ¯å¯¼æ¼"çæ¶ä»£æ­£å¨éä¸´</h3>
<p>å½ææ¯é¨æ§è¶³å¤ä½ï¼åæå°æä¸ºå¯ä¸çç¨ç¼ºèµæºãè¿å¥è¯è¯´äºåå¹´ï¼ç°å¨ç»äºè¦å®ç°äºã</p>
<hr>
<h2 id="åaiç¡¬ä»¶é¤äºææºåçµèè¿æä»ä¹">åãAIç¡¬ä»¶ï¼é¤äºææºåçµèï¼è¿æä»ä¹ï¼</h2>
<h3 id="41-ai-pinåäºä½æ¹åæ²¡é">4.1 AI Pinï¼åäºï¼ä½æ¹åæ²¡é</h3>
<p>2024å¹´ï¼AI Pinï¼å¦Humane PinãRabbit R1ï¼æ¦å¿µçç«ï¼è¢«è®¤ä¸ºæ¯"æ¿ä»£ææº"çä¸ä¸ä»£ç¡¬ä»¶ãç¶èç°å®å¾æ®é·ï¼<strong>AI Pinå¸åºè¡¨ç°æ¨æ·¡</strong>ï¼åºè´§éè¿ä½äºé¢æã</p>
<p>åå ä¸å¤æï¼<strong>åè½ææºé½è½åï¼åç¬ç¡¬ä»¶æ²¡å¿è¦ï¼äº¤äºä½éªä¸å¤èªç¶ï¼ç»­èªååç­é®é¢ä¸¥éã</strong></p>
<h3 id="42-aiç¼é2026å¹´æ°é£å£">4.2 AIç¼éï¼2026å¹´æ°é£å£ï¼</h3>
<p>ä½èµæ¬æ²¡ææ­»å¿ã2026å¹´ï¼<strong>AIç¼é</strong>æä¸ºæ°ç¦ç¹ã</p>
<p><strong>Metaä¸Ray-Banåä½çAIç¼é</strong>å·²ç»è¿­ä»£å°ç¬¬ä¸ä»£ï¼æ¯æå®æ¶ç¿»è¯ãç©ä½è¯å«ãè¯­é³å©æç­åè½ãæåä¼¯æ ¼æ­è¨ï¼"ç¼éæ¯AIæåéçè½½ä½ï¼å ä¸ºå®ç¦»ç¼çæè¿ãç¦»è³æµæè¿ã"</p>
<p>å½åç©å®¶é»é£èå¨ï¼</p>
<ul>
<li><strong>å°ç±³</strong>ï¼è¢«ææ­£å¨ç åAIç¼éï¼å®ä½"å¹´è½»äººçç¬¬ä¸ä¸ªAIè®¾å¤"</li>
<li><strong>å­è</strong>ï¼éè¿æèµæ¹å¼å¸å±AR/VRç¡¬ä»¶</li>
<li><strong>åä¸º</strong>ï¼Mateç³»ååç»­å¯è½éæAIç¼éåè½</li>
</ul>
<h3 id="43-æºå¨äººä»æ¦å¿µå°ä¸å²">4.3 æºå¨äººï¼ä»"æ¦å¿µ"å°"ä¸å²"</h3>
<p>é¤äºç©¿æ´è®¾å¤ï¼<strong>AIæºå¨äºº</strong>ä¹å¨2026å¹´å éè½å°ã</p>
<ul>
<li><strong>ç¹æ¯æOptimus</strong>ï¼å·²ç»å¨å·¥å"æå·¥"ï¼è¿è¡ç®åè£éå·¥ä½</li>
<li><strong>æ³¢å£«é¡¿å¨åAtlas</strong>ï¼å®£å¸è¿å¥åä¸åé¶æ®µ</li>
<li><strong>å½åä¼å¿éãè¾¾é¼ç§æ</strong>ï¼å¨æå¡æºå¨äººé¢åæç»­çªç ´</li>
</ul>
<blockquote>
<p><em>"æªæ¥åå¹´ï¼æ¯ä¸ªå®¶åº­å¯è½é½ä¼æä¸å°æºå¨äººã"</em> ââ é©¬æ¯åé¢æµ</p>
</blockquote>
<p><strong>ä½è¯·æ³¨æï¼</strong> ç®åè½åç¨çæºå¨äººä¸»è¦è¿æ¯"ä¸ç¨å"ï¼æ«å°çæ«å°ãæ¬è´§çæ¬è´§ï¼ï¼"éç¨å"å®¶åº­æºå¨äººç¦»æä»¬è¿æè·ç¦»ã</p>
<hr>
<h2 id="äºaiçç®¡ä¸æ°æ®å®å¨å½ææ¯è·å¾æ¯æ³å¾å¿«">äºãAIçç®¡ä¸æ°æ®å®å¨ï¼å½ææ¯è·å¾æ¯æ³å¾å¿«</h2>
<h3 id="51-å¨ççç®¡å é">5.1 å¨ççç®¡å é</h3>
<p>2026å¹´ï¼AIçç®¡ä¸åæ¯"çº¸ä¸è°åµ"ã</p>
<ul>
<li><strong>æ¬§çAIæ³æ¡</strong>ï¼2025å¹´æ­£å¼çæï¼å¯¹é«é£é©AIåºç¨å®æ½ä¸¥æ ¼çç®¡</li>
<li><strong>ç¾å½</strong>ï¼åå·åå«ç«æ³ï¼å å·èµ°äºæåæ²¿</li>
<li><strong>ä¸­å½</strong>ï¼ç½ä¿¡ååå¸ãçæå¼AIç®¡çåæ³ãåçº§çï¼å¼ºè°åå®¹æ è¯åçæä¿æ¤</li>
</ul>
<h3 id="52-çææäºææ¼æç">5.2 çææäºææ¼æç</h3>
<p>AIè®­ç»æ°æ®ççæé®é¢ï¼å·²ç»ä»"å­¦æ¯è®¨è®º"åçº§ä¸º"åä¸æäº"ã</p>
<ul>
<li><strong>å¥½è±å vs AIå¬å¸</strong>ï¼å¤èµ·éä½è¯è®¼æ­£å¨è¿è¡ä¸­</li>
<li><strong>æå­å·¥ä½èèç</strong>ï¼è¦æ±AIå¬å¸æ¯ä»ç¨¿é¬</li>
<li><strong>é³ä¹è¡ä¸</strong>ï¼AIçæé³ä¹æ³æ»¥ï¼Spotifyç­å¹³å°è¢«è¦æ±ä¸æ¶</li>
</ul>
<p><strong>ä¸ä¸ªæææçæè®ºï¼</strong></p>
<blockquote>
<p>AIå¬å¸è¯´ï¼"æä»¬ç¨å¬å¼æ°æ®è®­ç»ï¼æ¯åçä½¿ç¨ã"<br>
çææ¹è¯´ï¼"ä½ ç'å¬å¼'æ²¡ç»è¿æåæã"</p>
</blockquote>
<p>è¿åºäºè®ºï¼2026å¹´ä¸ä¼æç­æ¡ï¼ä½ä¸å®ä¼è¶æ¥è¶æ¿çã</p>
<h3 id="53-aiæ±¡æè¢«å¿½è§çå±æº">5.3 "AIæ±¡æ"ï¼è¢«å¿½è§çå±æº</h3>
<p>è¿æä¸ä¸ªè¢«ä½ä¼°çè¯é¢ï¼<strong>AIçæåå®¹çæ±¡æé®é¢</strong>ã</p>
<p>å½äºèç½ä¸AIçæçåå®¹è¶æ¥è¶å¤ï¼<strong>"äººç±»æ°æ®æ¯ç«­"</strong>æ­£å¨æä¸ºæ°çç¦èãå¦ææ¨¡åç»§ç»­ç¨AIçæçæ°æ®è®­ç»ï¼ä¼å¯¼è´"æ¨¡åå´©æº"ï¼model collapseï¼ãå¦ä½åºå"äººç±»æºæ§"å"æºå¨æµæ°´è´¦"ï¼å°æä¸ºå¹³å°åçç®¡æ¹çæ ¸å¿ææã</p>
<hr>
<h2 id="å­ç¤¾äº¤ä¸åå®¹å¹³å°æµééæ°åé">å­ãç¤¾äº¤ä¸åå®¹å¹³å°ï¼æµééæ°åé</h2>
<h3 id="61-ç­è§é¢èµéçç»å±">6.1 ç­è§é¢èµéçç»å±ï¼</h3>
<p>2026å¹´ï¼ç­è§é¢æ±æ¹å·²ç»è¶äºç¨³å®ï¼</p>
<ul>
<li><strong>æé³+TikTok</strong>ï¼å¨çå¶é¸</li>
<li><strong>å¿«æ</strong>ï¼ä¸æ²å¸åºç¨³å¦èç</li>
<li><strong>è§é¢å·</strong>ï¼ä¾æå¾®ä¿¡çææç»­å¢é¿</li>
<li><strong>å°çº¢ä¹¦</strong>ï¼ä»"ç§èç¤¾åº"è¿åä¸º"æç´¢å¥å£"ï¼DAUå±¡åæ°é«</li>
</ul>
<p>æè¶£çæ¯ï¼<strong>"æç´¢"æ­£å¨åå½</strong>ãå¹´è½»äººä¸ååªä¾èµç®æ³æ¨èï¼èæ¯ä¸»å¨å¨å°çº¢ä¹¦ãæé³ä¸"æç­æ¡"ãè¿è®©ç¾åº¦æç¹å°´å°¬ï¼ä¹è®©åå®¹å¹³å°çå°äºæ°çåä¸åç©ºé´ã</p>
<h3 id="62-ç§å¯ç¤¾äº¤åæ¸©">6.2 ç§å¯ç¤¾äº¤åæ¸©</h3>
<p>ä¸æ­¤åæ¶ï¼<strong>ç§å¯ç¤¾äº¤</strong>æ­£å¨å¤å´ã</p>
<ul>
<li><strong>Discord</strong>ï¼ä»æ¸¸æç¤¾åºæ©å±ä¸º"å´è¶£é£å°"</li>
<li><strong>Telegram</strong>ï¼ä»è´¹åè½ä¸çº¿ï¼ç¨æ·ä¸ååå¢</li>
<li><strong>åç§"å°ç¾¤"ç¤¾äº¤</strong>ï¼å¾®ä¿¡ç¾¤ãSlack WorkspaceãDiscordæå¡å¨â¦â¦</li>
</ul>
<p><strong>é»è¾å¾å¥½çè§£ï¼</strong> å¬å±å¹³å°çåªé³å¤ªå¤§äºï¼äººä»¬æ¸´æ"å®éçå°åå­"ã</p>
<h3 id="63-åä½èç»æµ20">6.3 åä½èç»æµ2.0</h3>
<p>"ææå¹³å°é½å¨æ¢åä½è"ââè¿å·²ç»ä¸æ¯æ°é»ï¼ä½2026å¹´çæ°ååæ¯ï¼</p>
<ul>
<li><strong>å¹³å°åææ¯ä¾ä¸è°</strong>ï¼æé³ãBç«çº·çº·"è®©å©"</li>
<li><strong>åä½èä¿é©</strong>åºç°ï¼å¹³å°å¼å§ä¸ºåä½èæä¾å»çãå»èä¿é</li>
<li><strong>AIè¾å©å·¥å·æ®å</strong>ï¼ä¸ä¸ªäººå°±æ¯ä¸æ¯å¢é</li>
</ul>
<p><strong>"äººäººé½æ¯åä½è"çæ¶ä»£ï¼åå®¹ä¾ç»ä¸¥éè¿å©ââæä¹åï¼ç­æ¡åªæä¸ä¸ªï¼å·è´¨éã</strong></p>
<hr>
<h2 id="ä¸èªå¨é©¾é©¶è½å°æ¯é¢æå¿«">ä¸ãèªå¨é©¾é©¶ï¼è½å°æ¯é¢æå¿«</h2>
<h3 id="71-l3çº§èªå¨é©¾é©¶2026å¹´æç">7.1 L3çº§èªå¨é©¾é©¶ï¼2026å¹´æç</h3>
<p>2026å¹´ï¼<strong>L3çº§èªå¨é©¾é©¶</strong>ï¼ææ¡ä»¶èªå¨åï¼å¨ç¹å®è·¯æ®µå¯ä»¥è±æï¼ç»äºå¨ä¸­å½è½å°ï¼</p>
<ul>
<li><strong>åä¸ºé®ç</strong>ï¼ADS 3.0çæ¬æ¨éï¼çé«éNOAå¨å½é</li>
<li><strong>èæ¥NOP+</strong>ï¼åå¸NOAåè½å¼æ¾</li>
<li><strong>å°é¹XNGP</strong>ï¼æç»­è¿­ä»£ï¼ä½éªæ¥è¿"èå¸æº"</li>
</ul>
<p><strong>ä½è¯·æ³¨æï¼</strong> L3ä»ç¶æä¸¥æ ¼çä½¿ç¨æ¡ä»¶ï¼é«éå¬è·¯ãå¿«éè·¯ãå¤©æ°è¯å¥½ç­ï¼ï¼å®å¨"æ äººé©¾é©¶"ï¼L4/L5ï¼è¿è¿ã</p>
<h3 id="72-åä¸åç ´å±">7.2 åä¸åç ´å±</h3>
<p>Robotaxiï¼æ äººåºç§è½¦ï¼ä¹å¨å éï¼</p>
<ul>
<li><strong>ç¾åº¦èåå¿«è·</strong>ï¼å¤ä¸ªåå¸åä¸åè¿è¥</li>
<li><strong>Waymo</strong>ï¼å¨ç¾å½æç»­æ©å¼ </li>
<li><strong>Cruise</strong>ï¼è½ç¶2024å¹´åºäºå®å¨äºæï¼ä½2026å¹´å·²æ¢å¤è¿è¥</li>
</ul>
<p><strong>ä¸ä¸ªæè¶£çç°è±¡ï¼</strong> 2026å¹´å¾å¤äººå¼å§è®¨è®º"è¦ä¸è¦ä¹°è½¦"ãå½Robotaxiè¶³å¤ä¾¿å®ä¸æ¹ä¾¿ï¼å»è½¦çææ¬ï¼åè½¦ãä¿é©ãæ²¹è´¹/çµè´¹ï¼ä¼¼ä¹è¶æ¥è¶ä¸åç®ã</p>
<hr>
<h2 id="å«web3ä¸åºåé¾å·é¨ä½æ²¡æ­»">å«ãWeb3ä¸åºåé¾ï¼å·é¨ä½æ²¡æ­»</h2>
<h3 id="81-æ¯ç¹å¸ä»æ³¡æ²«å°èµäº§">8.1 æ¯ç¹å¸ï¼ä»"æ³¡æ²«"å°"èµäº§"</h3>
<p>2026å¹´ï¼æ¯ç¹å¸ä¾ç¶æ¯æ"åºå"çå å¯èµäº§ãè½ç¶ä»·æ ¼æ³¢å¨å§çï¼ä½<strong>ä¸»æµæºææ¥çº³åº¦æç»­æé«</strong>ï¼</p>
<ul>
<li>è´è±å¾·ãå¯è¾¾ç­ä¼ ç»éèå·¨å¤´ç»§ç»­å¸å±å å¯èµäº§</li>
<li>æ´å¤çETFäº§åä¸çº¿</li>
<li>çè³æå½å®¶ï¼å¦è¨å°ç¦å¤ï¼ææ¯ç¹å¸å®ä¸ºæ³å®è´§å¸</li>
</ul>
<h3 id="82-web3åºç¨ä»å¨æ¢ç´¢">8.2 Web3åºç¨ï¼ä»å¨æ¢ç´¢</h3>
<p>"Web3å»ä¸­å¿åäºèç½"çæ¿æ¯ï¼ç®åæ¥çä¾ç¶é¥è¿ã<strong>DeFiï¼å»ä¸­å¿åéèï¼ãNFTãGameFi</strong> è¿äºæ¦å¿µç»åè¿å±±è½¦è¡æï¼æ³¡æ²«ç ´äºä¸æ¹åä¸æ¹ã</p>
<p>ä½åºå±ææ¯å¨è¿æ­¥ï¼</p>
<ul>
<li><strong>Layer 2è§£å³æ¹æ¡</strong>è®©ä»¥å¤ªåæ´å¿«ãæ´ä¾¿å®</li>
<li><strong>ZKï¼é¶ç¥è¯è¯æï¼</strong> ææ¯å¼å§åºç¨äºéç§è®¡ç®</li>
<li><strong>å»ä¸­å¿åèº«ä»½ï¼DIDï¼</strong> å¨ä¸äºåç´åºæ¯è½å°</li>
</ul>
<p><strong>æ»ç»ï¼Web3ä¸æ¯åäºï¼èæ¯ä»"ææºæ³¡æ²«"åå½"ææ¯åºå»º"ã</strong></p>
<hr>
<h2 id="ä¹è¿ç¨åå¬ä¸åä½å¸¸æåççº¢å©">ä¹ãè¿ç¨åå¬ä¸åä½ï¼å¸¸æåççº¢å©</h2>
<h3 id="91-æ··ååå¬æä¸ºæ é">9.1 æ··ååå¬æä¸ºæ é</h3>
<p>2026å¹´ï¼<strong>"ä¸å¤©åå¬å®¤+ä¸¤å¤©å¨å®¶"</strong> å·²ç»æä¸ºå¤§å¤æ°ç¥è¯å·¥ä½èçå¸¸æã</p>
<ul>
<li><strong>Slackãé£ä¹¦ãéé</strong>ï¼åè½è¶æ¥è¶å¼ºå¤§ï¼ææ¡£ãå®¡æ¹ãä¼è®®ãOKRå¨è¦ç</li>
<li><strong>NotionãConfluence</strong>ï¼ç¥è¯ç®¡çæä¸ºä¼ä¸ç"åºç¡è®¾æ½"</li>
<li><strong>FigmaãMiro</strong>ï¼å¨çº¿åä½å·¥å·è®©"å¼å°è®¾è®¡"æä¸ºå¯è½</li>
</ul>
<h3 id="92-aiåäºæ¥äº">9.2 "AIåäº"æ¥äº</h3>
<p>æ´å³é®çååæ¯ï¼<strong>ä½ çåäºå¯è½ä¸å¨æ¯"äºº"äºã</strong></p>
<ul>
<li><strong>AIä¼è®®çºªè¦</strong>ï¼èªå¨çæä¼è®®æè¦ãå¾åäºé¡¹</li>
<li><strong>AIå¨æ¥</strong>ï¼èªå¨æ±æ»ä½ ä¸å¨çå·¥ä½åå®¹</li>
<li><strong>AIå®¢æ</strong>ï¼7Ã24å°æ¶å¨çº¿ï¼è§£ç­éå¤é®é¢</li>
</ul>
<p><strong>2026å¹´çèåºçå­æ³åï¼</strong> è¦ä¹ä½ ä¼ç¨AIï¼è¦ä¹ä½ è¢«ä¼ç¨AIçäººåä»£ã</p>
<hr>
<h2 id="åäºè®¡ç®ä¸åºç¡è®¾æ½aiæ¶ä»£çåé²äºº">åãäºè®¡ç®ä¸åºç¡è®¾æ½ï¼AIæ¶ä»£ç"åé²äºº"</h2>
<h3 id="101-äºååçaiè½¬å">10.1 äºååç"AIè½¬å"</h3>
<p>AIçåå¸¦æ¥å·¨å¤§çç®åéæ±ï¼äºååèµå¾çæ»¡éµæ»¡ã</p>
<ul>
<li><strong>AWSãAzureãé¿éäº</strong>ï¼AIç®åæä¸ºå¢é¿æå¿«çä¸å¡çº¿</li>
<li><strong>GPUç§èµ</strong>æä¸ºæ°ç­ç¹ï¼A100ãH100æ¾å¡ä¸å¡é¾æ±</li>
<li><strong>è¾¹ç¼è®¡ç®</strong>åæ¸©ï¼AIæ¨çæ­£å¨ä»äºç«¯èµ°åç»ç«¯</li>
</ul>
<h3 id="102-å½äº§æ¿ä»£å é">10.2 "å½äº§æ¿ä»£"å é</h3>
<p>åå°ç¼æ¿æ²»å½±åï¼<strong>å½äº§è¯ç</strong>çéæ±æ´æ¶¨ï¼</p>
<ul>
<li><strong>åä¸ºæè¾</strong>ï¼æç»­è¿­ä»£ï¼é¨ååºæ¯å¯æ¿ä»£è±ä¼è¾¾</li>
<li><strong>å¯æ­¦çºªãæ¯åå¾®</strong>ï¼å½äº§AIè¯çååè·å¾æ´å¤å¸åºæºä¼</li>
<li><strong>ç®åç§èµå¹³å°</strong>ï¼å¸®å©ä¸­å°ä¼ä¸"ç¨å¾èµ·"AI</li>
</ul>
<p><strong>ä¸å¥è¯ï¼AIæ¶ä»£çåºç¡è®¾æ½ï¼æ°¸è¿æ¯"ç¡¬éè´§"ã</strong></p>
<hr>
<h2 id="ç»è¯­ç«å¨æµªæ½®ä¹å·æä»¬å¨ç­å¾ä»ä¹">ç»è¯­ï¼ç«å¨æµªæ½®ä¹å·ï¼æä»¬å¨ç­å¾ä»ä¹ï¼</h2>
<p>åå°è¿éï¼ä½ ä¼åç°2026å¹´çäºèç½è¡ä¸åç°åºä¸ä¸ªæ¸æ°çå¾æ¯ï¼<strong>AIä»"å·¥å·"è¿åä¸º"ä¼ä¼´"ï¼ææ¯åæ°ä»"å°æ°äººçæ¸¸æ"èµ°å"æ®æ æ¶ä»£"ã</strong></p>
<p>ä½ç¹è£ä¹ä¸ï¼ä¹æéå¿§ï¼</p>
<ul>
<li>AIççæãä¼¦çãçç®¡é®é¢æ¥çå°é</li>
<li>æµéçº¢å©è§é¡¶ï¼å¢éç«äºè½¬åå­éåå¼</li>
<li>å¨çç»æµä¸ç¡®å®æ§ä¾ç¶å­å¨ï¼èµæ¬å¸åºè¶äºä¿å®</li>
</ul>
<p><strong>ä½ä¸ºä¸ä¸ªæ®éç¨æ·ãä¸ä¸ªä»ä¸èãä¸ä¸ªå³æ³¨ç§æçäººï¼æä»¬åºè¯¥å¦ä½çå¾è¿ä¸åï¼</strong></p>
<p>æçç­æ¡æ¯ï¼<strong>ä¿æå¥½å¥ï¼ä¿æè­¦æï¼ä¿æè¡å¨ã</strong></p>
<p>ææ¯æµªæ½®ä¸å¯é»æ¡ï¼ä½æ¯ä¸æ¬¡æµªæ½®é½æ¯ä¸æ¬¡éæ°æ´ççæºä¼ãçæ­£å¼é±çä¸æ¯ææ¯æ¬èº«ï¼èæ¯<strong>ç¨ææ¯è§£å³çå®é®é¢çè½å</strong>ã</p>
<blockquote>
<p><em>"æªæ¥å·²ç»å°æ¥ï¼åªæ¯åå¸ä¸åã"</em> ââ ç§å¹»ä½å®¶å¨å»Â·åå¸æ£®</p>
</blockquote>
<hr>
<h2 id="-äºå¨æ¶é´">ð¢ äºå¨æ¶é´</h2>
<p>è¯»å®è¿ç¯æç« ï¼ä½ æå³æ³¨åªä¸ªè¯é¢ï¼</p>
<ul>
<li>A. AI Agentââææå¾"AIå¸®ææå·¥"</li>
<li>B. å½äº§å¤§æ¨¡åââæ³æ¯æå½è´§ä½ä¸ç¥éæä¹é</li>
<li>C. è§é¢çæââæ³è¯è¯å"AIå¯¼æ¼"</li>
<li>D. AIç¡¬ä»¶ââç­å¾ä¸ä¸ª"åæ¶ä»£"çäº§å</li>
<li>E. èªå¨é©¾é©¶ââå³å¿ä»ä¹æ¶åè½çæ­£"è±æ"</li>
<li>F. å¶ä»ââè¯è®ºåºèè</li>
</ul>
<p><strong>ä¹æ¬¢è¿ä½ å¨è¯è®ºåºåäº«ï¼2026å¹´ï¼ä½ ææ³ç¨AIå¸®ä½ åä»ä¹ï¼</strong></p>
<blockquote>
<p><em>å¦æä½ è§å¾è¿ç¯æç« æå¸®å©ï¼æ¬¢è¿ç¹ä¸ªèµãå¨çãè½¬åéç»æåãä½ çæ¯ææ¯ææç»­è¾åºçå¨åã</em></p>
</blockquote>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 23:11">2026-02-13 23:11</span>&nbsp;
<a href="https://www.cnblogs.com/nf01">åå¤«è¿ç»´</a>&nbsp;
éè¯»(<span id="post_view_count">173</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19613794);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19613794', targetLink: 'https://www.cnblogs.com/nf01/p/19613794', title: '2026å¹´äºèç½è¡ä¸åå¤§ç­é¨è¯é¢ï¼AIçé£ä¸ææ¯å¹³æçåå­è·¯å£' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ Vue3è§£æå­¦ä¹  - handlers æ¨¡å ]]></title>
    <link>https://www.cnblogs.com/aleafshit/p/19613786</link>
    <guid>63d30612fbedd7bf5eeaccd41e9322f8</guid>
    <description>
    <![CDATA[ 
            <div class="postcontent">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>æ¬¢è¿å¤§å®¶äº¤æµè®¨è®ºï¼ä¹æ¬¢è¿æåºé®é¢æä¸åè§ç¹ãæ¬æåºäºä¸ªäººå¯¹æºç ççè§£ä¸æ´çï¼é¾åå­å¨åå·®æä¸å®æ´ä¹å¤ï¼å¦æä½ ææ´æ·±å¥çè§è§£æåç°éè¯¯ï¼æå¾ä¸èµ·æ¢è®¨ä¸ä¿®æ­£ã</p>
<hr>
<h1 id="ä¸handlers-çæ ¸å¿è®¾è®¡ç®æ ">ä¸ãhandlers çæ ¸å¿è®¾è®¡ç®æ </h1>
<p>ä¸å¥è¯æ»ç»ï¼</p>
<blockquote>
<p>ä¸åæ°æ®ç»æï¼ç¨ä¸åçä»£çç­ç¥ï¼åå°âæå°æ¦æª + ç²¾ç¡®è§¦åâã</p>
</blockquote>
<p>ååºå¼ç³»ç»æ¬è´¨ä¸æ¯ä¸¤ä»¶äºï¼</p>
<ol>
<li>
<p><strong>ä¾èµæ¶éï¼trackï¼</strong>ï¼è¯»åæ¶è®°å½ä¾èµ</p>
</li>
<li>
<p><strong>å¯ä½ç¨è§¦åï¼triggerï¼</strong>ï¼åå¥æ¶è§¦åæ´æ°</p>
</li>
</ol>
<p>ä½ä¸åç±»åçæ°æ®ï¼</p>
<ul>
<li>
<p>åæ´æ¹å¼ä¸å</p>
</li>
<li>
<p>å¯æ¦æªè½åä¸å</p>
</li>
</ul>
<p>å æ­¤ Vue æä»£çé»è¾ææä¸å¥ï¼</p>
<table>
<thead>
<tr>
<th>ç±»å</th>
<th>åæ´æ¹å¼</th>
<th>Proxy è½å</th>
<th>æ¹æ¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>Object</td>
<td>å±æ§èµå¼</td>
<td>å¯å®æ´æ¦æª</td>
<td>baseHandlers</td>
</tr>
<tr>
<td>Array</td>
<td>å±æ§ + æ¹æ³</td>
<td>æ¹æ³æ æ³ç´æ¥æ¦æª</td>
<td>éåæ°ç»æ¹æ³</td>
</tr>
<tr>
<td>Map/Set</td>
<td>æ¹æ³é©±å¨</td>
<td>åªè½æ¦æª get</td>
<td>è¿åéåæ¹æ³</td>
</tr>
</tbody>
</table>
<p>è¿ä¸æ¯âå¤æâï¼èæ¯å¯¹ JavaScript è¯­ä¹è¾¹ççå·¥ç¨å¦¥åã</p>
<hr>
<h1 id="äºobjectç±»ç»§æ¿ä½ç³»">äºãObjectï¼ç±»ç»§æ¿ä½ç³»</h1>
<p>Object ç handler å¨ <code>baseHandlers.ts</code> ä¸­ï¼éè¿ç±»ç»§æ¿ç»ç»ï¼</p>
<h2 id="1-basereactivehandleræ½è±¡åºç±»">1. BaseReactiveHandlerï¼æ½è±¡åºç±»ï¼</h2>
<p>è¿æ¯ç»ä¸å¥å£ï¼è´è´£ï¼</p>
<ul>
<li>
<p>get æ¦æª</p>
</li>
<li>
<p>ref è§£å</p>
</li>
<li>
<p>æ·±/æµååºå¼éå½</p>
</li>
<li>
<p>ä¾èµæ¶é</p>
</li>
</ul>
<p>æ ¸å¿èè´£ï¼</p>
<pre><code class="language-bash">è®¿é®å±æ§ â track â è¿åååºå¼å¼
</code></pre>
<hr>
<h2 id="2-mutablereactivehandlerå¯åå¯¹è±¡">2. MutableReactiveHandlerï¼å¯åå¯¹è±¡ï¼</h2>
<p>è¿æ¯æå¸¸è§ç reactive çæ¬ï¼</p>
<h3 id="set">set</h3>
<p>è§¦åä¸¤ç§æä½ç±»åï¼</p>
<ul>
<li>
<p>TriggerOpTypes.ADDï¼æ°å¢å±æ§ï¼</p>
</li>
<li>
<p>TriggerOpTypes.SETï¼ä¿®æ¹å·²æå±æ§ï¼</p>
</li>
</ul>
<p>åºå ADD / SET çæä¹å¨äºï¼</p>
<pre><code class="language-bash">æ°å¢å±æ§ â  ä¿®æ¹å±æ§
</code></pre>
<p>æäºä¾èµåªå³å¿ç»æååï¼æ¯å¦ for...inãObject.keysï¼ã</p>
<hr>
<h3 id="deleteproperty">deleteProperty</h3>
<p>è§¦åï¼</p>
<pre><code class="language-bash">TriggerOpTypes.DELETE
</code></pre>
<hr>
<h3 id="has">has</h3>
<p>ç¨äºï¼</p>
<pre><code class="language-bash">key in obj
</code></pre>
<p>ä¾èµæ¶éï¼</p>
<pre><code class="language-bash">TrackOpTypes.HAS
</code></pre>
<hr>
<h3 id="ownkeys">ownKeys</h3>
<p>ç¨äºï¼</p>
<pre><code class="language-bash">for...in / Object.keys / Reflect.ownKeys
</code></pre>
<p>ä¾èµæ¶éï¼</p>
<pre><code class="language-bash">TrackOpTypes.ITERATE
</code></pre>
<p>è¿ä¸æ­¥æ¯å¾å¤äººå¿½ç¥çå³é®ï¼</p>
<blockquote>
<p>éåç»ææ¬èº«ä¹æ¯ä¾èµã</p>
</blockquote>
<hr>
<h2 id="3-readonlyreactivehandleråªè¯»">3. ReadonlyReactiveHandlerï¼åªè¯»ï¼</h2>
<p>åªè¯»çæ¬ç´æ¥é»æ­åæä½ï¼</p>
<ul>
<li>
<p>set â è­¦å + ä¸æ§è¡</p>
</li>
<li>
<p>deleteProperty â è­¦å + ä¸æ§è¡</p>
</li>
</ul>
<p>ä½ <strong>è¯»åä»ç¶ä¼ track</strong>ã</p>
<p>å ä¸ºåªè¯»ä¸ç­äºâæ ä¾èµâã</p>
<hr>
<h1 id="ä¸arrayæ¹æ³éåç­ç¥">ä¸ãArrayï¼æ¹æ³éåç­ç¥</h1>
<p>æ°ç»çé®é¢å¨äºï¼</p>
<blockquote>
<p>å¤§é¨ååæ´ä¸æ¯éè¿å±æ§èµå¼ï¼èæ¯éè¿æ¹æ³ã</p>
</blockquote>
<p>ä¾å¦ï¼</p>
<pre><code class="language-bash">arr.push()
arr.splice()
arr.shift()
</code></pre>
<p>Proxy æ æ³ç´æ¥æ¦æªæ¹æ³è°ç¨ã</p>
<p>Vue3 çæ¹æ¡æ¯ï¼</p>
<blockquote>
<p>å¨ get trap ä¸­è¿åâéåçæ¬âçæ°ç»æ¹æ³ã</p>
</blockquote>
<hr>
<h2 id="arrayinstrumentationsts">arrayInstrumentations.ts</h2>
<p>è¿åâéåçæ¬âçæ¹æ³å¯¹è±¡ã</p>
<p>å½è®¿é®æ°ç»æ¹æ³æ¶ï¼</p>
<pre><code class="language-bash">proxy.push
</code></pre>
<p>BaseReactiveHandler ç get trap ä¼å¤æ­ï¼</p>
<pre><code class="language-bash">æ¯ä¸æ¯æ°ç»ï¼
æ¯ä¸æ¯è¢«éåçæ¹æ³ï¼
</code></pre>
<p>å¦ææ¯ï¼</p>
<p>â è¿åâéåçæ¬âæ¹æ³</p>
<p>è¿äºæ¹æ³åé¨ï¼</p>
<ol>
<li>
<p>åæåä¾èµæ¶éï¼é¿åæ­»å¾ªç¯ï¼</p>
</li>
<li>
<p>è°ç¨åå§æ°ç»æ¹æ³</p>
</li>
<li>
<p>æå¨ trigger</p>
</li>
</ol>
<p>è¿å°±æ¯ï¼</p>
<blockquote>
<p>ç¨å½æ°åè£æ¨¡æâæ¹æ³æ¦æªâã</p>
</blockquote>
<hr>
<h1 id="åmap--setå·¥åå½æ°ä½ç³»">åãMap / Setï¼å·¥åå½æ°ä½ç³»</h1>
<p>éåç±»åæ¯æ°ç»æ´æç«¯ï¼</p>
<blockquote>
<p>ææåæ´é½éè¿æ¹æ³ã</p>
</blockquote>
<pre><code class="language-bash">map.set()
map.delete()
set.add()
</code></pre>
<p>Proxy è½æ¦æªçåªæï¼</p>
<pre><code class="language-bash">get
</code></pre>
<p>å æ­¤ Vue éç¨çº¯å·¥åå½æ°æ¨¡å¼ï¼èä¸æ¯ç±»ç»§æ¿ã</p>
<hr>
<h2 id="1-åªæ¦æª-get">1. åªæ¦æª get</h2>
<p>collectionHandlers çç­ç¥ï¼</p>
<pre><code class="language-bash">get â è¿åéååçæ¹æ³
</code></pre>
<p>åæ°ç»ç±»ä¼¼ï¼ä½æ´å½»åºã</p>
<hr>
<h2 id="2-åç§-handler-ç»å">2. åç§ handler ç»å</h2>
<p>åå»ºå¯¼åº 4 ä¸ªå¨å±ä»£çå¯¹è±¡ï¼</p>
<ol>
<li>
<p>mutableCollectionHandlersï¼æ·±ååºå¼ï¼</p>
</li>
<li>
<p>shallowCollectionHandlersï¼æµååºå¼ï¼</p>
</li>
<li>
<p>readonlyCollectionHandlersï¼åªè¯»ï¼</p>
</li>
<li>
<p>shallowReadonlyCollectionHandlersï¼æµåªè¯»ï¼</p>
</li>
</ol>
<p>è¿äºä¸æ¯æåçï¼èæ¯éè¿ï¼</p>
<pre><code class="language-bash">createInstrumentationsGetter(isReadonly, shallow)
</code></pre>
<p>å¨æçæã</p>
<hr>
<h2 id="3-createinstrumentations-æ ¸å¿å·¥å">3. createInstrumentations æ ¸å¿å·¥å</h2>
<p>è¿ä¸ªå·¥åå½æ°è´è´£ï¼</p>
<ul>
<li>
<p>æé éååç Map/Set æ¹æ³</p>
</li>
<li>
<p>å¨æ¹æ³åé¨è®¿é®åå§å¯¹è±¡</p>
</li>
</ul>
<p>å³é®ç¹ï¼</p>
<pre><code class="language-bash">ReactiveFlags.RAW â æ¿å°åå§æ°æ®
</code></pre>
<p>é¿åä»£çå¥ä»£çå¯¼è´çéå½é®é¢ã</p>
<hr>
<h1 id="äºtrack--trigger-çç²¾ç»æ§å¶">äºãTrack / Trigger çç²¾ç»æ§å¶</h1>
<p>è¿æ¯ Vue 3 ååºå¼ç³»ç»ççµé­æ¹è¿ä¹ä¸ã</p>
<p>è¯»åæä½è¢«åä¸ºï¼</p>
<ul>
<li>
<p>GET</p>
</li>
<li>
<p>HAS</p>
</li>
<li>
<p>ITERATE</p>
</li>
</ul>
<p>åå¥æä½è¢«åä¸ºï¼</p>
<ul>
<li>
<p>SET</p>
</li>
<li>
<p>ADD</p>
</li>
<li>
<p>DELETE</p>
</li>
</ul>
<p>å®ä»¬ä¸æ¯ç®åçä¸å¯¹ä¸å³ç³»ã</p>
<hr>
<h2 id="ç²¾ç¡®è§¦åçæä¹">ç²¾ç¡®è§¦åçæä¹</h2>
<p>å³é®è§åï¼</p>
<blockquote>
<p>å¹¶ä¸æ¯ææåæä½é½åºè¯¥è§¦åææä¾èµã</p>
</blockquote>
<p>ä¾å¦ï¼</p>
<ul>
<li>
<p>GET ä¾èµåªå³å¿ SET</p>
</li>
<li>
<p>ITERATE ä¾èµå³å¿ ADD / DELETE</p>
</li>
<li>
<p>HAS ä¾èµåªå³å¿ key æ¯å¦å­å¨</p>
</li>
</ul>
<p>å¦æä¸åºåï¼</p>
<pre><code class="language-bash">ä»»ä½åæä½ â å¨é¨ effect è§¦å
</code></pre>
<p>è¿ä¼å¯¼è´ï¼</p>
<ul>
<li>
<p>ä¸å¿è¦çéæ¸²æ</p>
</li>
<li>
<p>æ§è½éªå´©</p>
</li>
<li>
<p>å¯ä½ç¨é£æ´</p>
</li>
</ul>
<p>Vue 2 çååºå¼å°±å±äºç²ç²åº¦è§¦åã</p>
<p>Vue 3 ç handlers è®¾è®¡æ¬è´¨æ¯ï¼</p>
<blockquote>
<p>æâè¯»ç±»åâåâåç±»åâå»ºç«æ å°å³ç³»ã</p>
</blockquote>


</div>
<div class="clear"></div>

            </div>
            <div class="itemdesc">
                åè¡¨äº 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 23:03">2026-02-13 23:02</span>&nbsp;
<a href="https://www.cnblogs.com/aleafshit">death_ray</a>&nbsp;
éè¯»(<span id="post_view_count">81</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19613786);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19613786', targetLink: 'https://www.cnblogs.com/aleafshit/p/19613786', title: 'Vue3è§£æå­¦ä¹  - handlers æ¨¡å' })">ä¸¾æ¥</a>

            </div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ ãAzure App Serviceã32ä½ Windows App Service æå¤§è½ä½¿ç¨å¤å°åå­ï¼ ]]></title>
    <link>https://www.cnblogs.com/lulight/p/19613358</link>
    <guid>8bbb8e2ef5cc93bff1ec97e99650e503</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/lulight/p/19613358" title="åå¸äº 2026-02-13 19:13">
    <span role="heading" aria-level="2">ãAzure App Serviceã32ä½ Windows App Service æå¤§è½ä½¿ç¨å¤å°åå­ï¼</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<h2 id="é®é¢æè¿°">é®é¢æè¿°</h2>
<p>å¨ä½¿ç¨ Windows-based Azure Web Appï¼32ä½ï¼æ¶ï¼ç»å¸¸éå°ä»¥ä¸çé®ï¼</p>
<ul>
<li>è¿ç¨åå­ä¸éæ¯å¤å°ï¼</li>
<li>ä¸åæç®¡æ¨¡å¼ä¸å¯ç¨åå­å¦ä½è®¡ç®ï¼</li>
</ul>
<p>æ¬æå°éå¯¹è¿äºé®é¢è¿è¡è¯¦ç»è§£ç­ã<br>
<img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202602/2127802-20260213191205856-103002667.png" class="lazyload"></p>
<hr>
<h2 id="é®é¢è§£ç­">é®é¢è§£ç­</h2>
<h3 id="ä¸32-ä½ç¨åºæå¤§è½ä½¿ç¨å¤å°åå­">ä¸ã32 ä½ç¨åºæå¤§è½ä½¿ç¨å¤å°åå­ï¼</h3>
<p><strong>çè®ºä¸éçº¦ä¸º 4GB</strong></p>
<p>32 ä½ç¨åºçåå­å°åç± 32 ä¸ªäºè¿å¶ä½ç»æï¼å æ­¤çè®ºä¸å¯ä»¥æ 2Â³Â² = 4,294,967,296 ç§ä¸åçåå­å°åãæ¯ä¸ªåå­å°åæå 1 Byte çç©ºé´ï¼æä»¥ï¼</p>
<blockquote>
<p>32 ä½å°åç©ºé´ = 2Â³Â² Byte (4<em>1024</em>1024*1024 B) â 4GB</p>
</blockquote>
<p><strong>ä¸ºä»ä¹ææ¡£ä¸­æå° 2GBï¼</strong></p>
<p>Windows é»è®¤å° 4GB èæå°åç©ºé´ååä¸ºï¼</p>
<ul>
<li><strong>2GB ç¨æ·æ</strong>ï¼ä¾åºç¨ç¨åºä½¿ç¨</li>
<li><strong>2GB åæ ¸æ</strong>ï¼ä¾æä½ç³»ç»ä½¿ç¨</li>
</ul>
<p>å æ­¤ï¼é»è®¤æåµä¸åè¿ç¨å¯ç¨ç¨æ·æåå­ä¸º <strong>2GB</strong>ãè¿åªæ¯é»è®¤è¡ä¸ºï¼å¹¶é 32 ä½ç¨åºçç»å¯¹ä¸éãå¨æäºæåµä¸ï¼ä¾å¦å¯ç¨ Large Address Aware + ç¹å®ç³»ç»éç½®ï¼ï¼å¯ä»¥è¶è¿ 2GBã</p>
<hr>
<h3 id="äºin-process-ä¸-out-of-process-æ¨¡åå¯¹åå­çå½±å">äºãIn-Process ä¸ Out-Of-Process æ¨¡åå¯¹åå­çå½±å</h3>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202602/2127802-20260213191223025-396603613.png" class="lazyload"></p>
<h4 id="ä¸¤ç§æç®¡æ¨¡å¼å¯¹æ¯">ä¸¤ç§æç®¡æ¨¡å¼å¯¹æ¯</h4>
<table>
<thead>
<tr>
<th>ç¹æ§</th>
<th>In-Process</th>
<th>Out-of-Process</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®¿ä¸»è¿ç¨</td>
<td><code>w3wp.exe</code>ï¼IIS å·¥ä½è¿ç¨ï¼</td>
<td><code>dotnet.exe</code>ï¼ç¬ç«è¿ç¨ï¼</td>
</tr>
<tr>
<td>è¿ç¨æ°é</td>
<td>åºç¨ä¸ IIS å±äº«åä¸è¿ç¨</td>
<td>åºç¨è¿è¡å¨ç¬ç«è¿ç¨ä¸­</td>
</tr>
<tr>
<td>åå­éç¦»</td>
<td>ä¸ IIS å±äº«åå­ç©ºé´</td>
<td>ç¬ç«åå­ç©ºé´</td>
</tr>
<tr>
<td>æ§è½</td>
<td>æ´é«ï¼æ è¿ç¨é´éä¿¡å¼éï¼</td>
<td>ç¥ä½ï¼ééè¿ HTTP ä»£çï¼</td>
</tr>
</tbody>
</table>
<p><img alt="image" loading="lazy" data-src="https://img2024.cnblogs.com/blog/2127802/202602/2127802-20260213191243339-1051852491.png" class="lazyload"></p>
<h4 id="in-process-æ¨¡å¼åå­è¡ä¸º">In-Process æ¨¡å¼åå­è¡ä¸º</h4>
<ul>
<li>åºç¨ä»£ç ç´æ¥è¿è¡å¨ <code>w3wp.exe</code> è¿ç¨ä¸­</li>
<li>åå­ä¸éå <code>w3wp.exe</code> è¿ç¨éå¶ï¼
<ul>
<li>32 ä½ï¼çº¦ <strong>2GB</strong>ï¼Windows ç¨æ·æé»è®¤éå¶ï¼</li>
<li>64 ä½ï¼å Sandbox éå¶</li>
</ul>
</li>
<li><strong>æ³¨æ</strong>ï¼åºç¨åå­ + IIS æ¨¡ååå­ å±åå ç¨è¿ç¨ç©ºé´</li>
</ul>
<h4 id="out-of-process-æ¨¡å¼åå­è¡ä¸º">Out-of-Process æ¨¡å¼åå­è¡ä¸º</h4>
<ul>
<li>åºç¨è¿è¡å¨ç¬ç«ç <code>dotnet.exe</code> è¿ç¨ä¸­</li>
<li>Kestrel ä½ä¸ºè¾¹ç¼æå¡å¨ï¼IIS ä»ä½ä¸ºååä»£ç</li>
<li>åå­ä¸éç¬ç«è®¡ç®ï¼
<ul>
<li>32 ä½ï¼çº¦ <strong>4GB</strong>ï¼å¯å¯»åä¸éï¼</li>
<li>64 ä½ï¼å Sandbox éå¶</li>
</ul>
</li>
</ul>
<h4 id="azure-app-service-sandbox-éå¶">Azure App Service Sandbox éå¶</h4>
<p>å¨ Azure App Service ä¸­ï¼å­å¨ä¸ä¸ªæ ¸å¿éå¶ï¼</p>
<blockquote>
<p><strong>Sandbox éå¶</strong>ï¼è¿ç¨å®éè½è·å¾çæå¤§ç©çåå­ = æºå¨ç©çåå­ Ã 75%</p>
</blockquote>
<table>
<thead>
<tr>
<th>App Service Plan</th>
<th>ç©çåå­</th>
<th>64ä½è¿ç¨å¯ç¨åå­ï¼çº¦ï¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>B1/S1</td>
<td>1.75 GB</td>
<td>~1.3 GB</td>
</tr>
<tr>
<td>B2/S2</td>
<td>3.5 GB</td>
<td>~2.6 GB</td>
</tr>
<tr>
<td>B3/S3</td>
<td>7 GB</td>
<td>~5.25 GB</td>
</tr>
<tr>
<td>P1v2</td>
<td>3.5 GB</td>
<td>~2.6 GB</td>
</tr>
<tr>
<td>P2v2</td>
<td>7 GB</td>
<td>~5.25 GB</td>
</tr>
<tr>
<td>P3v2</td>
<td>14 GB</td>
<td>~10.5 GB</td>
</tr>
</tbody>
</table>
<p><strong>æ»ç»ï¼</strong></p>
<ul>
<li><strong>32 ä½è¿ç¨</strong>ï¼æ°¸è¿æ æ³çªç ´çº¦ 4GB çå¯å¯»åéå¶ï¼åæç®¡æ¨¡å¼å½±åä¸å¤§ï¼</li>
<li><strong>64 ä½è¿ç¨</strong>ï¼ä¼è§¦å Sandbox éå¶ï¼æå¤§çº¦ä¸ºç©çåå­ç 75%ï¼</li>
</ul>
<hr>
<h3 id="ä¸å¤ä¸ªèæç®å½æ¶çåå­è®¡ç®æ¹å¼">ä¸ãå¤ä¸ªèæç®å½æ¶çåå­è®¡ç®æ¹å¼</h3>
<p>å½åä¸ App Service ä¸å­å¨å¤ä¸ªèæç®å½ï¼vdirï¼æ¶ï¼</p>
<h4 id="in-process-æ¨¡å¼">In-Process æ¨¡å¼</h4>
<ul>
<li>ææèæç®å½å±äº«åä¸ä¸ª <code>w3wp.exe</code> è¿ç¨</li>
<li>åå­ä¸éä¸ºè¯¥è¿ç¨çæ»ä¸éï¼32ä½çº¦2GBï¼64ä½åSandboxéå¶ï¼</li>
<li>ååºç¨é´æ åå­éç¦»ï¼ä¸ä¸ªåºç¨åå­æ³æ¼å¯è½å½±åå¶ä»åºç¨</li>
</ul>
<h4 id="out-of-process-æ¨¡å¼">Out-of-Process æ¨¡å¼</h4>
<ul>
<li>æ¯ä¸ªèæç®å½ä¼çæç¬ç«ç <code>dotnet.exe</code> è¿ç¨</li>
<li>æ¯ä¸ªè¿ç¨åç¬è®¡ç®å¯ç¨åå­ä¸éï¼
<ul>
<li>32 ä½ â çº¦ 4GBï¼å®éå¯è½æ´ä½ï¼åå³äºç³»ç»éç½®ï¼</li>
<li>64 ä½ â å Sandbox éå¶ï¼æºå¨åå­ Ã 75%ï¼</li>
</ul>
</li>
<li>å¤ä¸ªç«ç¹å±äº«åä¸å° VM çç©çåå­ï¼è¿ç¨é´ä¼ç¸äºç«äºèµæº</li>
<li><strong>ä¼å¿</strong>ï¼è¿ç¨éç¦»ï¼ä¸ä¸ªåºç¨å´©æºä¸å½±åå¶ä»åºç¨</li>
</ul>
<hr>
<h3 id="åscmkuduè¿ç¨æ¯å¦è®¡å¥æ»åå­">åãSCMï¼Kuduï¼è¿ç¨æ¯å¦è®¡å¥æ»åå­ï¼</h3>
<p><strong>æ¯ç</strong>ãSCM è¿ç¨ä¹è¿è¡å¨åä¸å° VM ä¸ï¼å¶åå­å ç¨ä¼ä¸å¹¶è®¡å¥ App Service Plan çç©çåå­ä½¿ç¨éã</p>
<p><strong>Kudu å¸ååå­å ç¨</strong>ï¼çº¦ 200MB - 500MBï¼è§æä½èå®ï¼</p>
<hr>
<h3 id="äºå¦ä½çæ§-app-service-åå­ä½¿ç¨">äºãå¦ä½çæ§ App Service åå­ä½¿ç¨ï¼</h3>
<h4 id="æ¹æ³ä¸azure-portal-ææ ">æ¹æ³ä¸ï¼Azure Portal ææ </h4>
<p>å¨ Azure Portal ä¸­æ¥ç App Service ç <strong>Metrics</strong>ï¼</p>
<ul>
<li><code>Memory working set</code>ï¼å½åå·¥ä½éåå­</li>
<li><code>Private Bytes</code>ï¼è¿ç¨ç§æåå­</li>
</ul>
<h4 id="æ¹æ³äºkudu-è¿ç¨ç®¡çå¨">æ¹æ³äºï¼Kudu è¿ç¨ç®¡çå¨</h4>
<p>è®¿é® <code>https://&lt;your-app&gt;.scm.chinacloudsites.cn/ProcessExplorer/</code> æ¥çï¼</p>
<ul>
<li>åè¿ç¨çåå­å ç¨è¯¦æ</li>
<li><code>w3wp.exe</code> å <code>dotnet.exe</code> çå®æ¶åå­ç¶æ</li>
</ul>
<h4 id="æ¹æ³ä¸application-insights">æ¹æ³ä¸ï¼Application Insights</h4>
<p>å¯ç¨ Application Insights åï¼å¯çæ§ï¼</p>
<ul>
<li>åå­ä½¿ç¨è¶å¿</li>
<li>åå­å¼å¸¸åè­¦</li>
<li>GC è¡ä¸ºåæ</li>
</ul>
<hr>
<h2 id="æ»ç»">æ»ç»</h2>
<table>
<thead>
<tr>
<th>åºæ¯</th>
<th>åå­ä¸é</th>
</tr>
</thead>
<tbody>
<tr>
<td>32 ä½è¿ç¨ï¼çè®ºï¼</td>
<td>~4GB</td>
</tr>
<tr>
<td>32 ä½è¿ç¨ï¼Windows é»è®¤ï¼</td>
<td>~2GB</td>
</tr>
<tr>
<td>64 ä½è¿ç¨</td>
<td>ç©çåå­ Ã 75%</td>
</tr>
<tr>
<td>In-Processï¼32ä½ï¼</td>
<td>~2GBï¼ä¸IISå±äº«ï¼</td>
</tr>
<tr>
<td>Out-of-Processï¼32ä½ï¼</td>
<td>~4GBï¼ç¬ç«è¿ç¨ï¼</td>
</tr>
</tbody>
</table>
<p><strong>å»ºè®®</strong>ï¼</p>
<ol>
<li>å¦æåºç¨å¯¹åå­éæ±è¾é«ï¼æ¨èä½¿ç¨ <strong>64 ä½</strong> éç½®</li>
<li>å¯¹äºéè¦è¿ç¨éç¦»çåºæ¯ï¼éæ© <strong>Out-of-Process</strong> æ¨¡å¼</li>
<li>å®æçæ§åå­ä½¿ç¨ï¼é¿åè§¦åä¸éå¯¼è´åºç¨å¼å¸¸</li>
</ol>
<hr>
<h2 id="åèèµæ">åèèµæ</h2>
<ul>
<li>
<p>Virtual Address Space (Memory Management) : <a href="https://learn.microsoft.com/en-us/windows/win32/memory/virtual-address-space" target="_blank" rel="noopener nofollow">https://learn.microsoft.com/en-us/windows/win32/memory/virtual-address-space</a></p>
</li>
<li>
<p>.NET GC - Heap hard limit percent : <a href="https://learn.microsoft.com/en-us/dotnet/core/runtime-config/garbage-collector#heap-hard-limit-percent" target="_blank" rel="noopener nofollow">https://learn.microsoft.com/en-us/dotnet/core/runtime-config/garbage-collector#heap-hard-limit-percent</a></p>
</li>
<li>
<p>ASP.NET Core Module (In-Process vs Out-of-Process) : <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/aspnet-core-module" target="_blank" rel="noopener nofollow">https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/aspnet-core-module</a></p>
</li>
<li>
<p>Azure App Service Sandbox : <a href="https://github.com/projectkudu/kudu/wiki/Azure-Web-App-sandbox" target="_blank" rel="noopener nofollow">https://github.com/projectkudu/kudu/wiki/Azure-Web-App-sandbox</a></p>
</li>
</ul>


</div>
<div id="MySignature" role="contentinfo">
    <div style="background: #1c5f55;height: 36px;width: 618px;padding: 14px 5px 0px 3px;">
  <p style="
    font-weight: bold;
    color: white;
">å½å¨å¤æçç¯å¢ä¸­é¢ä¸´é®é¢ï¼æ ¼ç©ä¹ééï¼æµèéä¹å¾æ¸ï¼å®ä»¥å¨ä¹å¾çã äºä¸­ï¼æ°æ¯å¦æ­¤!</p>
</div>
</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-13 19:13">2026-02-13 19:13</span>&nbsp;
<a href="https://www.cnblogs.com/lulight">ç¼ç èå¢å¸</a>&nbsp;
éè¯»(<span id="post_view_count">50</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19613358);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19613358', targetLink: 'https://www.cnblogs.com/lulight/p/19613358', title: 'ãAzure App Serviceã32ä½ Windows App Service æå¤§è½ä½¿ç¨å¤å°åå­ï¼' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
<item>
    <title><![CDATA[ [æè§£LangChainæ§è¡å¼æ] PregelNodeââæ ç¶æçåè½èç¹ ]]></title>
    <link>https://www.cnblogs.com/jaydenai/p/19617222/pregel-node</link>
    <guid>3a717ad92b7a7ecb3847917f064074eb</guid>
    <description>
    <![CDATA[ 
            <h1 class="postTitle">
                <a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jaydenai/p/19617222/pregel-node" title="åå¸äº 2026-02-15 07:37">
    <span role="heading" aria-level="2">[æè§£LangChainæ§è¡å¼æ] PregelNodeââæ ç¶æçåè½èç¹</span>
    

</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                    <div id="cnblogs_post_description" style="display: none">
        
        ä¸ä¸ªPregelç±NodeåChannelæå»ºèæï¼åèä¿æç¶æå¹¶ä»¥Pub/Subçæ¹å¼é©±å¨Nodeæ§è¡ï¼Pregelä¸­çNodeæ¯ä¸ä¸ªPregelNodeå¯¹è±¡ï¼æ¯ä¸ä¸ªå®å¨æ ç¶æçåè½èç¹ã
    </div>
<div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p><code>Pregel</code>ä¸­çNodeå¯¹åºçç±»åä¸º<code>PregelNode</code>ãå¯¹äºä¸ä¸ª<code>PregelNode</code>å¯¹è±¡æ¥è¯´ï¼å®ææ ¸å¿çé¨åå°±æ¯ç»å®å¨å®ä¸é¢çä¸ä¸ªå¯æ§è¡æä½ï¼å®æ¯æ½è±¡ç±»Runnableçå­ç±»ãå¨LangChainæ´ä¸ªä½ç³»ä¸­ï¼Runnableç±»åå ä¹æ å¤ä¸å¨ï¼åæ¬è¯­è¨æ¨¡åï¼ä¸è®ºæ¯ä¼ ç»çLLMæ¨¡åè¿æ¯Chatæ¨¡åï¼ãå®ç°RAGçRetrieveråæç¤ºè¯æ¨¡æ¿ç­ç»ä»¶é½æ¯ä¸ä¸ªRunnableå¯¹è±¡ï¼å®éä¸Pregelæ¬èº«ä¹æ¯ä¸ä¸ªRunnableå¯¹è±¡ãLangChainçâChainâå°±æ¯ç±ä¸ç»Runnableå¯¹è±¡æç§æå®çé¡ºåºæå»ºèæãRunnableå¦æ­¤éè¦ï¼å¼å¾åå¼<a href="https://blog.csdn.net/jaydenai/category_13128380.html" target="_blank" rel="noopener nofollow">ä¸ä¸ªç³»å</a>è¿è¡ç¬ç«ä»ç»ï¼è¿éæä»¬å¯ç¨åå°å®çè§£æä¸ä¸ªå¯æ§è¡å¯¹è±¡ï¼å¯ç¨å¸®å©æä»¬æ§è¡å®ä¹Nodeçå½æ°ã</p>
<pre><code class="language-python">class PregelNode:
    bound: Runnable[Any, Any]
</code></pre>
<h2 id="1-è¾å¥">1. è¾å¥</h2>
<p>PregelNodeç<code>channels</code>å<code>triggers</code>å­æ®µè¡¨ç¤ºä½ä¸ºè¾å¥åè§¦åå¨çChannelçåç§°ãç±äºManagedValueä¹å¯ç¨ä½ä¸ºè¾å¥ï¼æä»¥channelså­æ®µä¹å¯ç¨åå«ManagerValueçåç§°ï¼è¿éæä»¬ç»ç§°ä¸ºChannelãåä¸ä¸ªChannelå¯ä»¥åæ¶ä½ä¸ºè¾å¥åè§¦åå¨ï¼åºç°å¨è¿ä¸¤ä¸ªå­æ®µä¸­ã</p>
<pre><code class="language-python">class PregelNode:
    channels : str | list[str]
    triggers : list[str]
</code></pre>
<p>å¯¹äºåä¸çè¾å¥ï¼Channelåç§°å¯ä»¥è®¾ç½®ä¸ºå­ç¬¦ä¸²ï¼ä¹å¯ä»¥å°è£æåè¡¨ï¼å®ä»¬ä¼å½±åNodeå¤çå½æ°çè¾å¥åæ°ä¼ éæ¹å¼ãå¯¹äºåèï¼å­ç¬¦ä¸²ï¼ï¼å¯¹åºChannelçå¼ä¼ä½ä¸ºåå§åæ°ä¼ éç»Nodeçå¤çå½æ°ï¼åèåä¼å°è£æå­å¸è¿è¡ä¼ éï¼å­å¸çKeyä¸ºChannelçåç§°ãå¦ä¸çæ¼ç¤ºå®ä¾ä½ç°äºè¿ä¸ç¹ã</p>
<pre><code class="language-python">from langgraph.channels import LastValue
from langgraph.pregel import Pregel, NodeBuilder
from langgraph.pregel._read import PregelNode

def build_node(node_name:str)-&gt;PregelNode:
    channel_in = f"{node_name}_in"
    channel_out = f"{node_name}_out"
    node = (NodeBuilder()
        .do(lambda args:args)
        .write_to(channel_out)).build()
   
    node.triggers = [channel_in]
    node.channels = channel_in if node_name == "foo" else [channel_in]
    return node

app = Pregel(
    nodes= {name: build_node(name) for name in ["foo","bar"]},
    channels= {
        "foo_in": LastValue(str),
        "bar_in": LastValue(str),
        "foo_out": LastValue(object),
        "bar_out": LastValue(object),
    },
    input_channels=["foo_in", "bar_in"],
    output_channels=["foo_out", "bar_out"])

result = app.invoke(input={"foo_in":"foobar", "bar_in":"foobar"})
assert result["foo_out"] == "foobar"
assert result["bar_out"] == {'bar_in': 'foobar'}
</code></pre>
<p>å¦æä¸ä¸ªChannelè¢«å¤ä¸ªNodeä½ä¸ºè¾å¥ï¼åªè¦è¯¥Channelè¢«ä»»ä¸Nodeä»¥åè¡¨çå½¢å¼æ³¨åï¼å¼æåé¨çå¯¹é½æºå¶å°ç»ä¸ä½¿ç¨å­å¸ä½ä¸ºææNodeå¤çå½æ°çè¾å¥ãæ¯å¦æä»¬æç§å¦ä¸çæ¹å¼ä¿®æ¹äºä¸é¢çç¨åºï¼æ¯fooåbarä¸¤ä¸ªNodeé½ä½¿ç¨foobarChannelä½ä¸ºè¾å¥ï¼è¯¥è¾å¥Channelå¨barä¸­ä»¥åè¡¨çå½¢å¼è¿è¡äºè®¾ç½®ï¼ä»¥å­ç¬¦ä¸²å½¢å¼è®¾ç½®çfooNodeçå¤çå½æ°çè¾å¥åæ°ä¾ç¶ä¼ç¼ç¨å­å¸ãè¿æ¯ä¸ä¸ªä¸ä¸ºäººç¥çç»èã</p>
<pre><code class="language-python">from langgraph.channels import LastValue
from langgraph.pregel import Pregel, NodeBuilder
from langgraph.pregel._read import PregelNode

def build_node(node_name:str)-&gt;PregelNode:
    node = (NodeBuilder()
        .do(lambda args:args)
        .write_to(node_name)).build()   
    node.triggers = ["input"]
    node.channels = "input" if node_name == "foo" else ["input"]
    return node

app = Pregel(
    nodes= {name: build_node(name) for name in ["foo","bar"]},
    channels= {
        "input": LastValue(str),
        "foo": LastValue(object),
        "bar": LastValue(object),
    },
    input_channels=["input"],
    output_channels=["foo", "bar"])

result = app.invoke(input={"input":"foobar"})
assert result["foo"] == {'input': 'foobar'}
assert result["bar"] == {'input': 'foobar'}
</code></pre>
<h2 id="2-è¾åº">2. è¾åº</h2>
<p>Nodeçæ§è¡ç»æä¾èµäºPregelNodeçwriterså­æ®µè¿åçä¸ç»Runnableå¯¹è±¡è¾åºå°å¯¹åºçChannelï¼ç³»ç»é»è®¤ä½¿ç¨çæ¯ä¸ä¸ª<code>ChannelWrite</code>ãå¦ä»£ç çæ®µæç¤ºï¼åå§åChannelWriteå¯¹è±¡æ¶éè¦æä¾ä¸ç»<code>ChannelWriteEntry</code>æ<code>ChannelWriteTupleEntry</code>æ¥è¡¨ç¤ºéå¯¹ç®æ Channelçåå¥æå¾ãå¦ä¸ä¸ªåºç¨äº@cached_propertyè£é¥°å¨çflat_writersè¿åä¸ç»æå¹³åçRunnableå¯¹è±¡ä»¥æä¾æ§è½ã</p>
<pre><code class="language-python">class PregelNode:
    writers : list[Runnable]
    @cached_property
    def flat_writers(self) -&gt; list[Runnable]
</code></pre>
<pre><code class="language-python">class ChannelWrite(RunnableCallable):
    writes: list[ChannelWriteEntry | ChannelWriteTupleEntry | Send]
    def __init__(
        self,
        writes: Sequence[ChannelWriteEntry | ChannelWriteTupleEntry | Send],
        *,
        tags: Sequence[str] | None = None,
    )
</code></pre>
<p>ChannelWriteEntryç<code>channel</code>å<code>value</code>å­æ®µåå«è¡¨ç¤ºè¾åºChannelåç§°åå¼ã<code>skip_none</code>å­æ®µå³å®æ¯å¦éè¦å¿½ç¥Noneå¼ï¼å¦ææå®äº<code>mapper</code>å­æ®µï¼<code>value</code>è¿ä¼è¢«å®ä½è¿ä¸æ­¥å¤çå¹¶æç»çæè¾åºå°Channelçå¼ãä¸ä¸ªChannelWriteEntryå¯¹åºä¸ä¸ªåä¸Channelçè¾åºï¼èChannelWriteTupleEntryå¯ä»¥å®æéå¯¹å¤Channelçè¾åºãå·ä½æ¥è¯´ï¼Nodeå¤çå½æ°è¿åçå¯¹è±¡å¯ä»¥ç»å®å¨å®çvalueå­æ®µä¸ï¼éè¿mapperæä¾çå¯æ§è¡å¯¹è±¡æ å°ä¸ºä¸ä¸ªâäºåç»åºåâï¼æ­¤äºåç»çä¸¤é¨åå¯¹åºè¾åºChannelçåç§°åå¼ãChannelWriteTupleEntryçstaticè®¾ç½®çä¸åç»åºåä»ä½éæåæç¨ï¼å¯ä»¥å¿½ç¥ã</p>
<pre><code class="language-python">class ChannelWriteEntry(NamedTuple):
    channel: str
    value: Any = PASSTHROUGH
    skip_none: bool = False
    mapper: Callable | None = None

class ChannelWriteTupleEntry(NamedTuple):
    mapper: Callable[[Any], Sequence[tuple[str, Any]] | None]
    value: Any = PASSTHROUGH
    static: Sequence[tuple[str, Any, str | None]] | None = None

PASSTHROUGH = object()
</code></pre>
<p>å¨å¦ä¸æç¤ºçæ¼ç¤ºå®ä¾ä¸­ï¼æä»¬åå»ºäºä¸ä¸ªåå«å¯ä¸NodeçPregelå¯¹è±¡ï¼å¹¶åå»ºäºä¸ä¸ªåå«åä¸ChannelWriteå¯¹è±¡çåè¡¨ä½ä¸ºè¯¥Nodeçwriterså­æ®µãæ­¤ChannelWriteçwritesåè¡¨åå«ä¸¤ä¸ªChannelWriteEntryåä¸ä¸ªChannelWriteTupleEntryï¼å®ä»¬åå«å®æäºéå¯¹ä¸ä¸ªChannelçè¾åºã</p>
<pre><code class="language-python">from langgraph.channels import LastValue
from langgraph.pregel import Pregel
from langgraph.pregel._read import PregelNode
from langgraph.pregel._write import ChannelWrite, ChannelWriteEntry, ChannelWriteTupleEntry

entry1 = ChannelWriteEntry(
    channel="foo",
    value= "123"
)
entry2 = ChannelWriteEntry(
    channel="bar",
    value= "456",
    mapper= lambda v: int(v)
)
tuple_entry = ChannelWriteTupleEntry(
    value= {"foo":"123", "bar":"456"},
    mapper= lambda v: [("baz", int(v["foo"]) + int(v["bar"]))]
)
node = PregelNode(
    triggers=["start"],
    channels=[],
    writers=[ChannelWrite(writes=[entry1, entry2, tuple_entry])]
)
app = Pregel(
    nodes={"body": node},
    channels={
        "start": LastValue(None),
        "foo": LastValue(str),
        "bar": LastValue(int),
        "baz": LastValue(int)
    },
    input_channels=["start"],
    output_channels=["foo", "bar", "baz"],
)

result = app.invoke(input={"start": None})
assert result == {"foo": "123", "bar": 456, "baz": 579}
</code></pre>
<p>å¯¹äºéè¿PregelNodeå¯¹è±¡è¡¨ç¤ºçNodeæ¥è¯´ï¼å¶boundå­æ®µè¿åçRunnableå¯¹è±¡ç¨äºæ§è¡å¤çå½æ°ï¼æä½æ§è¡çç»æç±writersåè¡¨çä¸ç»Runnableå¯¹è±¡åå¥ç¸åºçChannelï¼è¿ä¸¤ä¸ªæ ¸å¿å·¥ä½æç»ä¼è¢«å¦ä¸è¿ä¸ªnodeå±æ§åå¹¶ãå¯¹äºPregelæ¥è¯´ï¼è¯¥å±æ§å¨åè½ä¸åºæ¬å°±ä»£è¡¨äºæ´ä¸ªNodeï¼è¿ä¹æ¯è¯¥å±æ§å¦æ­¤å½åçåå ã</p>
<pre><code class="language-python">class PregelNode:    
    @cached_property
    def node(self) -&gt; Runnable[Any, Any] | None
</code></pre>
<h2 id="3-è¾å¥æ å°">3. è¾å¥æ å°</h2>
<p>NodeåºäºChannelçè¾å¥ãè§¦ååè¾åºåå«å¯¹åº<code>channels</code>ã<code>triggers</code>å<code>writers</code>å­æ®µãå¦æææè¾å¥Channelè¯»åçåå§è¾å¥ï¼ä»¥å­å¸å½¢å¼è¡¨ç¤ºï¼åæäº¤ç»å¤çå½æ°çåæ°æåºå¥ï¼æä»¬è¿å¯ä»¥å©ç¨mapperå­æ®µè¿åçå¯æ§è¡å¯¹è±¡ï¼<code>Callable[[Any], Any]</code>ï¼ä½è¿ä¸æ­¥æ å°ã</p>
<pre><code class="language-python">class PregelNode:
    mapper 	: Callable[[Any], Any] | None
</code></pre>
<p>å¦ä¸çæ¼ç¤ºç¨åºéè¿Pregelçmapperå­æ®µè®¾ç½®ä¸ºäºä¸ä¸ªLambdaè¡¨è¾¾å¼ï¼å°æä¾ç»Nodeå¤çå½æ°å¤ççå­å¸è½¬æ¢æåç»ã</p>
<pre><code class="language-python">from langgraph.channels import LastValue
from langgraph.pregel import Pregel, NodeBuilder
from langgraph.pregel._read import PregelNode
from typing import Tuple

node: PregelNode = (NodeBuilder()
    .subscribe_to("foo","bar")
    .do(lambda args:args)
    .write_to("output")).build()    
node.mapper = lambda args:tuple(args.values())

app = Pregel(
    nodes={"body": node},
    channels={
        "foo": LastValue(str),
        "bar": LastValue(str),
        "output": LastValue(Tuple[str,str]),
    },
    input_channels=["foo","bar"],
    output_channels=["output"],
)
result = app.invoke(input={"foo":"hello", "bar":"world"})
assert result["output"] == ("hello","world")
</code></pre>
<h2 id="4-å¤±è´¥éè¯">4. å¤±è´¥éè¯</h2>
<p>Agentä¸­çNodeå¯è½ä¼æ¶åç½ç»ä¼ è¾ãæ°æ®æ£ç´¢ç­ä¼å¯¼è´ç¬æ¶éè¯¯çæä½ï¼å¤±è´¥åèªå¨éè¯æºå¶æ¯ç¡®ä¿å¯é æ§çä¸»è¦ææ®µï¼æä»¬å¯ä»¥å©ç¨PregelNode ç<code>retry_policy</code>å­æ®µè®¾ç½®ç¸åºçéè¯ç­ç¥ãå·ä½çéè¯ç­ç¥éè¿å¦ä¸æç¤ºç<code>RetryPolicy</code>å·ååç»è¡¨ç¤ºãRetryPolicyç<code>max_attempts</code>å<code>initial_interval</code>åå«è¡¨ç¤ºæå¤§éè¯æ¬¡æ°ï¼åå«åæ¬¡è°ç¨ï¼åç¬¬ä¸æ¬¡éè¯åçåå§ç­å¾æ¶é´ï¼åä½ä¸ºç§ãå¦ææ²¡æä¸ºNodeè®¾ç½®éå¯¹æ§çéè¯ç­ç¥ï¼Pregelçretry_policyå­æ®µè®¾ç½®çéè¯ç­ç¥å°ä½ä¸ºååºã</p>
<pre><code class="language-python">class PregelNode:
retry_policy : Sequence[RetryPolicy] | None

class RetryPolicy(NamedTuple):
    initial_interval: float = 0.5
    backoff_factor: float = 2.0
    max_interval: float = 128.0
    max_attempts: int = 3
    jitter: bool = True
    retry_on: (
        type[Exception] | Sequence[type[Exception]] | Callable[[Exception], bool]
    ) = default_retry_on

class Pregel(
    PregelProtocol[StateT, ContextT, InputT, OutputT],
    Generic[StateT, ContextT, InputT, OutputT]): 
retry_policy : Sequence[RetryPolicy] = ()
</code></pre>
<p>éè¯ç­ç¥éç¨åºäºâé´éåå¢âçéé¿æºå¶ï¼Back offï¼ï¼ä¹å°±æ¯ä¸æ¬¡éè¯ç­å¾æ¶é´æ¯åä¸æ¬¡ç­å¾çNåï¼è¿ä¸ªåæ°éè¿<code>backoff_factor</code>å­æ®µæ¥æä¾ï¼<code>max_interval</code>å­æ®µä¸ºç­å¾å®ç°è®¾ç½®äºä¸éãä¸ºäºé²æ­¢å¤ä¸ªå¹¶åNodeåæ¶éè¯èäº§çâæç¾¤æåºâï¼æä»¬å¯ä»¥å¨éè¯é´éä¸­æ·»å éæºæå¨ï¼<code>jitter</code>æ¯è¿ä¸ç¹æ§çå¼å³ãè°ç¨å¤±è´¥æå¾å¤åå ï¼éè¯å¨ä»»ä½éè¯¯åºæ¯ä¸­é½ææä¹ï¼æä»¬å¯ä»¥å©ç¨<code>retry_on</code>å­æ®µè®¾ç½®ä¸ºéç½®è®¾ç½®åç½®æ¡ä»¶ãè¯¥å­æ®µçé»è®¤å¼å¯¹åºå¦ä¸è¿ä¸ª<code>default_retry_on</code>å½æ°ã</p>
<pre><code class="language-python">def default_retry_on(exc: Exception) -&gt; bool:
    import httpx
    import requests

    if isinstance(exc, ConnectionError):
        return True
    if isinstance(exc, httpx.HTTPStatusError):
        return 500 &lt;= exc.response.status_code &lt; 600
    if isinstance(exc, requests.HTTPError):
        return 500 &lt;= exc.response.status_code &lt; 600 if exc.response else True
    if isinstance(
        exc,
        (
            ValueError,
            TypeError,
            ArithmeticError,
            ImportError,
            LookupError,
            NameError,
            SyntaxError,
            RuntimeError,
            ReferenceError,
            StopIteration,
            StopAsyncIteration,
            OSError,
        ),
    ):
        return False
    return True
</code></pre>
<p>å¨å¦ä¸çæ¼ç¤ºç¨åºä¸­ï¼æä»¬å®ä¹äºä¸ä¸ªç¨äºåå»ºPregelå¯¹è±¡ç<code>build_pregel</code>å½æ°ï¼è¯¥å½æ°ç<code>max_attempts</code>åæ°å³å®ç»æè¿åPregelå¯¹è±¡çNodeéç¨çRetryPolicyçéè¯æ¬¡æ°ãNodeçå¤çå½æ°æ¯ä¸ä¸ªç±get_handlerå½æ°è¿åçé­åï¼è¯¥é­åå¨åä¸¤æ¬¡æ§è¡çæ¶åæ»æ¯ä¼æé¤å¼å¸¸ãç¨åºåæ çæåµæ¯ï¼éè¯æ¬¡æ°è¥è®¾ç½®ä¸º2ï¼è°ç¨ä¼æåºå¼å¸¸ï¼ä½æ¯è¥è®¾ç½®ä¸º3ï¼ä¼ä¿è¯æåè°ç¨ã</p>
<pre><code class="language-python">from langgraph.channels import LastValue
from langgraph.types import RetryPolicy
from langgraph.pregel import Pregel, NodeBuilder
from langgraph.pregel._read import PregelNode
from typing import Any

def get_handler():
    times = 0
    def handle(args: dict[str, Any]) -&gt; str:
        nonlocal times
        times += 1
        if times &lt; 3:
            raise Exception("manually thrown error.")
        return "Success"
    return handle

def build_node(max_attempts: int) -&gt; PregelNode:
    node = (
        NodeBuilder().subscribe_to("start").do(get_handler()).write_to("output")
    ).build()
    node.retry_policy = [RetryPolicy(max_attempts=max_attempts)]
    return node

def build_pregel(max_attempts: int) -&gt; Pregel:
    return Pregel(
        nodes={"body": build_node(max_attempts)},
        channels={
            "start": LastValue(None),
            "output": LastValue(str),
        },
        input_channels=["start"],
        output_channels=["output"],
    )

app = build_pregel(max_attempts=2)
try:
    app.invoke(input={"start": None})
    assert False, "Expected an exception but none was raised."
except Exception as e:
    assert str(e) == "manually thrown error."

app = build_pregel(max_attempts=3)
result = app.invoke(input={"start": None})
assert result["output"] == "Success"
</code></pre>
<h2 id="5-ç»æç¼å­">5. ç»æç¼å­</h2>
<p>å¦æNodeç»å®ä¸ä¸ªç¸å¯¹èæ¶çè®¡ç®ï¼å¹¶ä¸ç»æå®å¨ç±ç»å®çè¾å¥å³å®ï¼é£ä¹éå¯¹è¾å¥å¯¹ç»æäºä»¥ç¼å­æ çæ¯æ¹åæ¶å»¶çå¥½åæ³ãåºäºç»æçç¼å­å¯ä»¥éè¿PregelNode ç<code>cache_policy</code>å­æ®µè¿åçç¼å­ç­ç¥æ¥æ§å¶ãç¼å­ç­ç¥éè¿<code>CachePolicy</code>ç±»åè¡¨ç¤ºï¼å®å·æ<code>key_func</code>å<code>ttl</code>ä¸¤ä¸ªå­æ®µï¼åèæä¾ä¸ä¸ªç¨äºè§£æç¼å­é®ï¼å­ç¬¦ä¸²æèå­èæ°ç»ï¼çå¯æ§è¡å¯¹è±¡ï¼åèç¨äºè®¾ç½®ç¼å­è¿ææ¶é´ï¼å¦ææ²¡ææ¾ç¤ºè®¾ç½®ï¼æå³çæ°¸ä¸è¿æï¼ã</p>
<pre><code class="language-python">class PregelNode:    
    cache_policy : CachePolicy | None
    @cached_property
def input_cache_key(self) -&gt; INPUT_CACHE_KEY_TYPE	

@dataclass(**_DC_KWARGS)
class CachePolicy(Generic[KeyFuncT]):
    key_func: KeyFuncT = default_cache_key  
ttl: int | None = None

KeyFuncT = TypeVar("KeyFuncT", bound=Callable[..., str | bytes])
INPUT_CACHE_KEY_TYPE = tuple[Callable[..., Any], tuple[str, ...]]

def default_cache_key(*args: Any, **kwargs: Any) -&gt; str | bytes:
    return pickle.dumps((_freeze(args), _freeze(kwargs)), protocol=5, fix_imports=False)
</code></pre>
<p>å¯¹ç»æå®æ½ç¼å­çåææ¯éè¦å°è¾å¥çâæçº¹âä½ä¸ºç¼å­é®ï¼è¿éçç¼å­é®æ ¹æ®éè¿<code>INPUT_CACHE_KEY_TYPE</code>å®ä¹çäºåç»è¿è¡è®¡ç®ï¼è¯¥äºåç»ååé¨åæä¾çå¯æ§è¡å¯¹è±¡ç¸å½äºä¸ä¸ªåå¸å½æ°ï¼è½å¤å°åå§åå®¹è½¬æ¢æâæçº¹âï¼åèæä¾çå¤åç»ä»¥è·¯å¾çæ¹å¼å¯ä¸æ è¯å½åçèç¹ãCachePolicyçkey_funcå­æ®µå¯¹åºçå¯æ§è¡å¯¹è±¡å°ä¼ä½ä¸ºINPUT_CACHE_KEY_TYPEäºåç»çååé¨åï¼ä»å®ä¹å¯ä»¥çåºé»è®¤è®¾ç½®ç<code>default_cache_key</code>å½æ°ä¼å©ç¨<code>pickle</code>ä»¥åºååçæ¹å¼å°åå§è¾å¥è½¬æ¢æå­èä½ä¸ºæçº¹ãè¯¥æçº¹åäºåç»ååé¨ååå¹¶ç§°ä¸ºNodeæ§è¡ç»æç¼å­é¡¹çKeyã</p>
<p>è¿éä¹æä»¥éè¦å¼ºå¶ä½¿ç¨å­ç¬¦ä¸²æèå­èæ¥è¡¨ç¤ºç¼å­é®ï¼æ¯å ä¸ºPregeléå¯¹ç¼å­çå®ç°å¹¶ä¸éäºåå­å­å¨ï¼ååä¸å¯ä»¥ä¸ä»»æçåå­æ°æ®åºè¿è¡æ´åï¼æ¯å¦redisï¼ãç¼å­å­å¨å¨Pregelä¸­éè¿å¦ä¸è¿ä¸ªæ½è±¡åºç±»BaseCacheè¡¨ç¤ºï¼å®å®ä¹äºä¸ç³»åçæ½è±¡æ¹æ³å®æéå¯¹ç¼å­çè¯»åãåå¥åæ¸é¤ï¼æä»¬å¯ä»¥éè¿æ´¾çæ­¤åºç±»å®ç°èªå®ä¹çç¼å­å­å¨ãå¼åæµè¯é¶æ®µæä»¬ç»å¸¸ä¼ä½¿ç¨åºäºåå­å­å¨çInMemoryCacheãå¦ææ²¡æå¯¹Nodeçç¼å­ç­ç¥ä½éå¯¹æ§è®¾ç½®ï¼å¨Pregelå¯¹è±¡ä¸è®¾ç½®çç¼å­ç­ç¥å°ä½ä¸ºååºã</p>
<pre><code class="language-python">class BaseCache(ABC, Generic[ValueT]):
    serde: SerializerProtocol = JsonPlusSerializer(pickle_fallback=True)

    def __init__(self, *, serde: SerializerProtocol | None = None) -&gt; None:
        self.serde = serde or self.serde

    @abstractmethod
    def get(self, keys: Sequence[FullKey]) -&gt; dict[FullKey, ValueT]:

    @abstractmethod
    async def aget(self, keys: Sequence[FullKey]) -&gt; dict[FullKey, ValueT]:

    @abstractmethod
    def set(self, pairs: Mapping[FullKey, tuple[ValueT, int | None]]) -&gt; None:

    @abstractmethod
    async def aset(self, pairs: Mapping[FullKey, tuple[ValueT, int | None]]) -&gt; None:

    @abstractmethod
    def clear(self, namespaces: Sequence[Namespace] | None = None) -&gt; None:

    @abstractmethod
async def aclear(self, namespaces: Sequence[Namespace] | None = None) -&gt; None:

class Pregel(
    PregelProtocol[StateT, ContextT, InputT, OutputT],
    Generic[StateT, ContextT, InputT, OutputT]): 
    cache: BaseCache | None = None
    cache_policy: CachePolicy | None = None
</code></pre>
<p>å¨å¦ä¸æç¤ºçæ¼ç¤ºç¨åºä¸­ï¼å¯¹äºåå»ºçPregelçå¯ä¸Nodeï¼å®è½ç¶å·æä¸¤ä¸ªè¾å¥Channelï¼fooåbarï¼ï¼ä½æ¯å¯¹åºçå¤çå½æ°ä¼å°å½åæ¶é´æ³ä½ä¸ºè¿åç»æãæä»¬ä¸ºè¯¥Nodeè®¾ç½®äºç¼å­ç­ç¥ï¼å¹¶å°è¿ææ¶é´è®¾ç½®ä¸º30ç§ã</p>
<pre><code class="language-python">from langgraph.channels import LastValue
from langgraph.types import CachePolicy
from langgraph.pregel import Pregel,NodeBuilder
import datetime,time
from langgraph.cache.memory import InMemoryCache 

node = (NodeBuilder()
        .subscribe_to("foo","bar")
        .do(lambda _: datetime.datetime.now())
        .write_to("output")).build()
node.cache_policy = CachePolicy(ttl=30)
app = Pregel(
    nodes={"body": node},
    cache=InMemoryCache(),
    channels={
        "foo": LastValue(str),
        "bar": LastValue(str),
        "output": LastValue(str),
    },
    input_channels=["foo","bar"],
    output_channels=["output"])

input = {"foo":"abc", "bar":"xyz"}
result = app.invoke(input=input)
print(f"[{datetime.datetime.now()}]{input} -&gt; {result['output']}")

time.sleep(5)
result = app.invoke(input=input)
print(f"[{datetime.datetime.now()}]{input} -&gt; {result['output']}")

time.sleep(5)
input = {"foo":"xyz", "bar":"abc"}
result = app.invoke(input=input)
print(f"[{datetime.datetime.now()}]{input} -&gt; {result['output']}")
</code></pre>
<p>æä»¬ä»¥5ç§ä¸ºé´éè°ç¨äºPregelå¯¹è±¡ä¸æ¬¡ï¼åä¸¤æ¬¡ä½¿ç¨ç¸åçè¾å¥ï¼{"foo":"abc", "bar":"xyz"}ï¼ãä¸æ¬¡è°ç¨çæ¶é´æ³åè¾å¥è¾åºä¼ä»¥å¦ä¸çå½¢å¼æå°åºæ¥ï¼æä»¬å¯ä»¥æ¸æ°å°çå°åä¸¤æ¬¡ç±äºæä¾äºç¸åçåæ°ï¼æä»¥å¾å°äºç¸åçç»æï¼å¾ææ¾ç¬¬äºæ¬¡å¾å°çæ¯ç¼å­çç»æã</p>
<pre><code>[2026-01-31 23:51:20.178285]{'foo': 'abc', 'bar': 'xyz'} -&gt; 2026-01-31 23:51:20.177192
[2026-01-31 23:51:25.180527]{'foo': 'abc', 'bar': 'xyz'} -&gt; 2026-01-31 23:51:20.177192
[2026-01-31 23:51:30.183805]{'foo': 'xyz', 'bar': 'abc'} -&gt; 2026-01-31 23:51:30.182490
</code></pre>
<h2 id="6è¡¥é">6.è¡¥é</h2>
<p>åé¢å·²ç»ä»ç»äºPregelNodeç±»åçå¤§é¨åæ ¸å¿æåï¼å¯¹äºå¦ä¸å ä¸ªéæ¼çæåï¼æä»¬å¨è¿éä½ä¸ä¸æ¦åµæ§ä»ç»ãtagsä½¿æä»¬å¯ä»¥å¨Nodeä¸æä¸ç¸åºçæ ç­¾ï¼èmetadataåå¯ä»¥å¨å®ä¸é¢éå ä»»æçåæ°æ®ã</p>
<pre><code class="language-python">class PregelNode:        
    tags : Sequence[str] | None
    metadata : Mapping[str, Any] | None	
    subgraphs : Sequence[PregelProtocol]    

    def copy(self, update: dict[str, Any]) -&gt; PregelNode    
    def invoke(
        self,
        input: Any,
        config: RunnableConfig | None = None,
        **kwargs: Any | None,
    ) -&gt; Any    
    async def ainvoke(
        self,
        input: Any,
        config: RunnableConfig | None = None,
        **kwargs: Any | None,
    ) -&gt; Any
    def stream(
        self,
        input: Any,
        config: RunnableConfig | None = None,
        **kwargs: Any | None,
    ) -&gt; Iterator[Any]
    async def astream(
        self,
        input: Any,
        config: RunnableConfig | None = None,
        **kwargs: Any | None,
    ) -&gt; AsyncIterator[Any]	
</code></pre>
<p>Nodeç»åè¾¹ææäºå¾ï¼èå¾æ¬èº«ä¹å¯ä»¥ä½ä¸ºä¸ä¸ªNodeåä¸æå»ºä¸ä¸ªæ´å¤§çå¾ï¼æä»¥å¾å·æä¸ä¸ªåµå¥çå±çº§ç»æï¼ä¸ä¸ªNodeå¯ä»¥åå«ä¸ç»å­å¾ï¼ä½ç°å¨<code>subgraphs</code>å­æ®µä¸ãæ¹æ³copyå¯¹è¿åèªèº«çä¸ä¸ªæµæ·è´ï¼è³äºåä¸ªæ¹æ³ï¼<code>invoke</code>ã<code>ainvoke</code>ã<code>stream</code>å<code>astream</code>ï¼å®ç°çä¸¤ç§è°ç¨æ¨¡å¼ï¼æç»è¿æ¯éè¿è°ç¨boundå­æ®µçRunnableå¯¹è±¡çååæ¹æ³å®ç°çã</p>
<p>æä»¬æåä½¿ç¨æç®åçè¯­è¨å¯¹Pregelåä¸ä¸ªæ»ç»ï¼æä»¬å¯ä»¥å° PregelNode æ³è±¡æä¸ä¸ªæºè½ååºå ï¼å¶ä¸­<code>triggers</code>æ¯ç¹ç«è£ç½®ï¼å³å®ä»ä¹æ¶åå¼å§ï¼ï¼<code>channels</code>æ¯åæç®¡éï¼è¾å¥æ°æ®ï¼ï¼<code>mapper</code> æ¯å¥æå å·¥ï¼æ°æ®é¢å¤çï¼ï¼<code>bound</code> æ¯æ ¸å¿ååºå®¤ï¼ä¸å¡é»è¾ï¼ï¼<code>writers</code> æ¯æåè¾éå¸¦ï¼æ´æ°ç¶æï¼ã</p>
<h2 id="7-nodebuilder">7. NodeBuilder</h2>
<p>ä¸ºäºè®©å¤§å®¶å¯¹è¡¨ç¤ºNodeçPregelNodeç±»åææ·±å¥å°çè§£ï¼å¨åé¢çæ¼ç¤ºä¸­æä»¬å¤§é½éç¨ç´æ¥å¯¹å¶å­æ®µè¿è¡è®¾ç½®çæ¹å¼ï¼å®éä¸å¨çæ­£çå¼åä¸­åºæ¬ä¸ä¼è¿ä¹åï¼èæ¯éæ©ä½¿ç¨<code>NodeBuilder</code>æ¥æå»ºå®ï¼åèæä¾æ´å ç²¾ç®çAPIã</p>
<pre><code class="language-python">class NodeBuilder:
    def subscribe_only(
        self,
        channel: str,
    ) -&gt; Self
    def subscribe_to(
        self,
        *channels: str,
        read: bool = True,
    ) -&gt; Self
    def read_from(
        self,
        *channels: str,
    ) -&gt; Self
    def write_to(
        self,
        *channels: str | ChannelWriteEntry,
        **kwargs: _WriteValue,
    ) -&gt; Self
    def meta(self, *tags: str, **metadata: Any) -&gt; Self 
    def add_retry_policies(self, *policies: RetryPolicy) -&gt; Self
    def add_cache_policy(self, policy: CachePolicy) -&gt; Self 
    def build(self) -&gt; PregelNode 
</code></pre>
<p>å¦ææå»ºçNodeåªéå®ä¹ä¸ä¸ªChannelï¼æä»¬å¯ä»¥è°ç¨<code>subscribe_only</code>æ¹æ³ï¼å®å°ä»¥å­ç¬¦ä¸²çï¼ä¸æ¯åè¡¨ï¼å½¢å¼èµå¼ç»channelså­æ®µã<code>subscribe_to</code>æ¹æ³é»è®¤ä¼å°æå®çChannelåæ¶æ·»å å°<code>triggers</code>å<code>channels</code>åè¡¨ä¸­ï¼å¦æå°readåæ°è®¾ç½®ä¸ºFalseï¼æå®çChannelåªä¼ä½ä¸ºè¾å¥æ·»å å°channelsåè¡¨ä¸­ãread_fromæ¹æ³æå®çä»ä»æ¯è¾å¥Channelï¼æä»¥åªä¼æ·»å å°channelsåè¡¨ä¸­ã</p>
<p>å¦æèªè¡æå»ºPregelNodeï¼éå¯¹Channelçè¾åºä¼å¾éº»ç¦ï¼ä½¿ç¨NodeBuilderç<code>write_to</code>æ¹æ³å°±ç®åå¤äºï¼æä»¬åªéè¦æå®è¾åºChannelçåç§°åè¡¨å°±å¯ä»¥äºãå¦æéè¦å¤è¾åºä½æ´ç»ç²åº¦çæ§å¶ï¼ä¹å¯ä»¥æå®ä¸ç»<code>ChannelWriteEntry</code>å¯¹è±¡ãæä»¬ä¹å¯ä»¥å©ç¨write_toæ¹æ³æä¾çå³é®å­åæ°éå¯¹Channelçåå¥ï¼æ­¤æ¶åæ°åä¼ä½ä¸ºè¾åºChannelçåç§°ï¼ï¼å¶ç±»å_WriteValueå®ä¹å¦ä¸ï¼æä»¥æä»¬å¯ä»¥ä½¿ç¨å¼å®¹çLambdaè¡¨è¾¾å¼ç®åå¿«æ·å°å®æè¾åºã</p>
<pre><code class="language-python">_WriteValue = Callable[[Input], Output] | Any
</code></pre>
<p>åé¢ä»ç»çææ ç­¾åéå åæ°æ®çåè½å¯ä»¥è°ç¨NodeBuilderç<code>meta</code>æ¹æ³æ¥å®æï¼å¤±è´¥éè¯åç»æç¼å­ç­ç¥åç±<code>add_retry_policies</code>å<code>add_cache_policy</code>æ¹æ³æ¥æä¾ãç­ææè®¾ç½®å®æä¹åï¼æä»¬ç´æ¥è°ç¨<code>build</code>æ¹æ³å°ç®æ Nodeæå»ºåºæ¥ã</p>


</div>
<div class="clear"></div>

            </div>
            <div class="postDesc">posted @ 
<span id="post-date" data-last-update-days="0" data-date-updated="2026-02-15 07:37">2026-02-15 07:37</span>&nbsp;
<a href="https://www.cnblogs.com/jaydenai">JaydenAI</a>&nbsp;
éè¯»(<span id="post_view_count">9</span>)&nbsp;
è¯è®º(<span id="post_comment_count">0</span>)&nbsp;
&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(19617222);return false;">æ¶è</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '19617222', targetLink: 'https://www.cnblogs.com/jaydenai/p/19617222/pregel-node', title: '[æè§£LangChainæ§è¡å¼æ] PregelNodeââæ ç¶æçåè½èç¹' })">ä¸¾æ¥</a>
</div>
         ]]>
    </description>
    </item>
        </channel>
        </rss>